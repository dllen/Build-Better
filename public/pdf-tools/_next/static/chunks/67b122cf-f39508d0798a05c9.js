"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[326],{93177:function(e,t,r){var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.hasMultiEffects=t.readVectorMask=t.booleanOperations=t.readBezierKnot=t.infoHandlersMap=t.infoHandlers=void 0;var i=r(51746),a=r(65247),o=r(6061),s=r(53804),l=r(84584),d=r(405),c=r(49438),u=r(4915),p=r(368),f="abcdefghijklmnopqrstuvwxyz";function m(e,r,n,i){var a={key:e,has:r,read:n,write:i};t.infoHandlers.push(a),t.infoHandlersMap[a.key]=a}function h(e,r){t.infoHandlersMap[e]=t.infoHandlersMap[r]}function y(e){return function(t){return void 0!==t[e]}}function v(e){if((0,s.readUint32)(e))throw Error("Resource size above 4 GB limit at ".concat(e.offset.toString(16)));return(0,s.readUint32)(e)}function g(e,t){(0,l.writeUint32)(e,0),(0,l.writeUint32)(e,t)}function w(e,t,r){var n=(0,s.readFixedPointPath32)(e)*r,i=(0,s.readFixedPointPath32)(e)*t,a=(0,s.readFixedPointPath32)(e)*r,o=(0,s.readFixedPointPath32)(e)*t,l=(0,s.readFixedPointPath32)(e)*r;return[i,n,o,a,(0,s.readFixedPointPath32)(e)*t,l]}function F(e,r,n,i,a){for(var o=e.offset+a,l=r.paths,d=void 0;o-e.offset>=26;){var c=(0,s.readUint16)(e);switch(c){case 0:case 3:(0,s.readUint16)(e);var u=(0,s.readInt16)(e),p=(0,s.readUint16)(e);(0,s.skipBytes)(e,18),d={open:3===c,knots:[],fillRule:2===p?"non-zero":"even-odd"},-1!==u&&(d.operation=t.booleanOperations[u]),l.push(d);break;case 1:case 2:case 4:case 5:d.knots.push({linked:1===c||4===c,points:w(e,n,i)});break;case 6:(0,s.skipBytes)(e,24);break;case 7:var f=(0,s.readFixedPointPath32)(e),m=(0,s.readFixedPointPath32)(e),h=(0,s.readFixedPointPath32)(e),y=(0,s.readFixedPointPath32)(e),v=(0,s.readFixedPointPath32)(e);(0,s.skipBytes)(e,4),r.clipboard={top:f,left:m,bottom:h,right:y,resolution:v};break;case 8:r.fillStartsWithAllPixels=!!(0,s.readUint16)(e),(0,s.skipBytes)(e,22);break;default:throw Error("Invalid vmsk section")}}return l}t.infoHandlers=[],t.infoHandlersMap={},m("TySh",y("text"),function(e,t,r){if(1!==(0,s.readInt16)(e))throw Error("Invalid TySh version");for(var i=[],a=0;a<6;a++)i.push((0,s.readFloat64)(e));if(50!==(0,s.readInt16)(e))throw Error("Invalid TySh text version");var o=(0,d.readVersionAndDescriptor)(e);if(1!==(0,s.readInt16)(e))throw Error("Invalid TySh warp version");var l=(0,d.readVersionAndDescriptor)(e);if(t.text={transform:i,left:(0,s.readFloat32)(e),top:(0,s.readFloat32)(e),right:(0,s.readFloat32)(e),bottom:(0,s.readFloat32)(e),text:o["Txt "].replace(/\r/g,"\n"),index:o.TextIndex||0,gridding:d.textGridding.decode(o.textGridding),antiAlias:d.Annt.decode(o.AntA),orientation:d.Ornt.decode(o.Ornt),warp:{style:d.warpStyle.decode(l.warpStyle),value:l.warpValue||0,perspective:l.warpPerspective||0,perspectiveOther:l.warpPerspectiveOther||0,rotate:d.Ornt.decode(l.warpRotate)}},o.bounds&&(t.text.bounds=(0,d.descBoundsToBounds)(o.bounds)),o.boundingBox&&(t.text.boundingBox=(0,d.descBoundsToBounds)(o.boundingBox)),o.EngineData){var p=(0,c.parseEngineData)(o.EngineData),f=(0,u.decodeEngineData)(p);t.text=n(n({},t.text),f)}(0,s.skipBytes)(e,r())},function(e,t){var r=t.text,i=r.warp||{},a=r.transform||[1,0,0,1,0,0],o=n(n(n({"Txt ":(r.text||"").replace(/\r?\n/g,"\r"),textGridding:d.textGridding.encode(r.gridding),Ornt:d.Ornt.encode(r.orientation),AntA:d.Annt.encode(r.antiAlias)},r.bounds?{bounds:(0,d.boundsToDescBounds)(r.bounds)}:{}),r.boundingBox?{boundingBox:(0,d.boundsToDescBounds)(r.boundingBox)}:{}),{TextIndex:r.index||0,EngineData:(0,c.serializeEngineData)((0,u.encodeEngineData)(r))});(0,l.writeInt16)(e,1);for(var s=0;s<6;s++)(0,l.writeFloat64)(e,a[s]);(0,l.writeInt16)(e,50),(0,d.writeVersionAndDescriptor)(e,"","TxLr",o,"text"),(0,l.writeInt16)(e,1),(0,d.writeVersionAndDescriptor)(e,"","warp",S(i)),(0,l.writeFloat32)(e,r.left),(0,l.writeFloat32)(e,r.top),(0,l.writeFloat32)(e,r.right),(0,l.writeFloat32)(e,r.bottom)}),m("SoCo",function(e){return void 0!==e.vectorFill&&void 0===e.vectorStroke&&"color"===e.vectorFill.type},function(e,t){var r=(0,d.readVersionAndDescriptor)(e);t.vectorFill=(0,d.parseVectorContent)(r)},function(e,t){var r=(0,d.serializeVectorContent)(t.vectorFill).descriptor;(0,d.writeVersionAndDescriptor)(e,"","null",r)}),m("GdFl",function(e){return void 0!==e.vectorFill&&void 0===e.vectorStroke&&("solid"===e.vectorFill.type||"noise"===e.vectorFill.type)},function(e,t,r){var n=(0,d.readVersionAndDescriptor)(e);t.vectorFill=(0,d.parseVectorContent)(n),(0,s.skipBytes)(e,r())},function(e,t){var r=(0,d.serializeVectorContent)(t.vectorFill).descriptor;(0,d.writeVersionAndDescriptor)(e,"","null",r)}),m("PtFl",function(e){return void 0!==e.vectorFill&&void 0===e.vectorStroke&&"pattern"===e.vectorFill.type},function(e,t){var r=(0,d.readVersionAndDescriptor)(e);t.vectorFill=(0,d.parseVectorContent)(r)},function(e,t){var r=(0,d.serializeVectorContent)(t.vectorFill).descriptor;(0,d.writeVersionAndDescriptor)(e,"","null",r)}),m("vscg",function(e){return void 0!==e.vectorFill&&void 0!==e.vectorStroke},function(e,t,r){(0,s.readSignature)(e);var n=(0,d.readVersionAndDescriptor)(e);t.vectorFill=(0,d.parseVectorContent)(n),(0,s.skipBytes)(e,r())},function(e,t){var r=(0,d.serializeVectorContent)(t.vectorFill),n=r.descriptor,i=r.key;(0,l.writeSignature)(e,i),(0,d.writeVersionAndDescriptor)(e,"","null",n)}),t.readBezierKnot=w,t.booleanOperations=["exclude","combine","subtract","intersect"],t.readVectorMask=F,m("vmsk",y("vectorMask"),function(e,t,r,n){var i=n.width,a=n.height;if(3!==(0,s.readUint32)(e))throw Error("Invalid vmsk version");t.vectorMask={paths:[]};var o=t.vectorMask,l=(0,s.readUint32)(e);o.invert=(1&l)!=0,o.notLink=(2&l)!=0,o.disable=(4&l)!=0,F(e,o,i,a,r()),(0,s.skipBytes)(e,r())},function(e,r,n){var i=n.width,a=n.height,o=r.vectorMask,s=!!o.invert|2*!!o.notLink|4*!!o.disable;(0,l.writeUint32)(e,3),(0,l.writeUint32)(e,s),(0,l.writeUint16)(e,6),(0,l.writeZeros)(e,24);var d=o.clipboard;d&&((0,l.writeUint16)(e,7),(0,l.writeFixedPointPath32)(e,d.top),(0,l.writeFixedPointPath32)(e,d.left),(0,l.writeFixedPointPath32)(e,d.bottom),(0,l.writeFixedPointPath32)(e,d.right),(0,l.writeFixedPointPath32)(e,d.resolution),(0,l.writeZeros)(e,4)),(0,l.writeUint16)(e,8),(0,l.writeUint16)(e,+!!o.fillStartsWithAllPixels),(0,l.writeZeros)(e,22);for(var c=0,u=o.paths;c<u.length;c++){var p=u[c];(0,l.writeUint16)(e,3*!!p.open),(0,l.writeUint16)(e,p.knots.length),(0,l.writeUint16)(e,p.operation?t.booleanOperations.indexOf(p.operation):-1),(0,l.writeUint16)(e,"non-zero"===p.fillRule?2:1),(0,l.writeZeros)(e,18);for(var f=p.open?4:1,m=p.open?5:2,h=0,y=p.knots;h<y.length;h++){var v=y[h],g=v.linked,w=v.points;(0,l.writeUint16)(e,g?f:m),(0,l.writeFixedPointPath32)(e,w[1]/a),(0,l.writeFixedPointPath32)(e,w[0]/i),(0,l.writeFixedPointPath32)(e,w[3]/a),(0,l.writeFixedPointPath32)(e,w[2]/i),(0,l.writeFixedPointPath32)(e,w[5]/a),(0,l.writeFixedPointPath32)(e,w[4]/i)}}}),h("vsms","vmsk"),m("vowv",y("vowv"),function(e,t){t.vowv=(0,s.readUint32)(e)},function(e,t){(0,l.writeUint32)(e,t.vowv)}),m("vogk",y("vectorOrigination"),function(e,t,r){if(1!==(0,s.readInt32)(e))throw Error("Invalid vogk version");var n=(0,d.readVersionAndDescriptor)(e);t.vectorOrigination={keyDescriptorList:[]};for(var i=0,a=n.keyDescriptorList;i<a.length;i++){var o=a[i],l={};null!=o.keyShapeInvalidated&&(l.keyShapeInvalidated=o.keyShapeInvalidated),null!=o.keyOriginType&&(l.keyOriginType=o.keyOriginType),null!=o.keyOriginResolution&&(l.keyOriginResolution=o.keyOriginResolution),o.keyOriginShapeBBox&&(l.keyOriginShapeBoundingBox={top:(0,d.parseUnitsOrNumber)(o.keyOriginShapeBBox["Top "]),left:(0,d.parseUnitsOrNumber)(o.keyOriginShapeBBox.Left),bottom:(0,d.parseUnitsOrNumber)(o.keyOriginShapeBBox.Btom),right:(0,d.parseUnitsOrNumber)(o.keyOriginShapeBBox.Rght)});var c=o.keyOriginRRectRadii;c&&(l.keyOriginRRectRadii={topRight:(0,d.parseUnits)(c.topRight),topLeft:(0,d.parseUnits)(c.topLeft),bottomLeft:(0,d.parseUnits)(c.bottomLeft),bottomRight:(0,d.parseUnits)(c.bottomRight)});var u=o.keyOriginBoxCorners;u&&(l.keyOriginBoxCorners=[{x:u.rectangleCornerA.Hrzn,y:u.rectangleCornerA.Vrtc},{x:u.rectangleCornerB.Hrzn,y:u.rectangleCornerB.Vrtc},{x:u.rectangleCornerC.Hrzn,y:u.rectangleCornerC.Vrtc},{x:u.rectangleCornerD.Hrzn,y:u.rectangleCornerD.Vrtc}]);var p=o.Trnf;p&&(l.transform=[p.xx,p.xy,p.yx,p.yy,p.tx,p.ty]),t.vectorOrigination.keyDescriptorList.push(l)}(0,s.skipBytes)(e,r())},function(e,t){for(var r=t.vectorOrigination,n={keyDescriptorList:[]},i=0;i<r.keyDescriptorList.length;i++){var a=r.keyDescriptorList[i];n.keyDescriptorList.push({});var o=n.keyDescriptorList[n.keyDescriptorList.length-1];null!=a.keyOriginType&&(o.keyOriginType=a.keyOriginType),null!=a.keyOriginResolution&&(o.keyOriginResolution=a.keyOriginResolution);var s=a.keyOriginRRectRadii;s&&(o.keyOriginRRectRadii={unitValueQuadVersion:1,topRight:(0,d.unitsValue)(s.topRight,"topRight"),topLeft:(0,d.unitsValue)(s.topLeft,"topLeft"),bottomLeft:(0,d.unitsValue)(s.bottomLeft,"bottomLeft"),bottomRight:(0,d.unitsValue)(s.bottomRight,"bottomRight")});var c=a.keyOriginShapeBoundingBox;c&&(o.keyOriginShapeBBox={unitValueQuadVersion:1,"Top ":(0,d.unitsValue)(c.top,"top"),Left:(0,d.unitsValue)(c.left,"left"),Btom:(0,d.unitsValue)(c.bottom,"bottom"),Rght:(0,d.unitsValue)(c.right,"right")});var u=a.keyOriginBoxCorners;u&&4===u.length&&(o.keyOriginBoxCorners={rectangleCornerA:{Hrzn:u[0].x,Vrtc:u[0].y},rectangleCornerB:{Hrzn:u[1].x,Vrtc:u[1].y},rectangleCornerC:{Hrzn:u[2].x,Vrtc:u[2].y},rectangleCornerD:{Hrzn:u[3].x,Vrtc:u[3].y}});var p=a.transform;p&&6===p.length&&(o.Trnf={xx:p[0],xy:p[1],yx:p[2],yy:p[3],tx:p[4],ty:p[5]}),null!=a.keyShapeInvalidated&&(o.keyShapeInvalidated=a.keyShapeInvalidated),o.keyOriginIndex=i}(0,l.writeInt32)(e,1),(0,d.writeVersionAndDescriptor)(e,"","null",n)}),m("lmfx",function(e){return void 0!==e.effects&&$(e.effects)},function(e,t,r){if(0!==(0,s.readUint32)(e))throw Error("Invalid lmfx version");var n=(0,d.readVersionAndDescriptor)(e);t.effects=(0,d.parseEffects)(n,!!e.logMissingFeatures),(0,s.skipBytes)(e,r())},function(e,t,r,n){var i=(0,d.serializeEffects)(t.effects,!!n.logMissingFeatures,!0);(0,l.writeUint32)(e,0),(0,d.writeVersionAndDescriptor)(e,"","null",i)}),m("lrFX",y("effects"),function(e,t,r){t.effects||(t.effects=(0,a.readEffects)(e)),(0,s.skipBytes)(e,r())},function(e,t){(0,a.writeEffects)(e,t.effects)}),m("luni",y("name"),function(e,t,r){if(r()>4){var n=(0,s.readUint32)(e);r()>=2*n?t.name=(0,s.readUnicodeStringWithLength)(e,n):e.logDevFeatures&&e.log("name in luni section is too long")}else e.logDevFeatures&&e.log("empty luni section");(0,s.skipBytes)(e,r())},function(e,t){(0,l.writeUnicodeString)(e,t.name)}),m("lnsr",y("nameSource"),function(e,t){return t.nameSource=(0,s.readSignature)(e)},function(e,t){return(0,l.writeSignature)(e,t.nameSource)}),m("lyid",y("id"),function(e,t){t.id=(0,s.readUint32)(e)},function(e,t,r,n){for(var i=t.id;n.layerIds.has(i);)i+=100;(0,l.writeUint32)(e,i),n.layerIds.add(i),n.layerToId.set(t,i)}),m("lsct",y("sectionDivider"),function(e,t,r){t.sectionDivider={type:(0,s.readUint32)(e)},r()&&((0,s.checkSignature)(e,"8BIM"),t.sectionDivider.key=(0,s.readSignature)(e)),r()&&(t.sectionDivider.subType=(0,s.readUint32)(e))},function(e,t){(0,l.writeUint32)(e,t.sectionDivider.type),t.sectionDivider.key&&((0,l.writeSignature)(e,"8BIM"),(0,l.writeSignature)(e,t.sectionDivider.key),void 0!==t.sectionDivider.subType&&(0,l.writeUint32)(e,t.sectionDivider.subType))}),h("lsdk","lsct"),m("clbl",y("blendClippendElements"),function(e,t){t.blendClippendElements=!!(0,s.readUint8)(e),(0,s.skipBytes)(e,3)},function(e,t){(0,l.writeUint8)(e,+!!t.blendClippendElements),(0,l.writeZeros)(e,3)}),m("infx",y("blendInteriorElements"),function(e,t){t.blendInteriorElements=!!(0,s.readUint8)(e),(0,s.skipBytes)(e,3)},function(e,t){(0,l.writeUint8)(e,+!!t.blendInteriorElements),(0,l.writeZeros)(e,3)}),m("knko",y("knockout"),function(e,t){t.knockout=!!(0,s.readUint8)(e),(0,s.skipBytes)(e,3)},function(e,t){(0,l.writeUint8)(e,+!!t.knockout),(0,l.writeZeros)(e,3)}),m("lmgm",y("layerMaskAsGlobalMask"),function(e,t){t.layerMaskAsGlobalMask=!!(0,s.readUint8)(e),(0,s.skipBytes)(e,3)},function(e,t){(0,l.writeUint8)(e,+!!t.layerMaskAsGlobalMask),(0,l.writeZeros)(e,3)}),m("lspf",y("protected"),function(e,t){var r=(0,s.readUint32)(e);t.protected={transparency:(1&r)!=0,composite:(2&r)!=0,position:(4&r)!=0},8&r&&(t.protected.artboards=!0)},function(e,t){var r=!!t.protected.transparency|2*!!t.protected.composite|4*!!t.protected.position|8*!!t.protected.artboards;(0,l.writeUint32)(e,r)}),m("lclr",y("layerColor"),function(e,t){var r=(0,s.readUint16)(e);(0,s.skipBytes)(e,6),t.layerColor=o.layerColors[r]},function(e,t){var r=o.layerColors.indexOf(t.layerColor);(0,l.writeUint16)(e,-1===r?0:r),(0,l.writeZeros)(e,6)}),m("shmd",function(e){return void 0!==e.timestamp||void 0!==e.animationFrames||void 0!==e.animationFrameFlags||void 0!==e.timeline||void 0!==e.comps},function(e,t,r){for(var n=(0,s.readUint32)(e),i=0;i<n;i++)!function(r){(0,s.checkSignature)(e,"8BIM");var n=(0,s.readSignature)(e);(0,s.readUint8)(e),(0,s.skipBytes)(e,3),(0,s.readSection)(e,1,function(r){if("cust"===n){var i=(0,d.readVersionAndDescriptor)(e);void 0!==i.layerTime&&(t.timestamp=i.layerTime)}else if("mlst"===n){var i=(0,d.readVersionAndDescriptor)(e);t.animationFrames=[];for(var a=0;a<i.LaSt.length;a++){var o=i.LaSt[a],l={frames:o.FrLs};void 0!==o.enab&&(l.enable=o.enab),o.Ofst&&(l.offset=(0,d.horzVrtcToXY)(o.Ofst)),o.FXRf&&(l.referencePoint=(0,d.horzVrtcToXY)(o.FXRf)),o.Lefx&&(l.effects=(0,d.parseEffects)(o.Lefx,!!e.logMissingFeatures)),o.blendOptions&&o.blendOptions.Opct&&(l.opacity=(0,d.parsePercent)(o.blendOptions.Opct)),t.animationFrames.push(l)}}else if("mdyn"===n){(0,s.readUint16)(e);var c=(0,s.readUint8)(e),u=(0,s.readUint8)(e);t.animationFrameFlags={propagateFrameOne:!c,unifyLayerPosition:(1&u)!=0,unifyLayerStyle:(2&u)!=0,unifyLayerVisibility:(4&u)!=0}}else if("tmln"===n){var i=(0,d.readVersionAndDescriptor)(e),p=i.timeScope,f={start:(0,d.frac)(p.Strt),duration:(0,d.frac)(p.duration),inTime:(0,d.frac)(p.inTime),outTime:(0,d.frac)(p.outTime),autoScope:i.autoScope,audioLevel:i.audioLevel};i.trackList&&(f.tracks=(0,d.parseTrackList)(i.trackList,!!e.logMissingFeatures)),t.timeline=f}else if("cmls"===n){var i=(0,d.readVersionAndDescriptor)(e);t.comps={settings:[]},i.origFXRefPoint&&(t.comps.originalEffectsReferencePoint={x:i.origFXRefPoint.Hrzn,y:i.origFXRefPoint.Vrtc});for(var m=0,h=i.layerSettings;m<h.length;m++){var y=h[m];t.comps.settings.push({compList:y.compList});var v=t.comps.settings[t.comps.settings.length-1];"enab"in y&&(v.enabled=y.enab),y.Ofst&&(v.offset={x:y.Ofst.Hrzn,y:y.Ofst.Vrtc}),y.FXRefPoint&&(v.effectsReferencePoint={x:y.FXRefPoint.Hrzn,y:y.FXRefPoint.Vrtc})}}else if("extn"===n){var i=(0,d.readVersionAndDescriptor)(e);e.logMissingFeatures&&e.log('Unhandled "shmd" section key',n)}else e.logMissingFeatures&&e.log('Unhandled "shmd" section key',n);(0,s.skipBytes)(e,r())})}(0);(0,s.skipBytes)(e,r())},function(e,t,r,n){var i=t.animationFrames,a=t.animationFrameFlags,o=t.timestamp,s=t.timeline,c=t.comps,u=0;i&&u++,a&&u++,s&&u++,void 0!==o&&u++,c&&u++,(0,l.writeUint32)(e,u),i&&((0,l.writeSignature)(e,"8BIM"),(0,l.writeSignature)(e,"mlst"),(0,l.writeUint8)(e,0),(0,l.writeZeros)(e,3),(0,l.writeSection)(e,2,function(){for(var r,n={LaID:null!=(r=t.id)?r:0,LaSt:[]},a=0;a<i.length;a++){var o=i[a],s={};void 0!==o.enable&&(s.enab=o.enable),s.FrLs=o.frames,o.offset&&(s.Ofst=(0,d.xyToHorzVrtc)(o.offset)),o.referencePoint&&(s.FXRf=(0,d.xyToHorzVrtc)(o.referencePoint)),o.effects&&(s.Lefx=(0,d.serializeEffects)(o.effects,!1,!1)),void 0!==o.opacity&&(s.blendOptions={Opct:(0,d.unitsPercent)(o.opacity)}),n.LaSt.push(s)}(0,d.writeVersionAndDescriptor)(e,"","null",n)},!0)),a&&((0,l.writeSignature)(e,"8BIM"),(0,l.writeSignature)(e,"mdyn"),(0,l.writeUint8)(e,0),(0,l.writeZeros)(e,3),(0,l.writeSection)(e,2,function(){(0,l.writeUint16)(e,0),(0,l.writeUint8)(e,15*!a.propagateFrameOne),(0,l.writeUint8)(e,!!a.unifyLayerPosition|2*!!a.unifyLayerStyle|4*!!a.unifyLayerVisibility)})),s&&((0,l.writeSignature)(e,"8BIM"),(0,l.writeSignature)(e,"tmln"),(0,l.writeUint8)(e,0),(0,l.writeZeros)(e,3),(0,l.writeSection)(e,2,function(){var r={Vrsn:1,timeScope:{Vrsn:1,Strt:s.start,duration:s.duration,inTime:s.inTime,outTime:s.outTime},autoScope:s.autoScope,audioLevel:s.audioLevel};s.tracks&&(r.trackList=(0,d.serializeTrackList)(s.tracks));var i=n.layerToId.get(t)||t.id;if(!i)throw Error("You need to provide layer.id value whan writing document with animations");r.LyrI=i,(0,d.writeVersionAndDescriptor)(e,"","null",r,"anim")},!0)),void 0!==o&&((0,l.writeSignature)(e,"8BIM"),(0,l.writeSignature)(e,"cust"),(0,l.writeUint8)(e,0),(0,l.writeZeros)(e,3),(0,l.writeSection)(e,2,function(){(0,d.writeVersionAndDescriptor)(e,"","metadata",{layerTime:o})},!0)),c&&((0,l.writeSignature)(e,"8BIM"),(0,l.writeSignature)(e,"cmls"),(0,l.writeUint8)(e,0),(0,l.writeZeros)(e,3),(0,l.writeSection)(e,2,function(){var r=n.layerToId.get(t)||t.id;if(!r)throw Error("You need to provide layer.id value whan writing document with layer comps");var i={};c.originalEffectsReferencePoint&&(i.origFXRefPoint={Hrzn:c.originalEffectsReferencePoint.x,Vrtc:c.originalEffectsReferencePoint.y}),i.LyrI=r,i.layerSettings=[];for(var a=0,o=c.settings;a<o.length;a++){var s=o[a],l={};void 0!==s.enabled&&(l.enab=s.enabled),s.offset&&(l.Ofst={Hrzn:s.offset.x,Vrtc:s.offset.y}),s.effectsReferencePoint&&(l.FXRefPoint={Hrzn:s.effectsReferencePoint.x,Vrtc:s.effectsReferencePoint.y}),l.compList=s.compList,i.layerSettings.push(l)}(0,d.writeVersionAndDescriptor)(e,"","null",i)},!0))}),m("PxSc",function(){return!1},function(e,t){var r=(0,d.readVersionAndDescriptor)(e,!0);0x76645053===r.pixelSourceType?t.pixelSource={type:"vdPS",origin:{x:r.origin.Hrzn,y:r.origin.Vrtc},interpretation:{interpretAlpha:r.interpretation.interpretAlpha.split(".")[1],profile:r.interpretation.profile},frameReader:{type:"QTFR",link:{name:r.frameReader["Lnk "]["Nm  "],fullPath:r.frameReader["Lnk "].fullPath,originalPath:r.frameReader["Lnk "].originalPath,relativePath:r.frameReader["Lnk "].relPath,alias:r.frameReader["Lnk "].alis},mediaDescriptor:r.frameReader.mediaDescriptor},showAlteredVideo:r.showAlteredVideo}:e.log("Unknown pixelSourceType")},function(e,t){var r=t.pixelSource,n={_name:"",_classID:"PixelSource",pixelSourceType:0x76645053,descVersion:1,origin:{Hrzn:r.origin.x,Vrtc:r.origin.y},interpretation:{_name:"",_classID:"footageInterpretation",Vrsn:1,interpretAlpha:"alphaInterpretation.".concat(r.interpretation.interpretAlpha),profile:r.interpretation.profile},frameReader:{_name:"",_classID:"FrameReader",frameReaderType:0x51544652,descVersion:1,"Lnk ":{_name:"",_classID:"ExternalFileLink",descVersion:2,"Nm  ":r.frameReader.link.name,fullPath:r.frameReader.link.fullPath,originalPath:r.frameReader.link.originalPath,alis:r.frameReader.link.alias,relPath:r.frameReader.link.relativePath},mediaDescriptor:r.frameReader.mediaDescriptor},showAlteredVideo:r.showAlteredVideo};(0,d.writeVersionAndDescriptor)(e,"","PixelSource",n)}),m("vstk",y("vectorStroke"),function(e,t,r){var n=(0,d.readVersionAndDescriptor)(e);t.vectorStroke={strokeEnabled:n.strokeEnabled,fillEnabled:n.fillEnabled,lineWidth:(0,d.parseUnits)(n.strokeStyleLineWidth),lineDashOffset:(0,d.parseUnits)(n.strokeStyleLineDashOffset),miterLimit:n.strokeStyleMiterLimit,lineCapType:d.strokeStyleLineCapType.decode(n.strokeStyleLineCapType),lineJoinType:d.strokeStyleLineJoinType.decode(n.strokeStyleLineJoinType),lineAlignment:d.strokeStyleLineAlignment.decode(n.strokeStyleLineAlignment),scaleLock:n.strokeStyleScaleLock,strokeAdjust:n.strokeStyleStrokeAdjust,lineDashSet:n.strokeStyleLineDashSet.map(d.parseUnits),blendMode:d.BlnM.decode(n.strokeStyleBlendMode),opacity:(0,d.parsePercent)(n.strokeStyleOpacity),content:(0,d.parseVectorContent)(n.strokeStyleContent),resolution:n.strokeStyleResolution},(0,s.skipBytes)(e,r())},function(e,t){var r,n,i,a=t.vectorStroke,o={strokeStyleVersion:2,strokeEnabled:!!a.strokeEnabled,fillEnabled:!!a.fillEnabled,strokeStyleLineWidth:a.lineWidth||{value:3,units:"Points"},strokeStyleLineDashOffset:a.lineDashOffset||{value:0,units:"Points"},strokeStyleMiterLimit:null!=(r=a.miterLimit)?r:100,strokeStyleLineCapType:d.strokeStyleLineCapType.encode(a.lineCapType),strokeStyleLineJoinType:d.strokeStyleLineJoinType.encode(a.lineJoinType),strokeStyleLineAlignment:d.strokeStyleLineAlignment.encode(a.lineAlignment),strokeStyleScaleLock:!!a.scaleLock,strokeStyleStrokeAdjust:!!a.strokeAdjust,strokeStyleLineDashSet:a.lineDashSet||[],strokeStyleBlendMode:d.BlnM.encode(a.blendMode),strokeStyleOpacity:(0,d.unitsPercent)(null!=(n=a.opacity)?n:1),strokeStyleContent:(0,d.serializeVectorContent)(a.content||{type:"color",color:{r:0,g:0,b:0}}).descriptor,strokeStyleResolution:null!=(i=a.resolution)?i:72};(0,d.writeVersionAndDescriptor)(e,"","strokeStyle",o)}),m("artb",y("artboard"),function(e,t,r){var n=(0,d.readVersionAndDescriptor)(e),i=n.artboardRect;t.artboard={rect:{top:i["Top "],left:i.Left,bottom:i.Btom,right:i.Rght},guideIndices:n.guideIndeces,presetName:n.artboardPresetName,color:(0,d.parseColor)(n["Clr "]),backgroundType:n.artboardBackgroundType},(0,s.skipBytes)(e,r())},function(e,t){var r,n=t.artboard,i=n.rect,a={artboardRect:{"Top ":i.top,Left:i.left,Btom:i.bottom,Rght:i.right},guideIndeces:n.guideIndices||[],artboardPresetName:n.presetName||"","Clr ":(0,d.serializeColor)(n.color),artboardBackgroundType:null!=(r=n.backgroundType)?r:1};(0,d.writeVersionAndDescriptor)(e,"","artboard",a)}),m("sn2P",y("usingAlignedRendering"),function(e,t){return t.usingAlignedRendering=!!(0,s.readUint32)(e)},function(e,t){return(0,l.writeUint32)(e,+!!t.usingAlignedRendering)});var I=["unknown","vector","raster","image stack"];function b(e){var t,r,i,a,o,s,l=n(n({style:d.warpStyle.decode(e.warpStyle)},e.warpValues?{values:e.warpValues}:{value:e.warpValue||0}),{perspective:e.warpPerspective||0,perspectiveOther:e.warpPerspectiveOther||0,rotate:d.Ornt.decode(e.warpRotate),bounds:e.bounds&&{top:(0,d.parseUnitsOrNumber)(e.bounds["Top "]),left:(0,d.parseUnitsOrNumber)(e.bounds.Left),bottom:(0,d.parseUnitsOrNumber)(e.bounds.Btom),right:(0,d.parseUnitsOrNumber)(e.bounds.Rght)},uOrder:e.uOrder,vOrder:e.vOrder});(null!=e.deformNumRows||null!=e.deformNumCols)&&(l.deformNumRows=e.deformNumRows,l.deformNumCols=e.deformNumCols);var c=e.customEnvelopeWarp;if(c){l.customEnvelopeWarp={meshPoints:[]};for(var u=(null==(t=c.meshPoints.find(function(e){return"Hrzn"===e.type}))?void 0:t.values)||[],p=(null==(r=c.meshPoints.find(function(e){return"Vrtc"===e.type}))?void 0:r.values)||[],f=0;f<u.length;f++)l.customEnvelopeWarp.meshPoints.push({x:u[f],y:p[f]});(c.quiltSliceX||c.quiltSliceY)&&(l.customEnvelopeWarp.quiltSliceX=(null==(a=null==(i=c.quiltSliceX)?void 0:i[0])?void 0:a.values)||[],l.customEnvelopeWarp.quiltSliceY=(null==(s=null==(o=c.quiltSliceY)?void 0:o[0])?void 0:s.values)||[])}return l}function D(e){var t,r;return null!=e.deformNumCols||null!=e.deformNumRows||(null==(t=e.customEnvelopeWarp)?void 0:t.quiltSliceX)||(null==(r=e.customEnvelopeWarp)?void 0:r.quiltSliceY)}function S(e){var t=e.bounds,r=n(n({warpStyle:d.warpStyle.encode(e.style)},e.values?{warpValues:e.values}:{warpValue:e.value||0}),{warpPerspective:e.perspective||0,warpPerspectiveOther:e.perspectiveOther||0,warpRotate:d.Ornt.encode(e.rotate),bounds:{"Top ":(0,d.unitsValue)(t&&t.top||{units:"Pixels",value:0},"bounds.top"),Left:(0,d.unitsValue)(t&&t.left||{units:"Pixels",value:0},"bounds.left"),Btom:(0,d.unitsValue)(t&&t.bottom||{units:"Pixels",value:0},"bounds.bottom"),Rght:(0,d.unitsValue)(t&&t.right||{units:"Pixels",value:0},"bounds.right")},uOrder:e.uOrder||0,vOrder:e.vOrder||0}),i=D(e);if(i){var a=r;a.deformNumRows=e.deformNumRows||0,a.deformNumCols=e.deformNumCols||0}var o=e.customEnvelopeWarp;if(o){var s=o.meshPoints||[];if(i){var a=r;a.customEnvelopeWarp={_name:"",_classID:"customEnvelopeWarp",quiltSliceX:[{type:"quiltSliceX",values:o.quiltSliceX||[]}],quiltSliceY:[{type:"quiltSliceY",values:o.quiltSliceY||[]}],meshPoints:[{type:"Hrzn",values:s.map(function(e){return e.x})},{type:"Vrtc",values:s.map(function(e){return e.y})}]}}else r.customEnvelopeWarp={_name:"",_classID:"customEnvelopeWarp",meshPoints:[{type:"Hrzn",values:s.map(function(e){return e.x})},{type:"Vrtc",values:s.map(function(e){return e.y})}]}}return r}function x(e){return new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}function k(e){for(var t=[],r=0;r<e.length;r+=2)t.push({x:e[r],y:e[r+1]});return t}function U(e){for(var t=[],r=0;r<e.length;r++)t.push(e[r].x,e[r].y);return t}function P(e){return k(new Float32Array(e.buffer.slice(e.byteOffset),0,e.byteLength/4))}function C(e){return{x:(0,d.parseUnits)(e.Hrzn),y:(0,d.parseUnits)(e.Vrtc)}}function A(e){return{_name:"",_classID:"Pnt ",Hrzn:(0,d.unitsValue)(e.x,"x"),Vrtc:(0,d.unitsValue)(e.y,"y")}}function E(e){return(0,d.unitsValue)(e.radius,"radius")}function L(e){if(e.warp)return e.warp;if(!e.width||!e.height)throw Error("You must provide width and height of the linked image in placedLayer");var t=e.width,r=e.height,n=t/3,i=2*t/3,a=r/3,o=2*r/3;return{style:"custom",value:0,perspective:0,perspectiveOther:0,rotate:"horizontal",bounds:{top:{value:0,units:"Pixels"},left:{value:0,units:"Pixels"},bottom:{value:r,units:"Pixels"},right:{value:t,units:"Pixels"}},uOrder:4,vOrder:4,customEnvelopeWarp:{meshPoints:[{x:0,y:0},{x:n,y:0},{x:i,y:0},{x:t,y:0},{x:0,y:a},{x:n,y:a},{x:i,y:a},{x:t,y:a},{x:0,y:o},{x:n,y:o},{x:i,y:o},{x:t,y:o},{x:0,y:r},{x:n,y:r},{x:i,y:r},{x:t,y:r}]}}}function B(e){return{top:(0,s.readInt32)(e),left:(0,s.readInt32)(e),bottom:(0,s.readInt32)(e),right:(0,s.readInt32)(e)}}function O(e,t){(0,l.writeInt32)(e,t.top),(0,l.writeInt32)(e,t.left),(0,l.writeInt32)(e,t.bottom),(0,l.writeInt32)(e,t.right)}function T(e){m(e,function(t){return!!t.linkedFiles&&!!t.linkedFiles.length&&("lnkE"!==e||!!t.linkedFiles.some(function(e){return e.linkedFile}))},function(t,r,n,i){for(r.linkedFiles=r.linkedFiles||[];n()>8;){var a=v(t),o=t.offset,l=(0,s.readSignature)(t),c=(0,s.readInt32)(t),u=(0,s.readPascalString)(t,1),p=(0,s.readUnicodeString)(t),f=(0,s.readSignature)(t).trim(),m=(0,s.readSignature)(t).trim(),h=v(t),y=(0,s.readUint8)(t)?(0,d.readVersionAndDescriptor)(t):void 0,g="liFE"===l?(0,d.readVersionAndDescriptor)(t):void 0,w={id:u,name:p};if(f&&(w.type=f),m&&(w.creator=m),y&&(w.descriptor={compInfo:{compID:y.compInfo.compID,originalCompID:y.compInfo.originalCompID}}),"liFE"===l&&c>3){var F=(0,s.readInt32)(t),I=(0,s.readUint8)(t),b=(0,s.readUint8)(t),D=(0,s.readUint8)(t),S=(0,s.readUint8)(t),x=(0,s.readFloat64)(t),k=Math.floor(x),U=(x-k)*1e3;w.time=new Date(Date.UTC(F,I,b,D,S,k,U)).toISOString()}var P="liFE"===l?v(t):0;for("liFA"===l&&(0,s.skipBytes)(t,8),"liFD"===l&&(w.data=(0,s.readBytes)(t,h)),c>=5&&(w.childDocumentID=(0,s.readUnicodeString)(t)),c>=6&&(w.assetModTime=(0,s.readFloat64)(t)),c>=7&&(w.assetLockedState=(0,s.readUint8)(t)),"liFE"===l&&2===c&&(w.data=(0,s.readBytes)(t,P)),t.skipLinkedFilesData&&(w.data=void 0),"lnkE"===e&&(w.linkedFile={fileSize:P,name:(null==g?void 0:g["Nm  "])||"",fullPath:(null==g?void 0:g.fullPath)||"",originalPath:(null==g?void 0:g.originalPath)||"",relativePath:(null==g?void 0:g.relPath)||""}),r.linkedFiles.push(w);a%4;)a++;t.offset=o+a}(0,s.skipBytes)(t,n())},function(t,r){for(var n,i,a,o,s,c,u,p,f,m=0,h=r.linkedFiles;m<h.length;m++){var y=h[m];if("lnkE"===e==!!y.linkedFile){var v=2;null!=y.assetLockedState?v=7:null!=y.assetModTime?v=6:null!=y.childDocumentID?v=5:"lnkE"==e&&(v=3),g(t,0);var w=t.offset;if((0,l.writeSignature)(t,"lnkE"===e?"liFE":y.data?"liFD":"liFA"),(0,l.writeInt32)(t,v),!y.id||"string"!=typeof y.id||!/^[0-9a-f]{8}-([0-9a-f]{4}-){3}[0-9a-f]{12}$/.test(y.id))throw Error("Linked file ID must be in a GUID format (example: 20953ddb-9391-11ec-b4f1-c15674f50bc4)");if((0,l.writePascalString)(t,y.id,1),(0,l.writeUnicodeStringWithPadding)(t,y.name||""),(0,l.writeSignature)(t,y.type?"".concat(y.type,"    ").substring(0,4):"    "),(0,l.writeSignature)(t,y.creator?"".concat(y.creator,"    ").substring(0,4):"\0\0\0\0"),g(t,y.data?y.data.byteLength:0),y.descriptor&&y.descriptor.compInfo){var F={compInfo:{compID:y.descriptor.compInfo.compID,originalCompID:y.descriptor.compInfo.originalCompID}};(0,l.writeUint8)(t,1),(0,d.writeVersionAndDescriptor)(t,"","null",F)}else(0,l.writeUint8)(t,0);if("lnkE"===e){var F={descVersion:2,"Nm  ":null!=(i=null==(n=y.linkedFile)?void 0:n.name)?i:"",fullPath:null!=(o=null==(a=y.linkedFile)?void 0:a.fullPath)?o:"",originalPath:null!=(c=null==(s=y.linkedFile)?void 0:s.originalPath)?c:"",relPath:null!=(p=null==(u=y.linkedFile)?void 0:u.relativePath)?p:""};(0,d.writeVersionAndDescriptor)(t,"","ExternalFileLink",F);var I=y.time?new Date(y.time):new Date;(0,l.writeInt32)(t,I.getUTCFullYear()),(0,l.writeUint8)(t,I.getUTCMonth()),(0,l.writeUint8)(t,I.getUTCDate()),(0,l.writeUint8)(t,I.getUTCHours()),(0,l.writeUint8)(t,I.getUTCMinutes()),(0,l.writeFloat64)(t,I.getUTCSeconds()+I.getUTCMilliseconds()/1e3)}y.data?(0,l.writeBytes)(t,y.data):g(t,(null==(f=y.linkedFile)?void 0:f.fileSize)||0),v>=5&&(0,l.writeUnicodeStringWithPadding)(t,y.childDocumentID||""),v>=6&&(0,l.writeFloat64)(t,y.assetModTime||0),v>=7&&(0,l.writeUint8)(t,y.assetLockedState||0);var b=t.offset-w;for(t.view.setUint32(w-4,b,!1);b%4;)b++,(0,l.writeUint8)(t,0)}}})}function V(e){return function(t){return!!t.adjustment&&t.adjustment.type===e}}function M(e){return{shadowInput:(0,s.readInt16)(e),highlightInput:(0,s.readInt16)(e),shadowOutput:(0,s.readInt16)(e),highlightOutput:(0,s.readInt16)(e),midtoneInput:(0,s.readInt16)(e)/100}}function R(e,t){(0,l.writeInt16)(e,t.shadowInput),(0,l.writeInt16)(e,t.highlightInput),(0,l.writeInt16)(e,t.shadowOutput),(0,l.writeInt16)(e,t.highlightOutput),(0,l.writeInt16)(e,Math.round(100*t.midtoneInput))}function _(e){for(var t=(0,s.readUint16)(e),r=[],n=0;n<t;n++){var i=(0,s.readInt16)(e),a=(0,s.readInt16)(e);r.push({input:a,output:i})}return r}function z(e,t){(0,l.writeUint16)(e,t.length);for(var r=0;r<t.length;r++){var n=t[r];(0,l.writeUint16)(e,n.output),(0,l.writeUint16)(e,n.input)}}function N(e){return{a:(0,s.readInt16)(e),b:(0,s.readInt16)(e),c:(0,s.readInt16)(e),d:(0,s.readInt16)(e),hue:(0,s.readInt16)(e),saturation:(0,s.readInt16)(e),lightness:(0,s.readInt16)(e)}}function W(e,t){var r=t||{};(0,l.writeInt16)(e,r.a||0),(0,l.writeInt16)(e,r.b||0),(0,l.writeInt16)(e,r.c||0),(0,l.writeInt16)(e,r.d||0),(0,l.writeInt16)(e,r.hue||0),(0,l.writeInt16)(e,r.saturation||0),(0,l.writeInt16)(e,r.lightness||0)}function j(e){return{cyanRed:(0,s.readInt16)(e),magentaGreen:(0,s.readInt16)(e),yellowBlue:(0,s.readInt16)(e)}}function H(e,t){(0,l.writeInt16)(e,t.cyanRed||0),(0,l.writeInt16)(e,t.magentaGreen||0),(0,l.writeInt16)(e,t.yellowBlue||0)}function G(e){var t=(0,s.readInt16)(e),r=(0,s.readInt16)(e),n=(0,s.readInt16)(e);return(0,s.skipBytes)(e,2),{red:t,green:r,blue:n,constant:(0,s.readInt16)(e)}}function Z(e,t){var r=t||{};(0,l.writeInt16)(e,r.red),(0,l.writeInt16)(e,r.green),(0,l.writeInt16)(e,r.blue),(0,l.writeZeros)(e,2),(0,l.writeInt16)(e,r.constant)}m("PlLd",y("placedLayer"),function(e,t,r){if("plcL"!==(0,s.readSignature)(e))throw Error("Invalid PlLd signature");if(3!==(0,s.readInt32)(e))throw Error("Invalid PlLd version");var n=(0,s.readPascalString)(e,1),i=(0,s.readInt32)(e),a=(0,s.readInt32)(e);(0,s.readInt32)(e);var o=(0,s.readInt32)(e);if(!I[o])throw Error("Invalid PlLd type");for(var l=[],c=0;c<8;c++)l.push((0,s.readFloat64)(e));var u=(0,s.readInt32)(e);if(0!==u)throw Error("Invalid Warp version ".concat(u));var p=(0,d.readVersionAndDescriptor)(e);t.placedLayer=t.placedLayer||{id:n,type:I[o],pageNumber:i,totalPages:a,transform:l,warp:b(p)},(0,s.skipBytes)(e,r())},function(e,t){var r=t.placedLayer;if((0,l.writeSignature)(e,"plcL"),(0,l.writeInt32)(e,3),!r.id||"string"!=typeof r.id||!/^[0-9a-f]{8}-([0-9a-f]{4}-){3}[0-9a-f]{12}$/.test(r.id))throw Error("Placed layer ID must be in a GUID format (example: 20953ddb-9391-11ec-b4f1-c15674f50bc4)");if((0,l.writePascalString)(e,r.id,1),(0,l.writeInt32)(e,1),(0,l.writeInt32)(e,1),(0,l.writeInt32)(e,16),-1===I.indexOf(r.type))throw Error("Invalid placedLayer type");(0,l.writeInt32)(e,I.indexOf(r.type));for(var n=0;n<8;n++)(0,l.writeFloat64)(e,r.transform[n]);(0,l.writeInt32)(e,0);var i=L(r),a=D(i)?"quiltWarp":"warp";(0,d.writeVersionAndDescriptor)(e,"",a,S(i),a)}),m("SoLd",y("placedLayer"),function(e,t,r){if("soLD"!==(0,s.readSignature)(e))throw Error("Invalid SoLd type");var i,a=(0,s.readInt32)(e);if(4!==a&&5!==a)throw Error("Invalid SoLd version");var o=(0,d.readVersionAndDescriptor)(e,!0);t.placedLayer={id:o.Idnt,placed:o.placed,type:I[o.Type],pageNumber:o.PgNm,totalPages:o.totalPages,frameStep:(0,d.frac)(o.frameStep),duration:(0,d.frac)(o.duration),frameCount:o.frameCount,transform:o.Trnf,width:o["Sz  "].Wdth,height:o["Sz  "].Hght,resolution:(0,d.parseUnits)(o.Rslt),warp:b(o.quiltWarp||o.warp)},o.nonAffineTransform&&o.nonAffineTransform.some(function(e,t){return e!==o.Trnf[t]})&&(t.placedLayer.nonAffineTransform=o.nonAffineTransform),o.Crop&&(t.placedLayer.crop=o.Crop),o.comp&&(t.placedLayer.comp=o.comp),o.compInfo&&(t.placedLayer.compInfo={compID:o.compInfo.compID,originalCompID:o.compInfo.originalCompID}),o.filterFX&&(t.placedLayer.filter=(i=o.filterFX,{enabled:i.enab,validAtPosition:i.validAtPosition,maskEnabled:i.filterMaskEnable,maskLinked:i.filterMaskLinked,maskExtendWithWhite:i.filterMaskExtendWithWhite,list:i.filterFXList.map(function(t){return function(e,t){var r={name:e["Nm  "],opacity:(0,d.parsePercent)(e.blendOptions.Opct),blendMode:d.BlnM.decode(e.blendOptions["Md  "]),enabled:e.enab,hasOptions:e.hasoptions,foregroundColor:(0,d.parseColor)(e.FrgC),backgroundColor:(0,d.parseColor)(e.BckC)};if("Fltr"in e)switch(e.Fltr._classID){case"boxblur":return n(n({},r),{type:"box blur",filter:{radius:(0,d.parseUnits)(e.Fltr["Rds "])}});case"GsnB":return n(n({},r),{type:"gaussian blur",filter:{radius:(0,d.parseUnits)(e.Fltr["Rds "])}});case"MtnB":return n(n({},r),{type:"motion blur",filter:{angle:e.Fltr.Angl,distance:(0,d.parseUnits)(e.Fltr.Dstn)}});case"RdlB":return n(n({},r),{type:"radial blur",filter:{amount:e.Fltr.Amnt,method:d.BlrM.decode(e.Fltr.BlrM),quality:d.BlrQ.decode(e.Fltr.BlrQ)}});case"shapeBlur":return n(n({},r),{type:"shape blur",filter:{radius:(0,d.parseUnits)(e.Fltr["Rds "]),customShape:{name:e.Fltr.customShape["Nm  "],id:e.Fltr.customShape.Idnt}}});case"SmrB":return n(n({},r),{type:"smart blur",filter:{radius:e.Fltr["Rds "],threshold:e.Fltr.Thsh,quality:d.SmBQ.decode(e.Fltr.SmBQ),mode:d.SmBM.decode(e.Fltr.SmBM)}});case"surfaceBlur":return n(n({},r),{type:"surface blur",filter:{radius:(0,d.parseUnits)(e.Fltr["Rds "]),threshold:e.Fltr.Thsh}});case"Dspl":return n(n({},r),{type:"displace",filter:{horizontalScale:e.Fltr.HrzS,verticalScale:e.Fltr.VrtS,displacementMap:d.DspM.decode(e.Fltr.DspM),undefinedAreas:d.UndA.decode(e.Fltr.UndA),displacementFile:{signature:e.Fltr.DspF.sig,path:e.Fltr.DspF.path}}});case"Pnch":return n(n({},r),{type:"pinch",filter:{amount:e.Fltr.Amnt}});case"Plr ":return n(n({},r),{type:"polar coordinates",filter:{conversion:d.Cnvr.decode(e.Fltr.Cnvr)}});case"Rple":return n(n({},r),{type:"ripple",filter:{amount:e.Fltr.Amnt,size:d.RplS.decode(e.Fltr.RplS)}});case"Shr ":return n(n({},r),{type:"shear",filter:{shearPoints:e.Fltr.ShrP.map(function(e){return{x:e.Hrzn,y:e.Vrtc}}),shearStart:e.Fltr.ShrS,shearEnd:e.Fltr.ShrE,undefinedAreas:d.UndA.decode(e.Fltr.UndA)}});case"Sphr":return n(n({},r),{type:"spherize",filter:{amount:e.Fltr.Amnt,mode:d.SphM.decode(e.Fltr.SphM)}});case"Twrl":return n(n({},r),{type:"twirl",filter:{angle:e.Fltr.Angl}});case"Wave":return n(n({},r),{type:"wave",filter:{numberOfGenerators:e.Fltr.NmbG,type:d.Wvtp.decode(e.Fltr.Wvtp),wavelength:{min:e.Fltr.WLMn,max:e.Fltr.WLMx},amplitude:{min:e.Fltr.AmMn,max:e.Fltr.AmMx},scale:{x:e.Fltr.SclH,y:e.Fltr.SclV},randomSeed:e.Fltr.RndS,undefinedAreas:d.UndA.decode(e.Fltr.UndA)}});case"ZgZg":return n(n({},r),{type:"zigzag",filter:{amount:e.Fltr.Amnt,ridges:e.Fltr.NmbR,style:d.ZZTy.decode(e.Fltr.ZZTy)}});case"AdNs":return n(n({},r),{type:"add noise",filter:{amount:(0,d.parsePercent)(e.Fltr.Nose),distribution:d.Dstr.decode(e.Fltr.Dstr),monochromatic:e.Fltr.Mnch,randomSeed:e.Fltr.FlRs}});case"DstS":return n(n({},r),{type:"dust and scratches",filter:{radius:e.Fltr["Rds "],threshold:e.Fltr.Thsh}});case"Mdn ":return n(n({},r),{type:"median",filter:{radius:(0,d.parseUnits)(e.Fltr["Rds "])}});case"denoise":return n(n({},r),{type:"reduce noise",filter:{preset:e.Fltr.preset,removeJpegArtifact:e.Fltr.removeJPEGArtifact,reduceColorNoise:(0,d.parsePercent)(e.Fltr.ClNs),sharpenDetails:(0,d.parsePercent)(e.Fltr.Shrp),channelDenoise:e.Fltr.channelDenoise.map(function(e){return n({channels:e.Chnl.map(d.Chnl.decode),amount:e.Amnt},e.EdgF?{preserveDetails:e.EdgF}:{})})}});case"ClrH":return n(n({},r),{type:"color halftone",filter:{radius:e.Fltr["Rds "],angle1:e.Fltr.Ang1,angle2:e.Fltr.Ang2,angle3:e.Fltr.Ang3,angle4:e.Fltr.Ang4}});case"Crst":return n(n({},r),{type:"crystallize",filter:{cellSize:e.Fltr.ClSz,randomSeed:e.Fltr.FlRs}});case"Mztn":return n(n({},r),{type:"mezzotint",filter:{type:d.MztT.decode(e.Fltr.MztT),randomSeed:e.Fltr.FlRs}});case"Msc ":return n(n({},r),{type:"mosaic",filter:{cellSize:(0,d.parseUnits)(e.Fltr.ClSz)}});case"Pntl":return n(n({},r),{type:"pointillize",filter:{cellSize:e.Fltr.ClSz,randomSeed:e.Fltr.FlRs}});case"Clds":return n(n({},r),{type:"clouds",filter:{randomSeed:e.Fltr.FlRs}});case"DfrC":return n(n({},r),{type:"difference clouds",filter:{randomSeed:e.Fltr.FlRs}});case"Fbrs":return n(n({},r),{type:"fibers",filter:{variance:e.Fltr.Vrnc,strength:e.Fltr.Strg,randomSeed:e.Fltr.RndS}});case"LnsF":return n(n({},r),{type:"lens flare",filter:{brightness:e.Fltr.Brgh,position:{x:e.Fltr.FlrC.Hrzn,y:e.Fltr.FlrC.Vrtc},lensType:d.Lns.decode(e.Fltr["Lns "])}});case"smartSharpen":return n(n({},r),{type:"smart sharpen",filter:{amount:(0,d.parsePercent)(e.Fltr.Amnt),radius:(0,d.parseUnits)(e.Fltr["Rds "]),threshold:e.Fltr.Thsh,angle:e.Fltr.Angl,moreAccurate:e.Fltr.moreAccurate,blur:d.blurType.decode(e.Fltr.blur),preset:e.Fltr.preset,shadow:{fadeAmount:(0,d.parsePercent)(e.Fltr.sdwM.Amnt),tonalWidth:(0,d.parsePercent)(e.Fltr.sdwM.Wdth),radius:e.Fltr.sdwM["Rds "]},highlight:{fadeAmount:(0,d.parsePercent)(e.Fltr.hglM.Amnt),tonalWidth:(0,d.parsePercent)(e.Fltr.hglM.Wdth),radius:e.Fltr.hglM["Rds "]}}});case"UnsM":return n(n({},r),{type:"unsharp mask",filter:{amount:(0,d.parsePercent)(e.Fltr.Amnt),radius:(0,d.parseUnits)(e.Fltr["Rds "]),threshold:e.Fltr.Thsh}});case"Dfs ":return n(n({},r),{type:"diffuse",filter:{mode:d.DfsM.decode(e.Fltr["Md  "]),randomSeed:e.Fltr.FlRs}});case"Embs":return n(n({},r),{type:"emboss",filter:{angle:e.Fltr.Angl,height:e.Fltr.Hght,amount:e.Fltr.Amnt}});case"Extr":return n(n({},r),{type:"extrude",filter:{type:d.ExtT.decode(e.Fltr.ExtT),size:e.Fltr.ExtS,depth:e.Fltr.ExtD,depthMode:d.ExtR.decode(e.Fltr.ExtR),randomSeed:e.Fltr.FlRs,solidFrontFaces:e.Fltr.ExtF,maskIncompleteBlocks:e.Fltr.ExtM}});case"Tls ":return n(n({},r),{type:"tiles",filter:{numberOfTiles:e.Fltr.TlNm,maximumOffset:e.Fltr.TlOf,fillEmptyAreaWith:d.FlCl.decode(e.Fltr.FlCl),randomSeed:e.Fltr.FlRs}});case"TrcC":return n(n({},r),{type:"trace contour",filter:{level:e.Fltr["Lvl "],edge:d.CntE.decode(e.Fltr["Edg "])}});case"Wnd ":return n(n({},r),{type:"wind",filter:{method:d.WndM.decode(e.Fltr.WndM),direction:d.Drct.decode(e.Fltr.Drct)}});case"Dntr":return n(n({},r),{type:"de-interlace",filter:{eliminate:d.IntE.decode(e.Fltr.IntE),newFieldsBy:d.IntC.decode(e.Fltr.IntC)}});case"Cstm":return n(n({},r),{type:"custom",filter:{scale:e.Fltr["Scl "],offset:e.Fltr.Ofst,matrix:e.Fltr.Mtrx}});case"HghP":return n(n({},r),{type:"high pass",filter:{radius:(0,d.parseUnits)(e.Fltr["Rds "])}});case"Mxm ":return n(n({},r),{type:"maximum",filter:{radius:(0,d.parseUnits)(e.Fltr["Rds "])}});case"Mnm ":return n(n({},r),{type:"minimum",filter:{radius:(0,d.parseUnits)(e.Fltr["Rds "])}});case"Ofst":return n(n({},r),{type:"offset",filter:{horizontal:e.Fltr.Hrzn,vertical:e.Fltr.Vrtc,undefinedAreas:d.FlMd.decode(e.Fltr["Fl  "])}});case"rigidTransform":return n(n({},r),{type:"puppet",filter:{rigidType:e.Fltr.rigidType,bounds:[{x:e.Fltr.PuX0,y:e.Fltr.PuY0},{x:e.Fltr.PuX1,y:e.Fltr.PuY1},{x:e.Fltr.PuX2,y:e.Fltr.PuY2},{x:e.Fltr.PuX3,y:e.Fltr.PuY3}],puppetShapeList:e.Fltr.puppetShapeList.map(function(e){var t;return{rigidType:e.rigidType,originalVertexArray:P(e.originalVertexArray),deformedVertexArray:P(e.deformedVertexArray),indexArray:Array.from(new Uint32Array((t=e.indexArray).buffer.slice(t.byteOffset),0,t.byteLength/4)),pinOffsets:k(e.pinOffsets),posFinalPins:k(e.posFinalPins),pinVertexIndices:e.pinVertexIndices,selectedPin:e.selectedPin,pinPosition:k(e.PinP),pinRotation:e.PnRt,pinOverlay:e.PnOv,pinDepth:e.PnDp,meshQuality:e.meshQuality,meshExpansion:e.meshExpansion,meshRigidity:e.meshRigidity,imageResolution:e.imageResolution,meshBoundaryPath:{pathComponents:e.meshBoundaryPath.pathComponents.map(function(e){return{shapeOperation:e.shapeOperation.split(".")[1],paths:e.SbpL.map(function(e){return{closed:e.Clsp,points:e["Pts "].map(function(e){return{anchor:C(e.Anch),forward:C(e["Fwd "]),backward:C(e["Bwd "]),smooth:e.Smoo}})}})}})}}})}});case"PbPl":for(var i=[],a=e.Fltr,o=0;o<f.length&&a["PN".concat(f[o],"a")];o++)for(var s=0;s<f.length&&a["PN".concat(f[o]).concat(f[s])];s++)i.push({name:a["PN".concat(f[o]).concat(f[s])],value:a["PF".concat(f[o]).concat(f[s])]});return n(n({},r),{type:"oil paint plugin",filter:{name:e.Fltr.KnNm,gpu:e.Fltr.GpuY,lighting:e.Fltr.LIWy,parameters:i}});case"HsbP":return n(n({},r),{type:"hsb/hsl",filter:{inputMode:d.ClrS.decode(e.Fltr.Inpt),rowOrder:d.ClrS.decode(e.Fltr.Otpt)}});case"oilPaint":return n(n({},r),{type:"oil paint",filter:{lightingOn:e.Fltr.lightingOn,stylization:e.Fltr.stylization,cleanliness:e.Fltr.cleanliness,brushScale:e.Fltr.brushScale,microBrush:e.Fltr.microBrush,lightDirection:e.Fltr.LghD,specularity:e.Fltr.specularity}});case"LqFy":return n(n({},r),{type:"liquify",filter:{liquifyMesh:e.Fltr.LqMe}});case"perspectiveWarpTransform":return n(n({},r),{type:"perspective warp",filter:{vertices:e.Fltr.vertices.map(C),warpedVertices:e.Fltr.warpedVertices.map(C),quads:e.Fltr.quads.map(function(e){return e.indices})}});case"Crvs":return n(n({},r),{type:"curves",filter:n({presetKind:d.presetKindType.decode(e.Fltr.presetKind)},e.Fltr.Adjs?{adjustments:e.Fltr.Adjs.map(function(e){var t=e.Chnl.map(d.Chnl.decode);if(e["Crv "])return{channels:t,curve:e["Crv "].map(function(e){var t={x:e.Hrzn,y:e.Vrtc};return e.Cnty&&(t.curved=!0),t})};if(e.Mpng)return{channels:t,values:e.Mpng};throw Error("Unknown curve adjustment")})}:{})});case"BrgC":return n(n({},r),{type:"brightness/contrast",filter:{brightness:e.Fltr.Brgh,contrast:e.Fltr.Cntr,useLegacy:!!e.Fltr.useLegacy}});default:if(t.throwForMissingFeatures)throw Error("Unknown filter classId: ".concat(e.Fltr._classID));return}switch(e.filterID){case 0x41767267:return n(n({},r),{type:"average"});case 0x426c7220:return n(n({},r),{type:"blur"});case 0x426c724d:return n(n({},r),{type:"blur more"});case 0x44737063:return n(n({},r),{type:"despeckle"});case 0x46637420:return n(n({},r),{type:"facet"});case 0x4672676d:return n(n({},r),{type:"fragment"});case 0x53687270:return n(n({},r),{type:"sharpen"});case 0x53687245:return n(n({},r),{type:"sharpen edges"});case 0x5368724d:return n(n({},r),{type:"sharpen more"});case 0x466e6445:return n(n({},r),{type:"find edges"});case 0x536c727a:return n(n({},r),{type:"solarize"});case 0x4e545343:return n(n({},r),{type:"ntsc colors"});case 0x496e7672:return n(n({},r),{type:"invert"});default:if(t.throwForMissingFeatures)throw Error("Unknown filterID: ".concat(e.filterID))}}(t,e)}).filter(function(e){return!!e})})),(0,s.skipBytes)(e,r())},function(e,t){(0,l.writeSignature)(e,"soLD"),(0,l.writeInt32)(e,4);var r,i,a=t.placedLayer;if(!a.id||"string"!=typeof a.id||!/^[0-9a-f]{8}-([0-9a-f]{4}-){3}[0-9a-f]{12}$/.test(a.id))throw Error("Placed layer ID must be in a GUID format (example: 20953ddb-9391-11ec-b4f1-c15674f50bc4)");var o=n(n({Idnt:a.id,placed:null!=(r=a.placed)?r:a.id,PgNm:a.pageNumber||1,totalPages:a.totalPages||1},a.crop?{Crop:a.crop}:{}),{frameStep:a.frameStep||{numerator:0,denominator:600},duration:a.duration||{numerator:0,denominator:600},frameCount:a.frameCount||0,Annt:16,Type:I.indexOf(a.type),Trnf:a.transform,nonAffineTransform:null!=(i=a.nonAffineTransform)?i:a.transform,warp:S(L(a)),"Sz  ":{_name:"",_classID:"Pnt ",Wdth:a.width||0,Hght:a.height||0},Rslt:a.resolution?(0,d.unitsValue)(a.resolution,"resolution"):{units:"Density",value:72}});if(a.filter&&(o.filterFX={_name:"",_classID:"filterFXStyle",enab:a.filter.enabled,validAtPosition:a.filter.validAtPosition,filterMaskEnable:a.filter.maskEnabled,filterMaskLinked:a.filter.maskLinked,filterMaskExtendWithWhite:a.filter.maskExtendWithWhite,filterFXList:a.filter.list.map(function(e){return function(e){var t={_name:"",_classID:"filterFX","Nm  ":e.name,blendOptions:{_name:"",_classID:"blendOptions",Opct:(0,d.unitsPercentF)(e.opacity),"Md  ":d.BlnM.encode(e.blendMode)},enab:e.enabled,hasoptions:e.hasOptions,FrgC:(0,d.serializeColor)(e.foregroundColor),BckC:(0,d.serializeColor)(e.backgroundColor)};switch(e.type){case"average":return n(n({},t),{filterID:0x41767267});case"blur":return n(n({},t),{filterID:0x426c7220});case"blur more":return n(n({},t),{filterID:0x426c724d});case"box blur":return n(n({},t),{Fltr:{_name:"Box Blur",_classID:"boxblur","Rds ":E(e.filter)},filterID:697});case"gaussian blur":return n(n({},t),{Fltr:{_name:"Gaussian Blur",_classID:"GsnB","Rds ":E(e.filter)},filterID:0x47736e42});case"motion blur":return n(n({},t),{Fltr:{_name:"Motion Blur",_classID:"MtnB",Angl:e.filter.angle,Dstn:(0,d.unitsValue)(e.filter.distance,"distance")},filterID:0x4d746e42});case"radial blur":return n(n({},t),{Fltr:{_name:"Radial Blur",_classID:"RdlB",Amnt:e.filter.amount,BlrM:d.BlrM.encode(e.filter.method),BlrQ:d.BlrQ.encode(e.filter.quality)},filterID:0x52646c42});case"shape blur":return n(n({},t),{Fltr:{_name:"Shape Blur",_classID:"shapeBlur","Rds ":E(e.filter),customShape:{_name:"",_classID:"customShape","Nm  ":e.filter.customShape.name,Idnt:e.filter.customShape.id}},filterID:702});case"smart blur":return n(n({},t),{Fltr:{_name:"Smart Blur",_classID:"SmrB","Rds ":e.filter.radius,Thsh:e.filter.threshold,SmBQ:d.SmBQ.encode(e.filter.quality),SmBM:d.SmBM.encode(e.filter.mode)},filterID:0x536d7242});case"surface blur":return n(n({},t),{Fltr:{_name:"Surface Blur",_classID:"surfaceBlur","Rds ":E(e.filter),Thsh:e.filter.threshold},filterID:701});case"displace":return n(n({},t),{Fltr:{_name:"Displace",_classID:"Dspl",HrzS:e.filter.horizontalScale,VrtS:e.filter.verticalScale,DspM:d.DspM.encode(e.filter.displacementMap),UndA:d.UndA.encode(e.filter.undefinedAreas),DspF:{sig:e.filter.displacementFile.signature,path:e.filter.displacementFile.path}},filterID:0x4473706c});case"pinch":return n(n({},t),{Fltr:{_name:"Pinch",_classID:"Pnch",Amnt:e.filter.amount},filterID:0x506e6368});case"polar coordinates":return n(n({},t),{Fltr:{_name:"Polar Coordinates",_classID:"Plr ",Cnvr:d.Cnvr.encode(e.filter.conversion)},filterID:0x506c7220});case"ripple":return n(n({},t),{Fltr:{_name:"Ripple",_classID:"Rple",Amnt:e.filter.amount,RplS:d.RplS.encode(e.filter.size)},filterID:0x52706c65});case"shear":return n(n({},t),{Fltr:{_name:"Shear",_classID:"Shr ",ShrP:e.filter.shearPoints.map(function(e){return{_name:"",_classID:"Pnt ",Hrzn:e.x,Vrtc:e.y}}),UndA:d.UndA.encode(e.filter.undefinedAreas),ShrS:e.filter.shearStart,ShrE:e.filter.shearEnd},filterID:0x53687220});case"spherize":return n(n({},t),{Fltr:{_name:"Spherize",_classID:"Sphr",Amnt:e.filter.amount,SphM:d.SphM.encode(e.filter.mode)},filterID:0x53706872});case"twirl":return n(n({},t),{Fltr:{_name:"Twirl",_classID:"Twrl",Angl:e.filter.angle},filterID:0x5477726c});case"wave":return n(n({},t),{Fltr:{_name:"Wave",_classID:"Wave",Wvtp:d.Wvtp.encode(e.filter.type),NmbG:e.filter.numberOfGenerators,WLMn:e.filter.wavelength.min,WLMx:e.filter.wavelength.max,AmMn:e.filter.amplitude.min,AmMx:e.filter.amplitude.max,SclH:e.filter.scale.x,SclV:e.filter.scale.y,UndA:d.UndA.encode(e.filter.undefinedAreas),RndS:e.filter.randomSeed},filterID:0x57617665});case"zigzag":return n(n({},t),{Fltr:{_name:"ZigZag",_classID:"ZgZg",Amnt:e.filter.amount,NmbR:e.filter.ridges,ZZTy:d.ZZTy.encode(e.filter.style)},filterID:0x5a675a67});case"add noise":return n(n({},t),{Fltr:{_name:"Add Noise",_classID:"AdNs",Dstr:d.Dstr.encode(e.filter.distribution),Nose:(0,d.unitsPercentF)(e.filter.amount),Mnch:e.filter.monochromatic,FlRs:e.filter.randomSeed},filterID:0x41644e73});case"despeckle":return n(n({},t),{filterID:0x44737063});case"dust and scratches":return n(n({},t),{Fltr:{_name:"Dust & Scratches",_classID:"DstS","Rds ":e.filter.radius,Thsh:e.filter.threshold},filterID:0x44737453});case"median":return n(n({},t),{Fltr:{_name:"Median",_classID:"Mdn ","Rds ":E(e.filter)},filterID:0x4d646e20});case"reduce noise":return n(n({},t),{Fltr:{_name:"Reduce Noise",_classID:"denoise",ClNs:(0,d.unitsPercentF)(e.filter.reduceColorNoise),Shrp:(0,d.unitsPercentF)(e.filter.sharpenDetails),removeJPEGArtifact:e.filter.removeJpegArtifact,channelDenoise:e.filter.channelDenoise.map(function(e){return n({_name:"",_classID:"channelDenoiseParams",Chnl:e.channels.map(function(e){return d.Chnl.encode(e)}),Amnt:e.amount},e.preserveDetails?{EdgF:e.preserveDetails}:{})}),preset:e.filter.preset},filterID:633});case"color halftone":return n(n({},t),{Fltr:{_name:"Color Halftone",_classID:"ClrH","Rds ":e.filter.radius,Ang1:e.filter.angle1,Ang2:e.filter.angle2,Ang3:e.filter.angle3,Ang4:e.filter.angle4},filterID:0x436c7248});case"crystallize":return n(n({},t),{Fltr:{_name:"Crystallize",_classID:"Crst",ClSz:e.filter.cellSize,FlRs:e.filter.randomSeed},filterID:0x43727374});case"facet":return n(n({},t),{filterID:0x46637420});case"fragment":return n(n({},t),{filterID:0x4672676d});case"mezzotint":return n(n({},t),{Fltr:{_name:"Mezzotint",_classID:"Mztn",MztT:d.MztT.encode(e.filter.type),FlRs:e.filter.randomSeed},filterID:0x4d7a746e});case"mosaic":return n(n({},t),{Fltr:{_name:"Mosaic",_classID:"Msc ",ClSz:(0,d.unitsValue)(e.filter.cellSize,"cellSize")},filterID:0x4d736320});case"pointillize":return n(n({},t),{Fltr:{_name:"Pointillize",_classID:"Pntl",ClSz:e.filter.cellSize,FlRs:e.filter.randomSeed},filterID:0x506e746c});case"clouds":return n(n({},t),{Fltr:{_name:"Clouds",_classID:"Clds",FlRs:e.filter.randomSeed},filterID:0x436c6473});case"difference clouds":return n(n({},t),{Fltr:{_name:"Difference Clouds",_classID:"DfrC",FlRs:e.filter.randomSeed},filterID:0x44667243});case"fibers":return n(n({},t),{Fltr:{_name:"Fibers",_classID:"Fbrs",Vrnc:e.filter.variance,Strg:e.filter.strength,RndS:e.filter.randomSeed},filterID:0x46627273});case"lens flare":return n(n({},t),{Fltr:{_name:"Lens Flare",_classID:"LnsF",Brgh:e.filter.brightness,FlrC:{_name:"",_classID:"Pnt ",Hrzn:e.filter.position.x,Vrtc:e.filter.position.y},"Lns ":d.Lns.encode(e.filter.lensType)},filterID:0x4c6e7346});case"sharpen":return n(n({},t),{filterID:0x53687270});case"sharpen edges":return n(n({},t),{filterID:0x53687245});case"sharpen more":return n(n({},t),{filterID:0x5368724d});case"smart sharpen":return n(n({},t),{Fltr:{_name:"Smart Sharpen",_classID:"smartSharpen",Amnt:(0,d.unitsPercentF)(e.filter.amount),"Rds ":E(e.filter),Thsh:e.filter.threshold,Angl:e.filter.angle,moreAccurate:e.filter.moreAccurate,blur:d.blurType.encode(e.filter.blur),preset:e.filter.preset,sdwM:{_name:"Parameters",_classID:"adaptCorrectTones",Amnt:(0,d.unitsPercentF)(e.filter.shadow.fadeAmount),Wdth:(0,d.unitsPercentF)(e.filter.shadow.tonalWidth),"Rds ":e.filter.shadow.radius},hglM:{_name:"Parameters",_classID:"adaptCorrectTones",Amnt:(0,d.unitsPercentF)(e.filter.highlight.fadeAmount),Wdth:(0,d.unitsPercentF)(e.filter.highlight.tonalWidth),"Rds ":e.filter.highlight.radius}},filterID:698});case"unsharp mask":return n(n({},t),{Fltr:{_name:"Unsharp Mask",_classID:"UnsM",Amnt:(0,d.unitsPercentF)(e.filter.amount),"Rds ":E(e.filter),Thsh:e.filter.threshold},filterID:0x556e734d});case"diffuse":return n(n({},t),{Fltr:{_name:"Diffuse",_classID:"Dfs ","Md  ":d.DfsM.encode(e.filter.mode),FlRs:e.filter.randomSeed},filterID:0x44667320});case"emboss":return n(n({},t),{Fltr:{_name:"Emboss",_classID:"Embs",Angl:e.filter.angle,Hght:e.filter.height,Amnt:e.filter.amount},filterID:0x456d6273});case"extrude":return n(n({},t),{Fltr:{_name:"Extrude",_classID:"Extr",ExtS:e.filter.size,ExtD:e.filter.depth,ExtF:e.filter.solidFrontFaces,ExtM:e.filter.maskIncompleteBlocks,ExtT:d.ExtT.encode(e.filter.type),ExtR:d.ExtR.encode(e.filter.depthMode),FlRs:e.filter.randomSeed},filterID:0x45787472});case"find edges":return n(n({},t),{filterID:0x466e6445});case"solarize":return n(n({},t),{filterID:0x536c727a});case"tiles":return n(n({},t),{Fltr:{_name:"Tiles",_classID:"Tls ",TlNm:e.filter.numberOfTiles,TlOf:e.filter.maximumOffset,FlCl:d.FlCl.encode(e.filter.fillEmptyAreaWith),FlRs:e.filter.randomSeed},filterID:0x546c7320});case"trace contour":return n(n({},t),{Fltr:{_name:"Trace Contour",_classID:"TrcC","Lvl ":e.filter.level,"Edg ":d.CntE.encode(e.filter.edge)},filterID:0x54726343});case"wind":return n(n({},t),{Fltr:{_name:"Wind",_classID:"Wnd ",WndM:d.WndM.encode(e.filter.method),Drct:d.Drct.encode(e.filter.direction)},filterID:0x576e6420});case"de-interlace":return n(n({},t),{Fltr:{_name:"De-Interlace",_classID:"Dntr",IntE:d.IntE.encode(e.filter.eliminate),IntC:d.IntC.encode(e.filter.newFieldsBy)},filterID:0x446e7472});case"ntsc colors":return n(n({},t),{filterID:0x4e545343});case"invert":return n(n({},t),{filterID:0x496e7672});case"custom":return n(n({},t),{Fltr:{_name:"Custom",_classID:"Cstm","Scl ":e.filter.scale,Ofst:e.filter.offset,Mtrx:e.filter.matrix},filterID:0x4373746d});case"high pass":return n(n({},t),{Fltr:{_name:"High Pass",_classID:"HghP","Rds ":E(e.filter)},filterID:0x48676850});case"maximum":return n(n({},t),{Fltr:{_name:"Maximum",_classID:"Mxm ","Rds ":E(e.filter)},filterID:0x4d786d20});case"minimum":return n(n({},t),{Fltr:{_name:"Minimum",_classID:"Mnm ","Rds ":E(e.filter)},filterID:0x4d6e6d20});case"offset":return n(n({},t),{Fltr:{_name:"Offset",_classID:"Ofst",Hrzn:e.filter.horizontal,Vrtc:e.filter.vertical,"Fl  ":d.FlMd.encode(e.filter.undefinedAreas)},filterID:0x4f667374});case"puppet":return n(n({},t),{Fltr:{_name:"Rigid Transform",_classID:"rigidTransform",null:["Ordn.Trgt"],rigidType:e.filter.rigidType,puppetShapeList:e.filter.puppetShapeList.map(function(e){return{_name:"",_classID:"puppetShape",rigidType:e.rigidType,VrsM:1,VrsN:0,originalVertexArray:x(new Float32Array(U(e.originalVertexArray))),deformedVertexArray:x(new Float32Array(U(e.deformedVertexArray))),indexArray:x(new Uint32Array(e.indexArray)),pinOffsets:U(e.pinOffsets),posFinalPins:U(e.posFinalPins),pinVertexIndices:e.pinVertexIndices,PinP:U(e.pinPosition),PnRt:e.pinRotation,PnOv:e.pinOverlay,PnDp:e.pinDepth,meshQuality:e.meshQuality,meshExpansion:e.meshExpansion,meshRigidity:e.meshRigidity,imageResolution:e.imageResolution,meshBoundaryPath:{_name:"",_classID:"pathClass",pathComponents:e.meshBoundaryPath.pathComponents.map(function(e){return{_name:"",_classID:"PaCm",shapeOperation:"shapeOperation.".concat(e.shapeOperation),SbpL:e.paths.map(function(e){return{_name:"",_classID:"Sbpl",Clsp:e.closed,"Pts ":e.points.map(function(e){return{_name:"",_classID:"Pthp",Anch:A(e.anchor),"Fwd ":A(e.forward),"Bwd ":A(e.backward),Smoo:e.smooth}})}})}})},selectedPin:e.selectedPin}}),PuX0:e.filter.bounds[0].x,PuX1:e.filter.bounds[1].x,PuX2:e.filter.bounds[2].x,PuX3:e.filter.bounds[3].x,PuY0:e.filter.bounds[0].y,PuY1:e.filter.bounds[1].y,PuY2:e.filter.bounds[2].y,PuY3:e.filter.bounds[3].y},filterID:991});case"oil paint plugin":for(var r={},i=0;i<e.filter.parameters.length;i++){var a=e.filter.parameters[i],o=a.name,s=a.value,l="".concat(f[Math.floor(i/f.length)]).concat(f[i%f.length]);r["PN".concat(l)]=o,r["PT".concat(l)]=0,r["PF".concat(l)]=s}return n(n({},t),{Fltr:n({_name:"Oil Paint Plugin",_classID:"PbPl",KnNm:e.filter.name,GpuY:e.filter.gpu,LIWy:e.filter.lighting,FPth:"1"},r),filterID:0x5062506c});case"oil paint":return n(n({},t),{Fltr:{_name:"Oil Paint",_classID:"oilPaint",lightingOn:e.filter.lightingOn,stylization:e.filter.stylization,cleanliness:e.filter.cleanliness,brushScale:e.filter.brushScale,microBrush:e.filter.microBrush,LghD:e.filter.lightDirection,specularity:e.filter.specularity},filterID:1122});case"liquify":return n(n({},t),{Fltr:{_name:"Liquify",_classID:"LqFy",LqMe:e.filter.liquifyMesh},filterID:0x4c714679});case"perspective warp":return n(n({},t),{Fltr:{_name:"Perspective Warp",_classID:"perspectiveWarpTransform",vertices:e.filter.vertices.map(A),warpedVertices:e.filter.warpedVertices.map(A),quads:e.filter.quads.map(function(e){return{indices:e}})},filterID:442});case"curves":return n(n({},t),{Fltr:n({_name:"Curves",_classID:"Crvs",presetKind:d.presetKindType.encode(e.filter.presetKind)},e.filter.adjustments?{Adjs:e.filter.adjustments.map(function(e){return"curve"in e?{_name:"",_classID:"CrvA",Chnl:e.channels.map(d.Chnl.encode),"Crv ":e.curve.map(function(e){return n({_name:"",_classID:"Pnt ",Hrzn:e.x,Vrtc:e.y},e.curved?{Cnty:!0}:{})})}:{_name:"",_classID:"CrvA",Chnl:e.channels.map(d.Chnl.encode),Mpng:e.values}})}:{}),filterID:0x43727673});case"brightness/contrast":return n(n({},t),{Fltr:{_name:"Brightness/Contrast",_classID:"BrgC",Brgh:e.filter.brightness,Cntr:e.filter.contrast,useLegacy:!!e.filter.useLegacy},filterID:0x42726743});default:throw Error("Unknow filter type: ".concat(e.type))}}(e)})}),a.warp&&D(a.warp)){var s=S(a.warp);o.quiltWarp=s,o.warp={warpStyle:"warpStyle.warpNone",warpValue:s.warpValue,warpPerspective:s.warpPerspective,warpPerspectiveOther:s.warpPerspectiveOther,warpRotate:s.warpRotate,bounds:s.bounds,uOrder:s.uOrder,vOrder:s.vOrder}}else delete o.quiltWarp;a.comp&&(o.comp=a.comp),a.compInfo&&(o.compInfo=a.compInfo),(0,d.writeVersionAndDescriptor)(e,"","null",o,o.quiltWarp?"quiltWarp":"warp")}),h("SoLE","SoLd"),m("fxrp",y("referencePoint"),function(e,t){t.referencePoint={x:(0,s.readFloat64)(e),y:(0,s.readFloat64)(e)}},function(e,t){(0,l.writeFloat64)(e,t.referencePoint.x),(0,l.writeFloat64)(e,t.referencePoint.y)}),m("Lr16",function(){return!1},function(e,t,r,n,i){(0,s.readLayerInfo)(e,n,i)},function(e,t){}),m("Lr32",function(){return!1},function(e,t,r,n,i){(0,s.readLayerInfo)(e,n,i)},function(e,t){}),m("LMsk",y("userMask"),function(e,t){if(t.userMask={colorSpace:(0,s.readColor)(e),opacity:(0,s.readUint16)(e)/255},128!==(0,s.readUint8)(e))throw Error("Invalid flag value");(0,s.skipBytes)(e,1)},function(e,t){var r=t.userMask;(0,l.writeColor)(e,r.colorSpace),(0,l.writeUint16)(e,255*(0,o.clamp)(r.opacity,0,1)),(0,l.writeUint8)(e,128),(0,l.writeZeros)(e,1)}),o.MOCK_HANDLERS?m("Patt",function(e){return void 0!==e._Patt},function(e,t,r){t._Patt=(0,s.readBytes)(e,r())},function(e,t){return!1}):m("Patt",function(e){return!e},function(e,t,r){r()&&(0,s.skipBytes)(e,r())},function(e,t){}),o.MOCK_HANDLERS&&m("CAI ",function(e){return void 0!==e._CAI_},function(e,t,r){t._CAI_=(0,s.readBytes)(e,r())},function(e,t){(0,l.writeBytes)(e,t._CAI_)}),o.MOCK_HANDLERS&&m("OCIO",function(e){return void 0!==e._OCIO},function(e,t,r){t._OCIO=(0,s.readBytes)(e,r())},function(e,t){(0,l.writeBytes)(e,t._OCIO)}),o.MOCK_HANDLERS&&m("GenI",function(e){return void 0!==e._GenI},function(e,t,n){var i=(0,d.readVersionAndDescriptor)(e,!0);console.log("GenI",r(634).inspect(i,!1,99,!0)),t._GenI=(0,s.readBytes)(e,n())},function(e,t){(0,l.writeBytes)(e,t._GenI)}),m("Anno",function(e){return void 0!==e.annotations},function(e,t,r){var n=(0,s.readUint16)(e),i=(0,s.readUint16)(e);if(2!==n||1!==i)throw Error("Invalid Anno version");for(var a=(0,s.readUint32)(e),o=[],l=0;l<a;l++){(0,s.readUint32)(e);var d=(0,s.readSignature)(e),c=!!(0,s.readUint8)(e);(0,s.readUint8)(e),(0,s.readUint16)(e);var u=B(e),p=B(e),f=(0,s.readColor)(e),m=(0,s.readPascalString)(e,2),h=(0,s.readPascalString)(e,2),y=(0,s.readPascalString)(e,2);(0,s.readUint32)(e),(0,s.readSignature)(e);var v=(0,s.readUint32)(e),g=void 0;if("txtA"===d)v>=2&&65279===(0,s.readUint16)(e)?g=(0,s.readUnicodeStringWithLength)(e,(v-2)/2):(e.offset-=2,g=(0,s.readAsciiString)(e,v)),g=g.replace(/\r/g,"\n");else if("sndA"===d)g=(0,s.readBytes)(e,v);else throw Error("Unknown annotation type");o.push({type:"txtA"===d?"text":"sound",open:c,iconLocation:u,popupLocation:p,color:f,author:m,name:h,date:y,data:g})}t.annotations=o,(0,s.skipBytes)(e,r())},function(e,t){var r=t.annotations;(0,l.writeUint16)(e,2),(0,l.writeUint16)(e,1),(0,l.writeUint32)(e,r.length);for(var n=0;n<r.length;n++){var i=r[n],a="sound"===i.type;if(a&&!(i.data instanceof Uint8Array))throw Error("Sound annotation data should be Uint8Array");if(!a&&"string"!=typeof i.data)throw Error("Text annotation data should be string");var o=e.offset;(0,l.writeUint32)(e,0),(0,l.writeSignature)(e,a?"sndA":"txtA"),(0,l.writeUint8)(e,+!!i.open),(0,l.writeUint8)(e,28),(0,l.writeUint16)(e,1),O(e,i.iconLocation),O(e,i.popupLocation),(0,l.writeColor)(e,i.color),(0,l.writePascalString)(e,i.author||"",2),(0,l.writePascalString)(e,i.name||"",2),(0,l.writePascalString)(e,i.date||"",2);var s=e.offset;(0,l.writeUint32)(e,0),(0,l.writeSignature)(e,a?"sndM":"txtC"),(0,l.writeUint32)(e,0);var d=e.offset;if(a)(0,l.writeBytes)(e,i.data);else{(0,l.writeUint16)(e,65279);for(var c=i.data.replace(/\n/g,"\r"),u=0;u<c.length;u++)(0,l.writeUint16)(e,c.charCodeAt(u))}e.view.setUint32(o,e.offset-o,!1),e.view.setUint32(s,e.offset-s,!1),e.view.setUint32(d-4,e.offset-d,!1)}}),T("lnk2"),T("lnkE"),h("lnkD","lnk2"),h("lnk3","lnk2"),m("pths",y("pathList"),function(e,t){(0,d.readVersionAndDescriptor)(e,!0),t.pathList=[]},function(e,t){(0,d.writeVersionAndDescriptor)(e,"","pathsDataClass",{pathList:[]})}),m("lyvr",y("version"),function(e,t){return t.version=(0,s.readUint32)(e)},function(e,t){return(0,l.writeUint32)(e,t.version)}),m("lfxs",function(){return!1},function(e,t,r){if(0!==(0,s.readUint32)(e))throw Error("Invalid lfxs version");var n=(0,d.readVersionAndDescriptor)(e);t.effects=(0,d.parseEffects)(n,!!e.logMissingFeatures),(0,s.skipBytes)(e,r())},function(e,t,r,n){var i=(0,d.serializeEffects)(t.effects,!!n.logMissingFeatures,!0);(0,l.writeUint32)(e,0),(0,d.writeVersionAndDescriptor)(e,"","null",i)}),m("brit",V("brightness/contrast"),function(e,t,r){t.adjustment||(t.adjustment={type:"brightness/contrast",brightness:(0,s.readInt16)(e),contrast:(0,s.readInt16)(e),meanValue:(0,s.readInt16)(e),labColorOnly:!!(0,s.readUint8)(e),useLegacy:!0}),(0,s.skipBytes)(e,r())},function(e,t){var r,n=t.adjustment;(0,l.writeInt16)(e,n.brightness||0),(0,l.writeInt16)(e,n.contrast||0),(0,l.writeInt16)(e,null!=(r=n.meanValue)?r:127),(0,l.writeUint8)(e,+!!n.labColorOnly),(0,l.writeZeros)(e,1)}),m("levl",V("levels"),function(e,t,r){if(2!==(0,s.readUint16)(e))throw Error("Invalid levl version");t.adjustment=n(n({},t.adjustment),{type:"levels",rgb:M(e),red:M(e),green:M(e),blue:M(e)}),(0,s.skipBytes)(e,r())},function(e,t){var r=t.adjustment,n={shadowInput:0,highlightInput:255,shadowOutput:0,highlightOutput:255,midtoneInput:1};(0,l.writeUint16)(e,2),R(e,r.rgb||n),R(e,r.red||n),R(e,r.blue||n),R(e,r.green||n);for(var i=0;i<59;i++)R(e,n)}),m("curv",V("curves"),function(e,t,r){if((0,s.readUint8)(e),1!==(0,s.readUint16)(e))throw Error("Invalid curv version");(0,s.readUint16)(e);var i=(0,s.readUint16)(e),a={type:"curves"};1&i&&(a.rgb=_(e)),2&i&&(a.red=_(e)),4&i&&(a.green=_(e)),8&i&&(a.blue=_(e)),t.adjustment=n(n({},t.adjustment),a),(0,s.skipBytes)(e,r())},function(e,t){var r=t.adjustment,n=r.rgb,i=r.red,a=r.green,o=r.blue,s=0,d=0;n&&n.length&&(s|=1,d++),i&&i.length&&(s|=2,d++),a&&a.length&&(s|=4,d++),o&&o.length&&(s|=8,d++),(0,l.writeUint8)(e,0),(0,l.writeUint16)(e,1),(0,l.writeUint16)(e,0),(0,l.writeUint16)(e,s),n&&n.length&&z(e,n),i&&i.length&&z(e,i),a&&a.length&&z(e,a),o&&o.length&&z(e,o),(0,l.writeSignature)(e,"Crv "),(0,l.writeUint16)(e,4),(0,l.writeUint16)(e,0),(0,l.writeUint16)(e,d),n&&n.length&&((0,l.writeUint16)(e,0),z(e,n)),i&&i.length&&((0,l.writeUint16)(e,1),z(e,i)),a&&a.length&&((0,l.writeUint16)(e,2),z(e,a)),o&&o.length&&((0,l.writeUint16)(e,3),z(e,o))}),m("expA",V("exposure"),function(e,t,r){if(1!==(0,s.readUint16)(e))throw Error("Invalid expA version");t.adjustment=n(n({},t.adjustment),{type:"exposure",exposure:(0,s.readFloat32)(e),offset:(0,s.readFloat32)(e),gamma:(0,s.readFloat32)(e)}),(0,s.skipBytes)(e,r())},function(e,t){var r=t.adjustment;(0,l.writeUint16)(e,1),(0,l.writeFloat32)(e,r.exposure),(0,l.writeFloat32)(e,r.offset),(0,l.writeFloat32)(e,r.gamma),(0,l.writeZeros)(e,2)}),m("vibA",V("vibrance"),function(e,t,r){var n=(0,d.readVersionAndDescriptor)(e);t.adjustment={type:"vibrance"},void 0!==n.vibrance&&(t.adjustment.vibrance=n.vibrance),void 0!==n.Strt&&(t.adjustment.saturation=n.Strt),(0,s.skipBytes)(e,r())},function(e,t){var r=t.adjustment,n={};void 0!==r.vibrance&&(n.vibrance=r.vibrance),void 0!==r.saturation&&(n.Strt=r.saturation),(0,d.writeVersionAndDescriptor)(e,"","null",n)}),m("hue2",V("hue/saturation"),function(e,t,r){if(2!==(0,s.readUint16)(e))throw Error("Invalid hue2 version");t.adjustment=n(n({},t.adjustment),{type:"hue/saturation",master:N(e),reds:N(e),yellows:N(e),greens:N(e),cyans:N(e),blues:N(e),magentas:N(e)}),(0,s.skipBytes)(e,r())},function(e,t){var r=t.adjustment;(0,l.writeUint16)(e,2),W(e,r.master),W(e,r.reds),W(e,r.yellows),W(e,r.greens),W(e,r.cyans),W(e,r.blues),W(e,r.magentas)}),m("blnc",V("color balance"),function(e,t,r){t.adjustment={type:"color balance",shadows:j(e),midtones:j(e),highlights:j(e),preserveLuminosity:!!(0,s.readUint8)(e)},(0,s.skipBytes)(e,r())},function(e,t){var r=t.adjustment;H(e,r.shadows||{}),H(e,r.midtones||{}),H(e,r.highlights||{}),(0,l.writeUint8)(e,+!!r.preserveLuminosity),(0,l.writeZeros)(e,1)}),m("blwh",V("black & white"),function(e,t,r){var n=(0,d.readVersionAndDescriptor)(e);t.adjustment={type:"black & white",reds:n["Rd  "],yellows:n.Yllw,greens:n["Grn "],cyans:n["Cyn "],blues:n["Bl  "],magentas:n.Mgnt,useTint:!!n.useTint,presetKind:n.bwPresetKind,presetFileName:n.blackAndWhitePresetFileName},void 0!==n.tintColor&&(t.adjustment.tintColor=(0,d.parseColor)(n.tintColor)),(0,s.skipBytes)(e,r())},function(e,t){var r=t.adjustment,n={"Rd  ":r.reds||0,Yllw:r.yellows||0,"Grn ":r.greens||0,"Cyn ":r.cyans||0,"Bl  ":r.blues||0,Mgnt:r.magentas||0,useTint:!!r.useTint,tintColor:(0,d.serializeColor)(r.tintColor),bwPresetKind:r.presetKind||0,blackAndWhitePresetFileName:r.presetFileName||""};(0,d.writeVersionAndDescriptor)(e,"","null",n)}),m("phfl",V("photo filter"),function(e,t,r){var n=(0,s.readUint16)(e);if(2!==n&&3!==n)throw Error("Invalid phfl version");t.adjustment={type:"photo filter",color:2===n?(0,s.readColor)(e):{l:(0,s.readInt32)(e)/100,a:(0,s.readInt32)(e)/100,b:(0,s.readInt32)(e)/100},density:(0,s.readUint32)(e)/100,preserveLuminosity:!!(0,s.readUint8)(e)},(0,s.skipBytes)(e,r())},function(e,t){var r=t.adjustment;(0,l.writeUint16)(e,2),(0,l.writeColor)(e,r.color||{l:0,a:0,b:0}),(0,l.writeUint32)(e,100*(r.density||0)),(0,l.writeUint8)(e,+!!r.preserveLuminosity),(0,l.writeZeros)(e,3)}),m("mixr",V("channel mixer"),function(e,t,r){if(1!==(0,s.readUint16)(e))throw Error("Invalid mixr version");var i=t.adjustment=n(n({},t.adjustment),{type:"channel mixer",monochrome:!!(0,s.readUint16)(e)});i.monochrome||(i.red=G(e),i.green=G(e),i.blue=G(e)),i.gray=G(e),(0,s.skipBytes)(e,r())},function(e,t){var r=t.adjustment;(0,l.writeUint16)(e,1),(0,l.writeUint16)(e,+!!r.monochrome),r.monochrome?(Z(e,r.gray),(0,l.writeZeros)(e,30)):(Z(e,r.red),Z(e,r.green),Z(e,r.blue),Z(e,r.gray))});var q=(0,o.createEnum)("colorLookupType","3DLUT",{"3dlut":"3DLUT",abstractProfile:"abstractProfile",deviceLinkProfile:"deviceLinkProfile"}),X=(0,o.createEnum)("LUTFormatType","look",{look:"LUTFormatLOOK",cube:"LUTFormatCUBE","3dl":"LUTFormat3DL"}),K=(0,o.createEnum)("colorLookupOrder","rgb",{rgb:"rgbOrder",bgr:"bgrOrder"});m("clrL",V("color lookup"),function(e,t,r){if(1!==(0,s.readUint16)(e))throw Error("Invalid clrL version");var n=(0,d.readVersionAndDescriptor)(e);t.adjustment={type:"color lookup"};var i=t.adjustment;void 0!==n.lookupType&&(i.lookupType=q.decode(n.lookupType)),void 0!==n["Nm  "]&&(i.name=n["Nm  "]),void 0!==n.Dthr&&(i.dither=n.Dthr),void 0!==n.profile&&(i.profile=n.profile),void 0!==n.LUTFormat&&(i.lutFormat=X.decode(n.LUTFormat)),void 0!==n.dataOrder&&(i.dataOrder=K.decode(n.dataOrder)),void 0!==n.tableOrder&&(i.tableOrder=K.decode(n.tableOrder)),void 0!==n.LUT3DFileData&&(i.lut3DFileData=n.LUT3DFileData),void 0!==n.LUT3DFileName&&(i.lut3DFileName=n.LUT3DFileName),(0,s.skipBytes)(e,r())},function(e,t){var r=t.adjustment,n={};void 0!==r.lookupType&&(n.lookupType=q.encode(r.lookupType)),void 0!==r.name&&(n["Nm  "]=r.name),void 0!==r.dither&&(n.Dthr=r.dither),void 0!==r.profile&&(n.profile=r.profile),void 0!==r.lutFormat&&(n.LUTFormat=X.encode(r.lutFormat)),void 0!==r.dataOrder&&(n.dataOrder=K.encode(r.dataOrder)),void 0!==r.tableOrder&&(n.tableOrder=K.encode(r.tableOrder)),void 0!==r.lut3DFileData&&(n.LUT3DFileData=r.lut3DFileData),void 0!==r.lut3DFileName&&(n.LUT3DFileName=r.lut3DFileName),(0,l.writeUint16)(e,1),(0,d.writeVersionAndDescriptor)(e,"","null",n)}),m("nvrt",V("invert"),function(e,t,r){t.adjustment={type:"invert"},(0,s.skipBytes)(e,r())},function(){}),m("post",V("posterize"),function(e,t,r){t.adjustment={type:"posterize",levels:(0,s.readUint16)(e)},(0,s.skipBytes)(e,r())},function(e,t){var r,n=t.adjustment;(0,l.writeUint16)(e,null!=(r=n.levels)?r:4),(0,l.writeZeros)(e,2)}),m("thrs",V("threshold"),function(e,t,r){t.adjustment={type:"threshold",level:(0,s.readUint16)(e)},(0,s.skipBytes)(e,r())},function(e,t){var r,n=t.adjustment;(0,l.writeUint16)(e,null!=(r=n.level)?r:128),(0,l.writeZeros)(e,2)});var Y=["","","","rgb","hsb","","lab"];function Q(e){return{c:(0,s.readInt16)(e),m:(0,s.readInt16)(e),y:(0,s.readInt16)(e),k:(0,s.readInt16)(e)}}function J(e,t){var r=t||{};(0,l.writeInt16)(e,r.c),(0,l.writeInt16)(e,r.m),(0,l.writeInt16)(e,r.y),(0,l.writeInt16)(e,r.k)}function $(e){return Object.keys(e).map(function(t){return e[t]}).some(function(e){return Array.isArray(e)&&e.length>1})}m("grdm",V("gradient map"),function(e,t,r){var n=(0,s.readUint16)(e);if(1!==n&&3!==n)throw Error("Invalid grdm version");var i={type:"gradient map",gradientType:"solid"};i.reverse=!!(0,s.readUint8)(e),i.dither=!!(0,s.readUint8)(e);var a=!!(0,s.readUint8)(e);if(e.offset--,a){var o=(0,s.readSignature)(e);i.method=d.gradientInterpolationMethodType.decode(o)}i.name=(0,s.readUnicodeString)(e),i.colorStops=[],i.opacityStops=[];for(var l=(0,s.readUint16)(e),c=0;c<l;c++)i.colorStops.push({location:(0,s.readUint32)(e),midpoint:(0,s.readUint32)(e)/100,color:(0,s.readColor)(e)}),(0,s.skipBytes)(e,2);for(var u=(0,s.readUint16)(e),c=0;c<u;c++)i.opacityStops.push({location:(0,s.readUint32)(e),midpoint:(0,s.readUint32)(e)/100,opacity:(0,s.readUint16)(e)/255});if(2!==(0,s.readUint16)(e))throw Error("Invalid grdm expansion count");var p=(0,s.readUint16)(e);if(i.smoothness=p/4096,32!==(0,s.readUint16)(e))throw Error("Invalid grdm length");i.gradientType=(0,s.readUint16)(e)?"noise":"solid",i.randomSeed=(0,s.readUint32)(e),i.addTransparency=!!(0,s.readUint16)(e),i.restrictColors=!!(0,s.readUint16)(e),i.roughness=(0,s.readUint32)(e)/4096,i.colorModel=Y[(0,s.readUint16)(e)]||"rgb",i.min=[(0,s.readUint16)(e)/32768,(0,s.readUint16)(e)/32768,(0,s.readUint16)(e)/32768,(0,s.readUint16)(e)/32768],i.max=[(0,s.readUint16)(e)/32768,(0,s.readUint16)(e)/32768,(0,s.readUint16)(e)/32768,(0,s.readUint16)(e)/32768],(0,s.skipBytes)(e,r());for(var f=0,m=i.colorStops;f<m.length;f++){var h=m[f];h.location/=p}for(var y=0,v=i.opacityStops;y<v.length;y++){var h=v[y];h.location/=p}t.adjustment=i},function(e,t){var r,n,i,a=t.adjustment;(0,l.writeUint16)(e,void 0!==a.method?3:1),(0,l.writeUint8)(e,+!!a.reverse),(0,l.writeUint8)(e,+!!a.dither),void 0!==a.method&&(0,l.writeSignature)(e,d.gradientInterpolationMethodType.encode(a.method)),(0,l.writeUnicodeStringWithPadding)(e,a.name||""),(0,l.writeUint16)(e,a.colorStops&&a.colorStops.length||0);for(var o=Math.round((null!=(r=a.smoothness)?r:1)*4096),s=0,c=a.colorStops||[];s<c.length;s++){var u=c[s];(0,l.writeUint32)(e,Math.round(u.location*o)),(0,l.writeUint32)(e,Math.round(100*u.midpoint)),(0,l.writeColor)(e,u.color),(0,l.writeZeros)(e,2)}(0,l.writeUint16)(e,a.opacityStops&&a.opacityStops.length||0);for(var p=0,f=a.opacityStops||[];p<f.length;p++){var u=f[p];(0,l.writeUint32)(e,Math.round(u.location*o)),(0,l.writeUint32)(e,Math.round(100*u.midpoint)),(0,l.writeUint16)(e,Math.round(255*u.opacity))}(0,l.writeUint16)(e,2),(0,l.writeUint16)(e,o),(0,l.writeUint16)(e,32),(0,l.writeUint16)(e,+("noise"===a.gradientType)),(0,l.writeUint32)(e,a.randomSeed||0),(0,l.writeUint16)(e,+!!a.addTransparency),(0,l.writeUint16)(e,+!!a.restrictColors),(0,l.writeUint32)(e,Math.round((null!=(n=a.roughness)?n:1)*4096));var m=Y.indexOf(null!=(i=a.colorModel)?i:"rgb");(0,l.writeUint16)(e,-1===m?3:m);for(var h=0;h<4;h++)(0,l.writeUint16)(e,Math.round(32768*(a.min&&a.min[h]||0)));for(var h=0;h<4;h++)(0,l.writeUint16)(e,Math.round(32768*(a.max&&a.max[h]||0)));(0,l.writeZeros)(e,4)}),m("selc",V("selective color"),function(e,t){if(1!==(0,s.readUint16)(e))throw Error("Invalid selc version");var r=(0,s.readUint16)(e)?"absolute":"relative";(0,s.skipBytes)(e,8),t.adjustment={type:"selective color",mode:r,reds:Q(e),yellows:Q(e),greens:Q(e),cyans:Q(e),blues:Q(e),magentas:Q(e),whites:Q(e),neutrals:Q(e),blacks:Q(e)}},function(e,t){var r=t.adjustment;(0,l.writeUint16)(e,1),(0,l.writeUint16)(e,+("absolute"===r.mode)),(0,l.writeZeros)(e,8),J(e,r.reds),J(e,r.yellows),J(e,r.greens),J(e,r.cyans),J(e,r.blues),J(e,r.magentas),J(e,r.whites),J(e,r.neutrals),J(e,r.blacks)}),m("CgEd",function(e){var t=e.adjustment;return!!t&&("brightness/contrast"===t.type&&!t.useLegacy||("levels"===t.type||"curves"===t.type||"exposure"===t.type||"channel mixer"===t.type||"hue/saturation"===t.type)&&void 0!==t.presetFileName)},function(e,t,r){var i=(0,d.readVersionAndDescriptor)(e);if(1!==i.Vrsn)throw Error("Invalid CgEd version");"presetFileName"in i?t.adjustment=n(n({},t.adjustment),{presetKind:i.presetKind,presetFileName:i.presetFileName}):"curvesPresetFileName"in i?t.adjustment=n(n({},t.adjustment),{presetKind:i.curvesPresetKind,presetFileName:i.curvesPresetFileName}):"mixerPresetFileName"in i?t.adjustment=n(n({},t.adjustment),{presetKind:i.mixerPresetKind,presetFileName:i.mixerPresetFileName}):t.adjustment={type:"brightness/contrast",brightness:i.Brgh,contrast:i.Cntr,meanValue:i.means,useLegacy:!!i.useLegacy,labColorOnly:!!i["Lab "],auto:!!i.Auto},(0,s.skipBytes)(e,r())},function(e,t){var r,n,i,a,o=t.adjustment;if("levels"===o.type||"exposure"===o.type||"hue/saturation"===o.type){var s={Vrsn:1,presetKind:null!=(r=o.presetKind)?r:1,presetFileName:o.presetFileName||""};(0,d.writeVersionAndDescriptor)(e,"","null",s)}else if("curves"===o.type){var s={Vrsn:1,curvesPresetKind:null!=(n=o.presetKind)?n:1,curvesPresetFileName:o.presetFileName||""};(0,d.writeVersionAndDescriptor)(e,"","null",s)}else if("channel mixer"===o.type){var s={Vrsn:1,mixerPresetKind:null!=(i=o.presetKind)?i:1,mixerPresetFileName:o.presetFileName||""};(0,d.writeVersionAndDescriptor)(e,"","null",s)}else if("brightness/contrast"===o.type){var s={Vrsn:1,Brgh:o.brightness||0,Cntr:o.contrast||0,means:null!=(a=o.meanValue)?a:127,"Lab ":!!o.labColorOnly,useLegacy:!!o.useLegacy,Auto:!!o.auto};(0,d.writeVersionAndDescriptor)(e,"","null",s)}else throw Error("Unhandled CgEd case")}),m("Txt2",y("engineData"),function(e,t,r,n){var a,o=(0,s.readBytes)(e,r());t.engineData=(0,i.fromByteArray)(o);var l=(a=[],!function e(t){var r;if(t.children)for(var n=0,i=t.children;n<i.length;n++){var o=i[n];(null==(r=o.text)?void 0:r.index)!==void 0&&(a[o.text.index]=o),e(o)}}(n),a),d=(0,c.parseEngineData)(o),u=(0,p.decodeEngineData2)(d).ResourceDict.TextFrameSet;if(u)for(var f=0;f<u.length;f++){var m=l[f];u[f].path&&(null==m?void 0:m.text)&&(m.text.textPath=u[f].path)}},function(e,t){var r=(0,i.toByteArray)(t.engineData);(0,l.writeBytes)(e,r)}),m("FEid",y("filterEffectsMasks"),function(e,t,r){var n=(0,s.readInt32)(e);if(n<1||n>3)throw Error("Invalid filterEffects version ".concat(n));for(t.filterEffectsMasks=[];r()>8;){if((0,s.readUint32)(e))throw Error("filterEffects: 64 bit length is not supported");var i=(0,s.readUint32)(e),a=e.offset+i,o=(0,s.readPascalString)(e,1),l=(0,s.readInt32)(e);if(1!==l)throw Error("Invalid filterEffect version ".concat(l));if((0,s.readUint32)(e))throw Error("filterEffect: 64 bit length is not supported");(0,s.readUint32)(e);for(var d=(0,s.readInt32)(e),c=(0,s.readInt32)(e),u=(0,s.readInt32)(e),p=(0,s.readInt32)(e),f=(0,s.readInt32)(e),m=(0,s.readInt32)(e),h=[],y=0;y<m+2;y++)if((0,s.readInt32)(e)){if((0,s.readUint32)(e))throw Error("filterEffect: 64 bit length is not supported");var v=(0,s.readUint32)(e);if(!v)throw Error("filterEffect: Empty channel");var g=(0,s.readUint16)(e),w=(0,s.readBytes)(e,v-2);h.push({compressionMode:g,data:w})}else h.push(void 0);if(t.filterEffectsMasks.push({id:o,top:d,left:c,bottom:u,right:p,depth:f,channels:h}),e.offset<a&&(0,s.readUint8)(e)){var F=(0,s.readInt32)(e),I=(0,s.readInt32)(e),b=(0,s.readInt32)(e),D=(0,s.readInt32)(e);if((0,s.readUint32)(e))throw Error("filterEffect: 64 bit length is not supported");var S=(0,s.readUint32)(e),g=(0,s.readUint16)(e),w=(0,s.readBytes)(e,S-2);t.filterEffectsMasks[t.filterEffectsMasks.length-1].extra={top:F,left:I,bottom:b,right:D,compressionMode:g,data:w}}e.offset=a;for(var x=i;x%4;)e.offset++,x++}},function(e,t){var r;(0,l.writeInt32)(e,3);for(var n=0,i=t.filterEffectsMasks;n<i.length;n++){var a=i[n];(0,l.writeUint32)(e,0),(0,l.writeUint32)(e,0);var o=e.offset;(0,l.writePascalString)(e,a.id,1),(0,l.writeInt32)(e,1),(0,l.writeUint32)(e,0),(0,l.writeUint32)(e,0);var s=e.offset;(0,l.writeInt32)(e,a.top),(0,l.writeInt32)(e,a.left),(0,l.writeInt32)(e,a.bottom),(0,l.writeInt32)(e,a.right),(0,l.writeInt32)(e,a.depth);var d=Math.max(0,a.channels.length-2);(0,l.writeInt32)(e,d);for(var c=0;c<d+2;c++){var u=a.channels[c];(0,l.writeInt32)(e,+!!u),u&&((0,l.writeUint32)(e,0),(0,l.writeUint32)(e,u.data.length+2),(0,l.writeUint16)(e,u.compressionMode),(0,l.writeBytes)(e,u.data))}e.view.setUint32(s-4,e.offset-s,!1);var p=null==(r=t.filterEffectsMasks[t.filterEffectsMasks.length-1])?void 0:r.extra;p&&((0,l.writeUint8)(e,1),(0,l.writeInt32)(e,p.top),(0,l.writeInt32)(e,p.left),(0,l.writeInt32)(e,p.bottom),(0,l.writeInt32)(e,p.right),(0,l.writeUint32)(e,0),(0,l.writeUint32)(e,p.data.byteLength+2),(0,l.writeUint16)(e,p.compressionMode),(0,l.writeBytes)(e,p.data));var f=e.offset-o;for(e.view.setUint32(o-4,f,!1);f%4;)(0,l.writeZeros)(e,1),f++}}),h("FXid","FEid"),m("FMsk",y("filterMask"),function(e,t){t.filterMask={colorSpace:(0,s.readColor)(e),opacity:(0,s.readUint16)(e)/255}},function(e,t){var r;(0,l.writeColor)(e,t.filterMask.colorSpace),(0,l.writeUint16)(e,255*(0,o.clamp)(null!=(r=t.filterMask.opacity)?r:1,0,1))}),m("artd",function(e){return void 0!==e.artboards},function(e,t,r){var n=(0,d.readVersionAndDescriptor)(e);t.artboards={count:n["Cnt "],autoExpandOffset:{horizontal:n.autoExpandOffset.Hrzn,vertical:n.autoExpandOffset.Vrtc},origin:{horizontal:n.origin.Hrzn,vertical:n.origin.Vrtc},autoExpandEnabled:n.autoExpandEnabled,autoNestEnabled:n.autoNestEnabled,autoPositionEnabled:n.autoPositionEnabled,shrinkwrapOnSaveEnabled:!!n.shrinkwrapOnSaveEnabled,docDefaultNewArtboardBackgroundColor:(0,d.parseColor)(n.docDefaultNewArtboardBackgroundColor),docDefaultNewArtboardBackgroundType:n.docDefaultNewArtboardBackgroundType},(0,s.skipBytes)(e,r())},function(e,t){var r,n,i,a,o,s=t.artboards,l={"Cnt ":s.count,autoExpandOffset:s.autoExpandOffset?{Hrzn:s.autoExpandOffset.horizontal,Vrtc:s.autoExpandOffset.vertical}:{Hrzn:0,Vrtc:0},origin:s.origin?{Hrzn:s.origin.horizontal,Vrtc:s.origin.vertical}:{Hrzn:0,Vrtc:0},autoExpandEnabled:null==(r=s.autoExpandEnabled)||r,autoNestEnabled:null==(n=s.autoNestEnabled)||n,autoPositionEnabled:null==(i=s.autoPositionEnabled)||i,shrinkwrapOnSaveEnabled:null==(a=s.shrinkwrapOnSaveEnabled)||a,docDefaultNewArtboardBackgroundColor:(0,d.serializeColor)(s.docDefaultNewArtboardBackgroundColor),docDefaultNewArtboardBackgroundType:null!=(o=s.docDefaultNewArtboardBackgroundType)?o:1};(0,d.writeVersionAndDescriptor)(e,"","null",l,"artd")}),t.hasMultiEffects=$,m("lfx2",function(e){return void 0!==e.effects&&!$(e.effects)},function(e,t,r){if(0!==(0,s.readUint32)(e))throw Error("Invalid lfx2 version");var n=(0,d.readVersionAndDescriptor)(e);t.effects=(0,d.parseEffects)(n,!!e.logMissingFeatures),(0,s.skipBytes)(e,r())},function(e,t,r,n){var i=(0,d.serializeEffects)(t.effects,!!n.logMissingFeatures,!0);(0,l.writeUint32)(e,0),(0,d.writeVersionAndDescriptor)(e,"","null",i)}),m("cinf",y("compositorUsed"),function(e,t,r){var n=(0,d.readVersionAndDescriptor)(e);function i(e){return e.split(".")[1]}t.compositorUsed={description:n.description,reason:n.reason,engine:i(n.Engn)},n.Vrsn&&(t.compositorUsed.version=n.Vrsn),n.psVersion&&(t.compositorUsed.photoshopVersion=n.psVersion),n.enableCompCore&&(t.compositorUsed.enableCompCore=i(n.enableCompCore)),n.enableCompCoreGPU&&(t.compositorUsed.enableCompCoreGPU=i(n.enableCompCoreGPU)),n.enableCompCoreThreads&&(t.compositorUsed.enableCompCoreThreads=i(n.enableCompCoreThreads)),n.compCoreSupport&&(t.compositorUsed.compCoreSupport=i(n.compCoreSupport)),n.compCoreGPUSupport&&(t.compositorUsed.compCoreGPUSupport=i(n.compCoreGPUSupport)),(0,s.skipBytes)(e,r())},function(e,t){var r=t.compositorUsed,n={Vrsn:r.version||{major:1,minor:0,fix:0}};r.photoshopVersion&&(n.psVersion=r.photoshopVersion),n.description=r.description,n.reason=r.reason,n.Engn="Engn.".concat(r.engine),r.enableCompCore&&(n.enableCompCore="enable.".concat(r.enableCompCore)),r.enableCompCoreGPU&&(n.enableCompCoreGPU="enable.".concat(r.enableCompCoreGPU)),r.enableCompCoreThreads&&(n.enableCompCoreThreads="enable.".concat(r.enableCompCoreThreads)),r.compCoreSupport&&(n.compCoreSupport="reason.".concat(r.compCoreSupport)),r.compCoreGPUSupport&&(n.compCoreGPUSupport="reason.".concat(r.compCoreGPUSupport)),(0,d.writeVersionAndDescriptor)(e,"","null",n)}),m("extn",function(e){return void 0!==e._extn},function(e,t){var r=(0,d.readVersionAndDescriptor)(e);o.MOCK_HANDLERS&&(t._extn=r)},function(e,t){o.MOCK_HANDLERS&&(0,d.writeVersionAndDescriptor)(e,"","null",t._extn)}),m("iOpa",y("fillOpacity"),function(e,t){t.fillOpacity=(0,s.readUint8)(e)/255,(0,s.skipBytes)(e,3)},function(e,t){(0,l.writeUint8)(e,255*t.fillOpacity),(0,l.writeZeros)(e,3)}),m("brst",y("channelBlendingRestrictions"),function(e,t,r){for(t.channelBlendingRestrictions=[];r()>4;)t.channelBlendingRestrictions.push((0,s.readInt32)(e))},function(e,t){for(var r=0,n=t.channelBlendingRestrictions;r<n.length;r++){var i=n[r];(0,l.writeInt32)(e,i)}}),m("tsly",y("transparencyShapesLayer"),function(e,t){t.transparencyShapesLayer=!!(0,s.readUint8)(e),(0,s.skipBytes)(e,3)},function(e,t){(0,l.writeUint8)(e,+!!t.transparencyShapesLayer),(0,l.writeZeros)(e,3)})}}]);