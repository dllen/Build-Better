"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[420],{5421:(e,t,r)=>{r.d(t,{E2:()=>f,HV:()=>o,jW:()=>E});var a=r(78752),s=r(18365),n=r(32096);let i={A4:{width:595.28,height:841.89},LETTER:{width:612,height:792},LEGAL:{width:612,height:1008},A5:{width:419.53,height:595.28},A3:{width:841.89,height:1190.55},CUSTOM:{width:595.28,height:841.89}},o=[{id:"helvetica",name:"Helvetica (Sans-serif)",type:"standard"},{id:"times",name:"Times (Serif)",type:"standard"},{id:"courier",name:"Courier (Monospace)",type:"standard"},{id:"noto-sans",name:"Noto Sans (Latin/Cyrillic)",type:"noto",url:"https://raw.githack.com/googlefonts/noto-fonts/main/hinted/ttf/NotoSans/NotoSans-Regular.ttf"},{id:"noto-sans-sc",name:"Noto Sans SC (简体中文)",type:"noto",url:"https://raw.githack.com/googlefonts/noto-cjk/main/Sans/OTF/SimplifiedChinese/NotoSansCJKsc-Regular.otf"},{id:"noto-sans-tc",name:"Noto Sans TC (繁體中文)",type:"noto",url:"https://raw.githack.com/googlefonts/noto-cjk/main/Sans/OTF/TraditionalChinese/NotoSansCJKtc-Regular.otf"},{id:"noto-sans-jp",name:"Noto Sans JP (日本語)",type:"noto",url:"https://raw.githack.com/googlefonts/noto-cjk/main/Sans/OTF/Japanese/NotoSansCJKjp-Regular.otf"},{id:"noto-sans-kr",name:"Noto Sans KR (한국어)",type:"noto",url:"https://raw.githack.com/googlefonts/noto-cjk/main/Sans/OTF/Korean/NotoSansCJKkr-Regular.otf"},{id:"noto-sans-arabic",name:"Noto Sans Arabic (العربية)",type:"noto",url:"https://raw.githack.com/googlefonts/noto-fonts/main/hinted/ttf/NotoSansArabic/NotoSansArabic-Regular.ttf"},{id:"noto-sans-hebrew",name:"Noto Sans Hebrew (עברית)",type:"noto",url:"https://raw.githack.com/googlefonts/noto-fonts/main/hinted/ttf/NotoSansHebrew/NotoSansHebrew-Regular.ttf"},{id:"noto-sans-thai",name:"Noto Sans Thai (ไทย)",type:"noto",url:"https://raw.githack.com/googlefonts/noto-fonts/main/hinted/ttf/NotoSansThai/NotoSansThai-Regular.ttf"},{id:"noto-sans-devanagari",name:"Noto Sans Devanagari (हिन्दी)",type:"noto",url:"https://raw.githack.com/googlefonts/noto-fonts/main/unhinted/ttf/NotoSansDevanagari/NotoSansDevanagari-Regular.ttf"}],c={pageSize:"A4",orientation:"portrait",fontId:"helvetica",fontSize:12,lineHeight:1.5,textColor:{r:0,g:0,b:0},margin:{top:72,right:72,bottom:72,left:72},preserveLineBreaks:!0,wrapLines:!0},l=new Map,u="fonts";async function d(){return new Promise((e,t)=>{let r=indexedDB.open("pdfcraft-fonts",1);r.onerror=()=>t(r.error),r.onsuccess=()=>e(r.result),r.onupgradeneeded=e=>{let t=e.target.result;t.objectStoreNames.contains(u)||t.createObjectStore(u)}})}async function p(e){try{let t=await d();return new Promise((r,a)=>{let s=t.transaction(u,"readonly").objectStore(u).get(e);s.onsuccess=()=>r(s.result||null),s.onerror=()=>a(s.error)})}catch(e){return null}}async function h(e,t){try{let r=await d();return new Promise((a,s)=>{let n=r.transaction(u,"readwrite").objectStore(u).put(t,e);n.onsuccess=()=>a(),n.onerror=()=>s(n.error)})}catch(e){}}async function g(e,t){if(l.has(e))return l.get(e);let r=await p(e);if(r)return l.set(e,r),r;let a=await fetch(t);if(!a.ok)throw Error("Failed to load font: ".concat(e));let s=await a.arrayBuffer();return l.set(e,s),await h(e,s),s}function f(e){let t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16)/255,g:parseInt(t[2],16)/255,b:parseInt(t[3],16)/255}:{r:0,g:0,b:0}}class P extends s.A{async process(e,t){this.reset(),this.onProgress=t;let{files:s,options:i}=e,l={...c,...i},u=l.directText&&l.directText.trim().length>0;if(s.length<1&&!u)return this.createErrorOutput(a.GS.INVALID_OPTIONS,"At least 1 text file or direct text input is required.","Received ".concat(s.length," file(s) and no direct text."));try{let e;this.updateProgress(5,"Loading PDF library...");let t=await (0,n.Ck)();if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");this.updateProgress(10,"Reading text...");let i="";if(u)i=l.directText;else for(let e of s){let t=await e.text();i+=t+"\n\n"}this.updateProgress(20,"Loading font...");let c=await t.PDFDocument.create(),d=o.find(e=>e.id===l.fontId)||o[0];if("standard"===d.type){let r={helvetica:"Helvetica",times:"TimesRoman",courier:"Courier"}[d.id]||"Helvetica";e=await c.embedFont(t.StandardFonts[r])}else{let t=await Promise.all([r.e(897),r.e(429)]).then(r.bind(r,16625));c.registerFontkit(t.default||t),this.updateProgress(30,"Downloading font...");let a=await g(d.id,d.url);this.updateProgress(40,"Embedding font..."),e=await c.embedFont(a,{subset:!1})}this.updateProgress(50,"Creating PDF pages..."),await this.createPdfFromText(c,i,l,e,t),this.updateProgress(90,"Saving PDF...");let p=await c.save({useObjectStreams:!0}),h=new Blob([new Uint8Array(p)],{type:"application/pdf"});this.updateProgress(100,"Complete!");let f=u?"from_text.pdf":this.generateOutputFilename(s);return this.createSuccessOutput(h,f,{pageCount:c.getPageCount(),fileCount:u?0:s.length})}catch(e){return this.createErrorOutput(a.GS.PROCESSING_FAILED,"Failed to convert text to PDF.",e instanceof Error?e.message:"Unknown error")}}async createPdfFromText(e,t,r,a,s){let n,o;if("CUSTOM"===r.pageSize&&r.customWidth&&r.customHeight)n=r.customWidth,o=r.customHeight;else{let e=i[r.pageSize]||i.A4;n=e.width,o=e.height}"landscape"===r.orientation&&([n,o]=[o,n]);let c=r.margin,l=r.fontSize,u=l*r.lineHeight,d=r.textColor,p=n-c.left-c.right,h=e.addPage([n,o]),g=o-c.top;for(let r of t.split("\n")){if(""===r.trim()){(g-=u)<c.bottom&&(h=e.addPage([n,o]),g=o-c.top);continue}let t=r.split(" "),i="";for(let r of t){let t;if(!r)continue;let f=i?"".concat(i," ").concat(r):r;try{t=a.widthOfTextAtSize(f,l)}catch(e){continue}if(t>p&&i){try{h.drawText(i,{x:c.left,y:g,size:l,font:a,color:s.rgb(d.r,d.g,d.b)})}catch(e){}(g-=u)<c.bottom&&(h=e.addPage([n,o]),g=o-c.top),i=r}else i=f}if(i){try{h.drawText(i,{x:c.left,y:g,size:l,font:a,color:s.rgb(d.r,d.g,d.b)})}catch(e){}(g-=u)<c.bottom&&(h=e.addPage([n,o]),g=o-c.top)}}}generateOutputFilename(e){if(1===e.length){let t=e[0].name.replace(/\.[^/.]+$/,"");return"".concat(t,".pdf")}return"text_".concat(e.length,"_files.pdf")}getAcceptedTypes(){return["text/plain",".txt"]}}async function E(e,t,r){return new P().process({files:e,options:t||{}},r)}},6268:(e,t,r)=>{r.d(t,{parsePageSelection:()=>c,ut:()=>l});var a=r(78752),s=r(18365),n=r(32096);let i={pages:[]};class o extends s.A{async process(e,t){this.reset(),this.onProgress=t;let{files:r,options:s}=e,o={...i,...s};if(1!==r.length)return this.createErrorOutput(a.GS.INVALID_OPTIONS,"Exactly 1 PDF file is required for extraction.","Received ".concat(r.length," file(s)."));if(!o.pages||0===o.pages.length)return this.createErrorOutput(a.GS.INVALID_OPTIONS,"At least one page is required for extraction.","Please specify pages to extract.");try{let e;this.updateProgress(5,"Loading PDF library...");let t=await (0,n.Ck)();if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");this.updateProgress(10,"Loading source PDF...");let s=r[0],i=await s.arrayBuffer();try{e=await t.PDFDocument.load(i,{ignoreEncryption:!1})}catch(e){if(e instanceof Error&&e.message.includes("encrypt"))return this.createErrorOutput(a.GS.PDF_ENCRYPTED,"The PDF file is encrypted.","Please decrypt the file before extracting pages.");throw e}let c=e.getPageCount();this.updateProgress(20,"Source PDF has ".concat(c," pages."));let l=function(e,t){if(0===e.length)return"No pages specified for extraction.";for(let r=0;r<e.length;r++){let a=e[r];if(!Number.isInteger(a))return"Invalid page number: ".concat(a);if(a<1)return"Page number must be at least 1. Found ".concat(a,".");if(a>t)return"Page ".concat(a," exceeds total pages (").concat(t,").")}return null}(o.pages,c);if(l)return this.createErrorOutput(a.GS.INVALID_PAGE_RANGE,l,"The PDF has ".concat(c," pages."));let u=[...new Set(o.pages)].sort((e,t)=>e-t);if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");this.updateProgress(30,"Creating new document...");let d=await t.PDFDocument.create(),p=60/u.length;for(let t=0;t<u.length;t++){if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");let r=u[t],s=r-1;this.updateProgress(30+t*p,"Extracting page ".concat(r,"..."));let[n]=await d.copyPages(e,[s]);d.addPage(n)}this.updateProgress(90,"Saving extracted pages...");let h=await d.save({useObjectStreams:!0}),g=new Blob([new Uint8Array(h)],{type:"application/pdf"});this.updateProgress(100,"Complete!");let f=function(e,t){let r=function(e){let t=e.lastIndexOf(".");return -1===t?e:e.slice(0,t)}(e);return 1===t.length?"".concat(r,"_page_").concat(t[0],".pdf"):t.length<=3?"".concat(r,"_pages_").concat(t.join("-"),".pdf"):"".concat(r,"_").concat(t.length,"_pages_extracted.pdf")}(s.name,u);return this.createSuccessOutput(g,f,{extractedPageCount:u.length,originalPageCount:c,extractedPages:u})}catch(e){return this.createErrorOutput(a.GS.PROCESSING_FAILED,"Failed to extract pages from PDF file.",e instanceof Error?e.message:"Unknown error")}}getAcceptedTypes(){return["application/pdf"]}}function c(e,t){let r=[];for(let a of e.split(",").map(e=>e.trim()).filter(e=>e.length>0))if(a.includes("-")){let[e,s]=a.split("-").map(e=>e.trim()),n=parseInt(e,10),i=parseInt(s,10);if(!isNaN(n)&&!isNaN(i)&&n<=i)for(let e=n;e<=Math.min(i,t);e++)e>=1&&r.push(e)}else{let e=parseInt(a,10);!isNaN(e)&&e>=1&&e<=t&&r.push(e)}return[...new Set(r)].sort((e,t)=>e-t)}async function l(e,t,r){return new o().process({files:[e],options:{pages:t}},r)}},8202:(e,t,r)=>{r.d(t,{z0:()=>h});var a=r(78752),s=r(18365);let n={allowPrinting:!0,allowHighQualityPrinting:!0,allowModifying:!0,allowCopying:!0,allowAnnotating:!0,allowFillingForms:!0,allowContentAccessibility:!0,allowDocumentAssembly:!0},i={permissions:n,currentPassword:"",newUserPassword:"",newOwnerPassword:""},o=null,c=null,l=[];async function u(){return o||c||(c=new Promise((e,t)=>{if(window.Module&&"function"==typeof window.Module)return void d(e,t);let r=document.createElement("script");r.src="/qpdf.js",r.async=!0,r.onload=()=>{d(e,t)},r.onerror=()=>{c=null,t(Error("Failed to load QPDF script"))},document.head.appendChild(r)}))}function d(e,t){try{let r=window.Module;if(!r||"function"!=typeof r)return void t(Error("QPDF module not found after script load"));r({locateFile:e=>e.endsWith(".wasm")?"/qpdf.wasm":e}).then(t=>{o=t,e(t)}).catch(e=>{c=null,t(e)})}catch(e){c=null,t(e)}}class p extends s.A{async process(e,t){let r;this.reset(),this.onProgress=t;let{files:s,options:o}=e,c={...i,...o,permissions:{...n,...(null==o?void 0:o.permissions)||{}}};if(1!==s.length)return this.createErrorOutput(a.GS.INVALID_OPTIONS,"Please provide exactly one PDF file.","Received ".concat(s.length," file(s)."));let d=s[0],p="/input.pdf",h="/output.pdf";try{if(this.updateProgress(5,"Initializing PDF engine..."),r=await u(),this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");this.updateProgress(15,"Reading PDF file...");let e=await d.arrayBuffer(),t=e.byteLength,s=new Uint8Array(e);if(r.FS.writeFile(p,s),this.updateProgress(30,"Preparing permission changes..."),this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");this.updateProgress(50,"Processing PDF permissions...");let n=[p];c.currentPassword&&n.push("--password="+c.currentPassword);let i=c.newUserPassword||c.newOwnerPassword;if(i){let e=c.newUserPassword||"",t=c.newOwnerPassword||"";n.push("--encrypt",e,t,"256");let r=c.permissions;t?(r.allowModifying||n.push("--modify=none"),r.allowCopying||n.push("--extract=n"),r.allowPrinting||n.push("--print=none"),r.allowAnnotating||n.push("--annotate=n"),r.allowDocumentAssembly||n.push("--assemble=n"),r.allowFillingForms||n.push("--form=n"),r.allowContentAccessibility||n.push("--accessibility=n")):e&&n.push("--allow-insecure")}else n.push("--decrypt");n.push("--",h),l=[];let o=console.error;console.error=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];let a=t.map(e=>String(e)).join(" ");l.push(a),o.apply(console,t)};let g=null;try{r.callMain(n)}catch(e){g=e}finally{console.error=o}let f=!1,P=null;try{f=!!((P=r.FS.readFile(h,{encoding:"binary"}))&&P.length>0)}catch(e){f=!1}if(!f){let e=l.join(" ").toLowerCase(),t=e.includes("invalid password")||e.includes("incorrect password")||e.includes("wrong password");if(t||g){let e=g?String(g.message||g||"").toLowerCase():"";if(t||e.includes("invalid password")||e.includes("incorrect password")||e.includes("wrong password")||e.includes("password"))return this.createErrorOutput(a.GS.PDF_ENCRYPTED,"INVALID_PASSWORD","The current password you entered is incorrect. Please check and try again.");if(e.includes("encrypted")||e.includes("password required"))return this.createErrorOutput(a.GS.PDF_ENCRYPTED,"PASSWORD_REQUIRED","This PDF is password-protected. Please enter the current password to proceed.");throw g||Error("Processing failed")}return this.createErrorOutput(a.GS.PDF_ENCRYPTED,"INVALID_PASSWORD","The current password you entered is incorrect. Please check and try again.")}if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");this.updateProgress(80,"Preparing output file...");let E=new Blob([new Uint8Array(P)],{type:"application/pdf"}),w=P.length;try{r.FS.unlink(p)}catch(e){console.warn("Failed to unlink input file:",e)}try{r.FS.unlink(h)}catch(e){console.warn("Failed to unlink output file:",e)}this.updateProgress(100,"Complete!");let m=function(e){let t=e.lastIndexOf("."),r=-1===t?e:e.slice(0,t);return"".concat(r,"_permissions.pdf")}(d.name);return this.createSuccessOutput(E,m,{originalSize:t,newSize:w,permissions:c.permissions,encrypted:i,encryptionMethod:i?"256-bit AES":void 0})}catch(e){if(null==r?void 0:r.FS){try{r.FS.unlink(p)}catch(e){}try{r.FS.unlink(h)}catch(e){}}return this.createErrorOutput(a.GS.PROCESSING_FAILED,"Failed to change PDF permissions.",e instanceof Error?e.message:"Unknown error")}}getAcceptedTypes(){return["application/pdf"]}}async function h(e,t,r){return new p().process({files:[e],options:t||{}},r)}},8519:(e,t,r)=>{r.d(t,{cU:()=>l});var a=r(78752),s=r(18365),n=r(32096);let i={pagesPerSheet:4,customCols:2,customRows:2,pageSize:"A4",orientation:"auto",layoutDirection:"horizontal",useMargins:!0,addBorder:!1,borderColor:"#000000"},o={A4:[595.28,841.89],Letter:[612,792],Legal:[612,1008],A3:[841.89,1190.55]};class c extends s.A{async process(e,t){this.reset(),this.onProgress=t;let{files:r,options:s}=e,c={...i,...s};if(1!==r.length)return this.createErrorOutput(a.GS.INVALID_OPTIONS,"Exactly 1 PDF file is required.","Received ".concat(r.length," file(s)."));try{let e;this.updateProgress(5,"Loading PDF library...");let t=await (0,n.Ck)();if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");this.updateProgress(10,"Loading source PDF...");let s=r[0],i=await s.arrayBuffer();try{e=await t.PDFDocument.load(i,{ignoreEncryption:!0})}catch(e){if(e instanceof Error&&e.message.includes("encrypt"))return this.createErrorOutput(a.GS.PDF_ENCRYPTED,"The PDF file is encrypted.","Please decrypt the file first.");throw e}let l=e.getPages(),u=l.length;if(this.updateProgress(20,"Source PDF has ".concat(u," pages.")),this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");let d=function(e){if("custom"===e.pagesPerSheet)return[Math.max(1,Math.min(10,e.customCols)),Math.max(1,Math.min(10,e.customRows))];let t=e.pagesPerSheet;if("vertical"===e.layoutDirection)switch(t){case 2:return[1,2];case 4:default:return[2,2];case 9:return[3,3];case 16:return[4,4]}switch(t){case 2:return[2,1];case 4:default:return[2,2];case 9:return[3,3];case 16:return[4,4]}}(c),p=d[0]*d[1],[h,g]=o[c.pageSize],f=c.orientation;if("auto"===f){let e=l[0];f=e.getWidth()>e.getHeight()&&d[0]>d[1]?"landscape":"portrait"}"landscape"===f&&h<g&&([h,g]=[g,h]);let P=36*!!c.useMargins,E=10*!!c.useMargins,w=h-2*P,m=g-2*P,S=(w-E*(d[0]-1))/d[0],y=(m-E*(d[1]-1))/d[1];this.updateProgress(30,"Creating N-Up PDF...");let C=await t.PDFDocument.create(),O=Math.ceil(u/p),D=50/O,F=function(e){let t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16)/255,g:parseInt(t[2],16)/255,b:parseInt(t[3],16)/255}:{r:0,g:0,b:0}}(c.borderColor);this.updateProgress(35,"Embedding pages...");let I=await C.embedPages(l);if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");for(let e=0;e<u;e+=p){if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");let r=Math.floor(e/p)+1;this.updateProgress(40+(r-1)*D,"Processing sheet ".concat(r," of ").concat(O,"..."));let s=C.addPage([h,g]);for(let r=0;r<p&&e+r<u;r++){let a=I[e+r],n=Math.min(S/a.width,y/a.height),i=a.width*n,o=a.height*n,l=Math.floor(r/d[0]),u=r%d[0],p=P+u*(S+E),h=g-P-(l+1)*y-l*E,f=p+(S-i)/2,w=h+(y-o)/2;s.drawPage(a,{x:f,y:w,width:i,height:o}),c.addBorder&&s.drawRectangle({x:f,y:w,width:i,height:o,borderColor:t.rgb(F.r,F.g,F.b),borderWidth:1})}}this.updateProgress(90,"Saving PDF...");let L=await C.save({useObjectStreams:!0}),v=new Blob([new Uint8Array(L)],{type:"application/pdf"});this.updateProgress(100,"Complete!");let k="custom"===c.pagesPerSheet?"".concat(d[0],"x").concat(d[1]):"".concat(p,"-up"),A=function(e,t){let r=function(e){let t=e.lastIndexOf(".");return -1===t?e:e.slice(0,t)}(e);return"".concat(r,"_").concat(t,".pdf")}(s.name,k);return this.createSuccessOutput(v,A,{originalPageCount:u,outputSheetCount:O,pagesPerSheet:p,gridLayout:"".concat(d[0],"\xd7").concat(d[1])})}catch(e){return this.createErrorOutput(a.GS.PROCESSING_FAILED,"Failed to create N-Up PDF.",e instanceof Error?e.message:"Unknown error")}}getAcceptedTypes(){return["application/pdf"]}}async function l(e,t,r){return new c().process({files:[e],options:t},r)}},9941:(e,t,r)=>{r.d(t,{Oo:()=>u});var a=r(78752),s=r(18365),n=r(32096);let i={preserveBookmarks:!0,pageOrder:"sequential"};class o extends s.A{async process(e,t){this.reset(),this.onProgress=t;let{files:r,options:s}=e,o={...i,...s};if(r.length<2)return this.createErrorOutput(a.GS.INVALID_OPTIONS,"At least 2 PDF files are required for merging.","Received ".concat(r.length," file(s)."));try{this.updateProgress(5,"Loading PDF library...");let e=await (0,n.Ck)();if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");this.updateProgress(10,"Creating merged document...");let t=await e.PDFDocument.create(),s=[],i=0,u=80/r.length;for(let n=0;n<r.length;n++){if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");let c=r[n],d=10+n*u;this.updateProgress(d,"Processing file ".concat(n+1," of ").concat(r.length,": ").concat(c.name));try{let r=await c.arrayBuffer(),a=await e.PDFDocument.load(r,{ignoreEncryption:!1}),n=a.getPageCount();for(let e of(await t.copyPages(a,a.getPageIndices())))t.addPage(e);o.preserveBookmarks&&s.push({title:l(c.name),pageIndex:i,pageCount:n}),i+=n}catch(e){if(e instanceof Error&&e.message.includes("encrypt"))return this.createErrorOutput(a.GS.PDF_ENCRYPTED,'File "'.concat(c.name,'" is encrypted.'),"Please decrypt the file before merging.");return this.createErrorOutput(a.GS.PROCESSING_FAILED,'Failed to process file "'.concat(c.name,'".'),e instanceof Error?e.message:"Unknown error")}}this.updateProgress(90,"Adding bookmarks..."),o.preserveBookmarks&&s.length>0&&await c(t,s),this.updateProgress(95,"Saving merged PDF...");let d=await t.save({useObjectStreams:!0}),p=new Blob([new Uint8Array(d)],{type:"application/pdf"});this.updateProgress(100,"Complete!");let h=function(e){if(0===e.length)return"merged.pdf";let t=l(e[0].name);if(2===e.length){let r=l(e[1].name);return"".concat(t,"_").concat(r,"_merged.pdf")}return"".concat(t,"_and_").concat(e.length-1,"_more_merged.pdf")}(r);return this.createSuccessOutput(p,h,{pageCount:i,fileCount:r.length,bookmarkCount:s.length})}catch(e){return this.createErrorOutput(a.GS.PROCESSING_FAILED,"Failed to merge PDF files.",e instanceof Error?e.message:"Unknown error")}}getAcceptedTypes(){return["application/pdf"]}}async function c(e,t){let r=await (0,n.Ck)(),a=e.context,s=e.catalog,i=[];for(let s=0;s<t.length;s++){let n=t[s],o=e.getPage(n.pageIndex).ref,c=r.PDFArray.withContext(a);c.push(o),c.push(r.PDFName.of("XYZ")),c.push(r.PDFNull),c.push(r.PDFNull),c.push(r.PDFNull);let l=r.PDFDict.withContext(a);l.set(r.PDFName.of("Title"),r.PDFHexString.fromText(n.title)),l.set(r.PDFName.of("Dest"),c);let u=a.register(l);i.push(u)}let o=r.PDFDict.withContext(a);o.set(r.PDFName.of("Type"),r.PDFName.of("Outlines")),o.set(r.PDFName.of("Count"),r.PDFNumber.of(t.length));let c=a.register(o);for(let e=0;e<i.length;e++){let t=i[e],s=a.lookup(t);s.set(r.PDFName.of("Parent"),c),e>0&&s.set(r.PDFName.of("Prev"),i[e-1]),e<i.length-1&&s.set(r.PDFName.of("Next"),i[e+1])}i.length>0&&(o.set(r.PDFName.of("First"),i[0]),o.set(r.PDFName.of("Last"),i[i.length-1])),s.set(r.PDFName.of("Outlines"),c)}function l(e){let t=e.lastIndexOf(".");return -1===t?e:e.slice(0,t)}async function u(e,t,r){return new o().process({files:e,options:t||{}},r)}},11922:(e,t,r)=>{r.d(t,{eB:()=>c});var a=r(78752),s=r(18365),n=r(32096);let i={pageOrder:[]};class o extends s.A{async process(e,t){this.reset(),this.onProgress=t;let{files:r,options:s}=e,o={...i,...s};if(1!==r.length)return this.createErrorOutput(a.GS.INVALID_OPTIONS,"Exactly 1 PDF file is required for organizing.","Received ".concat(r.length," file(s)."));if(!o.pageOrder||0===o.pageOrder.length)return this.createErrorOutput(a.GS.INVALID_OPTIONS,"Page order is required for organizing.","Please specify the new page order.");try{let e;this.updateProgress(5,"Loading PDF library...");let t=await (0,n.Ck)();if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");this.updateProgress(10,"Loading source PDF...");let s=r[0],i=await s.arrayBuffer();try{e=await t.PDFDocument.load(i,{ignoreEncryption:!1})}catch(e){if(e instanceof Error&&e.message.includes("encrypt"))return this.createErrorOutput(a.GS.PDF_ENCRYPTED,"The PDF file is encrypted.","Please decrypt the file before organizing.");throw e}let c=e.getPageCount();this.updateProgress(20,"Source PDF has ".concat(c," pages."));let l=function(e,t){if(0===e.length)return"Page order cannot be empty.";for(let r=0;r<e.length;r++){let a=e[r];if(!Number.isInteger(a))return"Invalid page number at position ".concat(r+1,": ").concat(a);if(a<1)return"Page number must be at least 1. Found ".concat(a," at position ").concat(r+1,".");if(a>t)return"Page ".concat(a," exceeds total pages (").concat(t,").")}return null}(o.pageOrder,c);if(l)return this.createErrorOutput(a.GS.INVALID_PAGE_RANGE,l,"The PDF has ".concat(c," pages."));if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");this.updateProgress(30,"Creating new document...");let u=await t.PDFDocument.create(),d=60/o.pageOrder.length;for(let t=0;t<o.pageOrder.length;t++){if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");let r=o.pageOrder[t],s=r-1;this.updateProgress(30+t*d,"Copying page ".concat(r,"..."));let[n]=await u.copyPages(e,[s]);u.addPage(n)}this.updateProgress(90,"Saving reorganized PDF...");let p=await u.save({useObjectStreams:!0}),h=new Blob([new Uint8Array(p)],{type:"application/pdf"});this.updateProgress(100,"Complete!");let g=function(e){let t=function(e){let t=e.lastIndexOf(".");return -1===t?e:e.slice(0,t)}(e);return"".concat(t,"_organized.pdf")}(s.name);return this.createSuccessOutput(h,g,{pageCount:o.pageOrder.length,originalPageCount:c})}catch(e){return this.createErrorOutput(a.GS.PROCESSING_FAILED,"Failed to organize PDF file.",e instanceof Error?e.message:"Unknown error")}}getAcceptedTypes(){return["application/pdf"]}}async function c(e,t,r){return new o().process({files:[e],options:{pageOrder:t}},r)}},13206:(e,t,r)=>{r.d(t,{OH:()=>u});var a=r(78752),s=r(18365);let n=null,i=null;async function o(){return n||i||(i=new Promise((e,t)=>{if(window.Module&&"function"==typeof window.Module)return void c(e,t);let r=document.createElement("script");r.src="/qpdf.js",r.async=!0,r.onload=()=>{c(e,t)},r.onerror=()=>{i=null,t(Error("Failed to load QPDF script"))},document.head.appendChild(r)}))}function c(e,t){try{let r=window.Module;if(!r||"function"!=typeof r)return void t(Error("QPDF module not found after script load"));r({locateFile:e=>e.endsWith(".wasm")?"/qpdf.wasm":e}).then(t=>{n=t,e(t)}).catch(e=>{i=null,t(e)})}catch(e){i=null,t(e)}}class l extends s.A{async process(e,t){let r;this.reset(),this.onProgress=t;let{files:s}=e;if(1!==s.length)return this.createErrorOutput(a.GS.INVALID_OPTIONS,"Please provide exactly one PDF file to repair.","Received ".concat(s.length," file(s)."));let n=s[0],i="/input.pdf",c="/output.pdf";try{if(this.updateProgress(5,"Initializing repair engine..."),r=await o(),this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");this.updateProgress(15,"Reading PDF file...");let e=await n.arrayBuffer(),t=e.byteLength,s=new Uint8Array(e);if(r.FS.writeFile(i,s),this.updateProgress(30,"Analyzing PDF structure..."),this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");this.updateProgress(50,"Repairing PDF...");let l=[i,"--decrypt",c];try{r.callMain(l)}catch(e){console.warn("QPDF execution warning:",e)}let u=null,d=!1;try{d=!!((u=r.FS.readFile(c,{encoding:"binary"}))&&u.length>0)}catch(e){d=!1}if(!d)return this.createErrorOutput(a.GS.PDF_MALFORMED,"Unable to repair the PDF file.","The file may be too corrupted to recover.");if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");this.updateProgress(80,"Saving repaired PDF...");let p=new Blob([new Uint8Array(u)],{type:"application/pdf"}),h=u.length;try{r.FS.unlink(i)}catch(e){console.warn("Failed to unlink input file:",e)}try{r.FS.unlink(c)}catch(e){console.warn("Failed to unlink output file:",e)}this.updateProgress(100,"Complete!");let g=function(e){let t=e.lastIndexOf("."),r=-1===t?e:e.slice(0,t);return"".concat(r,"_repaired.pdf")}(n.name);return this.createSuccessOutput(p,g,{originalSize:t,repairedSize:h,repaired:!0})}catch(e){if(null==r?void 0:r.FS){try{r.FS.unlink(i)}catch(e){}try{r.FS.unlink(c)}catch(e){}}return this.createErrorOutput(a.GS.PROCESSING_FAILED,"Failed to repair PDF file.",e instanceof Error?e.message:"Unknown error")}}getAcceptedTypes(){return["application/pdf"]}}async function u(e,t,r){return new l().process({files:[e],options:t||{}},r)}},14169:(e,t,r)=>{r.d(t,{bs:()=>c});var a=r(78752),s=r(18365),n=r(32096);let i={scale:2,pages:[],method:"luminosity"};class o extends s.A{async process(e,t){this.reset(),this.onProgress=t;let{files:r,options:s}=e,o={...i,...s};if(1!==r.length)return this.createErrorOutput(a.GS.INVALID_OPTIONS,"Please provide exactly one PDF file.","Received ".concat(r.length," file(s)."));let c=r[0];if(!c.type.includes("pdf")&&!c.name.toLowerCase().endsWith(".pdf"))return this.createErrorOutput(a.GS.FILE_TYPE_INVALID,"Invalid file type. Please upload a PDF file.","Received: ".concat(c.type||"unknown"));try{this.updateProgress(5,"Loading PDF libraries...");let[e,t]=await Promise.all([(0,n.Ck)(),(0,n.Iy)()]);if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");this.updateProgress(10,"Loading PDF document...");let r=await c.arrayBuffer(),s=await t.getDocument({data:r}).promise,i=s.numPages,l=await e.PDFDocument.create(),u=o.pages.length>0?o.pages.filter(e=>e>=1&&e<=i):Array.from({length:i},(e,t)=>t+1);if(0===u.length)return this.createErrorOutput(a.GS.INVALID_PAGE_RANGE,"No valid pages to convert.","PDF has ".concat(i," pages."));this.updateProgress(15,"Converting ".concat(u.length," page(s) to greyscale..."));let d=80/u.length;for(let e=0;e<u.length;e++){if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");let t=u[e],r=15+e*d;this.updateProgress(r,"Converting page ".concat(t," of ").concat(i," to greyscale..."));try{await this.convertPageToGreyscale(s,l,t,o)}catch(e){return this.createErrorOutput(a.GS.PROCESSING_FAILED,"Failed to convert page ".concat(t," to greyscale."),e instanceof Error?e.message:"Unknown error")}}this.updateProgress(95,"Saving PDF...");let p=await l.save({useObjectStreams:!0}),h=new Blob([new Uint8Array(p)],{type:"application/pdf"});this.updateProgress(100,"Complete!");let g=c.name.replace(/\.pdf$/i,"");return this.createSuccessOutput(h,"".concat(g,"_greyscale.pdf"),{pageCount:u.length,method:o.method})}catch(e){return this.createErrorOutput(a.GS.PROCESSING_FAILED,"Failed to convert PDF to greyscale.",e instanceof Error?e.message:"Unknown error")}}async convertPageToGreyscale(e,t,r,a){let s=await e.getPage(r),n=s.getViewport({scale:a.scale}),i=document.createElement("canvas");i.width=n.width,i.height=n.height;let o=i.getContext("2d");if(!o)throw Error("Failed to get canvas context");o.fillStyle="#ffffff",o.fillRect(0,0,i.width,i.height),await s.render({canvasContext:o,viewport:n}).promise;let c=o.getImageData(0,0,i.width,i.height);this.applyGreyscale(c,a.method),o.putImageData(c,0,0);let l=await new Promise((e,t)=>{i.toBlob(r=>r?e(r):t(Error("Failed to create image")),"image/png")}),u=await l.arrayBuffer(),d=await t.embedPng(new Uint8Array(u)),p=n.width/a.scale,h=n.height/a.scale;t.addPage([p,h]).drawImage(d,{x:0,y:0,width:p,height:h})}applyGreyscale(e,t){let r=e.data;for(let e=0;e<r.length;e+=4){let a,s=r[e],n=r[e+1],i=r[e+2];switch(t){case"luminosity":default:a=Math.round(.2126*s+.7152*n+.0722*i);break;case"average":a=Math.round((s+n+i)/3);break;case"lightness":a=Math.round((Math.max(s,n,i)+Math.min(s,n,i))/2)}r[e]=a,r[e+1]=a,r[e+2]=a}}}async function c(e,t,r){return new o().process({files:[e],options:t||{}},r)}},14239:(e,t,r)=>{r.d(t,{Pf:()=>i});var a=r(78752),s=r(18365);class n extends s.A{async initWorker(){if(!this.worker)return new Promise((e,t)=>{try{this.worker=new Worker("/workers/mobi-to-pdf.worker.js",{type:"module"});let r=r=>{let{type:a,error:s,message:n}=r.data;"init-complete"===a?(this.workerReady=!0,e()):"status"===a?this.updateProgress(0,n):"error"===a&&t(Error(s||"Worker initialization failed"))};this.worker.addEventListener("message",r),this.worker.addEventListener("error",()=>{t(Error("Worker connection failed"))}),this.worker.postMessage({type:"init",id:"init-"+Date.now(),data:{}})}catch(e){t(e)}})}terminateWorker(){this.worker&&(this.worker.terminate(),this.worker=null,this.workerReady=!1)}reset(){super.reset()}async process(e,t){this.reset(),this.onProgress=t;let{files:r}=e;if(1!==r.length)return this.createErrorOutput(a.GS.INVALID_OPTIONS,"Please provide exactly one MOBI file.","Received ".concat(r.length," file(s)."));let s=r[0];if(!s.name.toLowerCase().endsWith(".mobi")&&!s.name.toLowerCase().endsWith(".azw")&&!s.name.toLowerCase().endsWith(".azw3"))return this.createErrorOutput(a.GS.FILE_TYPE_INVALID,"Invalid file type. Please upload a MOBI file (.mobi, .azw, .azw3).","Received: ".concat(s.type||s.name));try{this.updateProgress(10,"Initializing converter...");try{await this.initWorker()}catch(e){return console.error("Failed to initialize worker:",e),this.createErrorOutput(a.GS.WORKER_FAILED,"Failed to initialize conversion worker.",e instanceof Error?e.message:String(e))}if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");this.updateProgress(30,"Converting MOBI to PDF...");let e=await new Promise((e,t)=>{if(!this.worker)return void t(Error("Worker not initialized"));let r="convert-"+Date.now(),a=a=>{let{type:s,id:n,result:o,error:c,message:l}=a.data;if("status"===s)return void this.updateProgress(this.progress,l);n===r&&("convert-complete"===s?(i(),e(o)):"error"===s&&(i(),t(Error(c||"Conversion failed"))))},n=e=>{i(),t(Error("Worker error: "+e.message))},i=()=>{var e,t;null==(e=this.worker)||e.removeEventListener("message",a),null==(t=this.worker)||t.removeEventListener("error",n)};this.worker.addEventListener("message",a),this.worker.addEventListener("error",n),this.worker.postMessage({type:"convert",id:r,data:{file:s}})});if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");this.updateProgress(100,"Conversion complete!");let t=s.name.replace(/\.(mobi|azw|azw3)$/i,"");return this.createSuccessOutput(e,"".concat(t,".pdf"),{format:"pdf"})}catch(e){return console.error("Conversion error:",e),this.terminateWorker(),this.createErrorOutput(a.GS.PROCESSING_FAILED,"Failed to convert MOBI to PDF.",e instanceof Error?e.message:"Unknown error")}}constructor(...e){super(...e),this.worker=null,this.workerReady=!1}}async function i(e,t,r){return new n().process({files:[e],options:t||{}},r)}},14781:(e,t,r)=>{r.d(t,{xn:()=>o});var a=r(78752),s=r(18365),n=r(32096);class i extends s.A{async process(e,t){var r,s,i;this.reset(),this.onProgress=t;let{files:o,options:c}=e,l={color:null!=(r=c.color)?r:{r:1,g:1,b:.9},pages:null!=(s=c.pages)?s:"all",opacity:null!=(i=c.opacity)?i:1};if(1!==o.length)return this.createErrorOutput(a.GS.INVALID_OPTIONS,"Exactly 1 PDF file is required.");try{this.updateProgress(10,"Loading PDF library...");let e=await (0,n.Ck)();this.updateProgress(20,"Loading PDF...");let t=o[0],r=await t.arrayBuffer(),s=await e.PDFDocument.load(r,{ignoreEncryption:!0}),i=s.getPageCount(),c="all"===l.pages?Array.from({length:i},(e,t)=>t):l.pages.map(e=>e-1),u=await e.PDFDocument.create();this.updateProgress(30,"Embedding pages...");let d=s.getPages(),p=await u.embedPages(d);this.updateProgress(40,"Adding background color...");for(let t=0;t<i;t++){if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");let{width:r,height:s}=d[t].getSize(),n=u.addPage([r,s]);c.includes(t)&&n.drawRectangle({x:0,y:0,width:r,height:s,color:e.rgb(l.color.r,l.color.g,l.color.b),opacity:l.opacity});let o=p[t];n.drawPage(o,{x:0,y:0,width:r,height:s}),this.updateProgress(40+50*(t+1)/i,"Processing page ".concat(t+1,"..."))}this.updateProgress(95,"Saving PDF...");let h=await u.save({useObjectStreams:!0}),g=new Blob([new Uint8Array(h)],{type:"application/pdf"});return this.updateProgress(100,"Complete!"),this.createSuccessOutput(g,t.name.replace(".pdf","_background.pdf"),{pageCount:i})}catch(e){return this.createErrorOutput(a.GS.PROCESSING_FAILED,"Failed to add background color.",e instanceof Error?e.message:"Unknown error")}}getAcceptedTypes(){return["application/pdf"]}}async function o(e,t,r){return new i().process({files:[e],options:t},r)}},15781:(e,t,r)=>{r.d(t,{w4:()=>p});var a=r(78752),s=r(18365);let n={ownerPassword:""},i=null,o=null,c=[];async function l(){return i||o||(o=new Promise((e,t)=>{if(window.Module&&"function"==typeof window.Module)return void u(e,t);let r=document.createElement("script");r.src="/qpdf.js",r.async=!0,r.onload=()=>{u(e,t)},r.onerror=()=>{o=null,t(Error("Failed to load QPDF script"))},document.head.appendChild(r)}))}function u(e,t){try{let r=window.Module;if(!r||"function"!=typeof r)return void t(Error("QPDF module not found after script load"));r({locateFile:e=>e.endsWith(".wasm")?"/qpdf.wasm":e}).then(t=>{i=t,e(t)}).catch(e=>{o=null,t(e)})}catch(e){o=null,t(e)}}class d extends s.A{async process(e,t){let r;this.reset(),this.onProgress=t;let{files:s,options:i}=e,o={...n,...i};if(1!==s.length)return this.createErrorOutput(a.GS.INVALID_OPTIONS,"Please provide exactly one PDF file.","Received ".concat(s.length," file(s)."));let u=s[0],d="/input.pdf",p="/output.pdf";try{if(this.updateProgress(5,"Initializing..."),r=await l(),this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");this.updateProgress(15,"Reading PDF file...");let e=await u.arrayBuffer(),t=e.byteLength,s=new Uint8Array(e);if(r.FS.writeFile(d,s),this.updateProgress(30,"Preparing..."),this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");this.updateProgress(50,"Removing restrictions...");let n=[d];o.ownerPassword&&n.push("--password="+o.ownerPassword),n.push("--decrypt","--remove-restrictions","--",p),c=[];let i=console.error;console.error=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];let a=t.map(e=>String(e)).join(" ");c.push(a),i.apply(console,t)};let h=null;try{r.callMain(n)}catch(e){h=e}finally{console.error=i}let g=!1,f=null;try{g=!!((f=r.FS.readFile(p,{encoding:"binary"}))&&f.length>0)}catch(e){g=!1}if(!g){let e=c.join(" ").toLowerCase(),t=e.includes("invalid password")||e.includes("incorrect password")||e.includes("wrong password")||e.includes("password");if(t||h){let e=h?String(h.message||h||"").toLowerCase():"";if(t||e.includes("invalid password")||e.includes("incorrect password")||e.includes("wrong password")||e.includes("password"))return this.createErrorOutput(a.GS.INVALID_PASSWORD,"INVALID_PASSWORD","The password you entered is incorrect. Please check and try again.");throw h||Error("Failed to remove restrictions")}return this.createErrorOutput(a.GS.INVALID_PASSWORD,"INVALID_PASSWORD","The password you entered is incorrect. Please check and try again.")}if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");this.updateProgress(80,"Preparing file...");let P=new Blob([new Uint8Array(f)],{type:"application/pdf"}),E=f.length;try{r.FS.unlink(d)}catch(e){console.warn("Failed to unlink input file:",e)}try{r.FS.unlink(p)}catch(e){console.warn("Failed to unlink output file:",e)}this.updateProgress(100,"Complete!");let w=function(e){let t=e.lastIndexOf("."),r=-1===t?e:e.slice(0,t);return"".concat(r,"_unrestricted.pdf")}(u.name);return this.createSuccessOutput(P,w,{originalSize:t,newSize:E,restrictionsRemoved:!0})}catch(t){if(null==r?void 0:r.FS){try{r.FS.unlink(d)}catch(e){}try{r.FS.unlink(p)}catch(e){}}let e=String(t instanceof Error?t.message:t||"").toLowerCase();if(e.includes("invalid password")||e.includes("incorrect password")||e.includes("wrong password")||e.includes("password"))return this.createErrorOutput(a.GS.INVALID_PASSWORD,"INVALID_PASSWORD","The password you entered is incorrect. Please check and try again.");return this.createErrorOutput(a.GS.PROCESSING_FAILED,"Failed to remove PDF restrictions.",t instanceof Error?t.message:"Unknown error")}}getAcceptedTypes(){return["application/pdf"]}}async function p(e,t,r){return new d().process({files:[e],options:t||{}},r)}},16459:(e,t,r)=>{r.d(t,{tJ:()=>o});var a=r(78752),s=r(18365),n=r(32096);class i extends s.A{async process(e,t){this.reset(),this.onProgress=t;let{files:r,options:s}=e,i={position:"bottom-center",format:"number",startNumber:1,fontSize:12,fontColor:"#000000",margin:30,skipFirstPage:!1,prefix:"",suffix:"",customFormat:"Page {page} of {total}",...s};if(1!==r.length)return this.createErrorOutput(a.GS.INVALID_OPTIONS,"Exactly 1 PDF file is required.");try{this.updateProgress(10,"Loading PDF library...");let e=await (0,n.Ck)();this.updateProgress(20,"Loading PDF...");let t=r[0],s=await t.arrayBuffer(),o=await e.PDFDocument.load(s,{ignoreEncryption:!0}),c=await o.embedFont(e.StandardFonts.Helvetica),l=o.getPageCount(),u=new Set(i.skipPages||[]),d=i.fontColor||"#000000",p=parseInt(d.slice(1,3),16)/255,h=parseInt(d.slice(3,5),16)/255,g=parseInt(d.slice(5,7),16)/255,f=e.rgb(p,h,g);this.updateProgress(30,"Adding page numbers...");for(let e=0;e<l;e++){if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");let t=e+1,r=t%2==1,s=i.pageMode||"all";if(i.skipFirstPage&&1===t||u.has(t)||"odd-only"===s&&!r||"even-only"===s&&r)continue;let n=o.getPage(e),{width:d,height:p}=n.getSize(),h=(i.startNumber||1)+e-!!i.skipFirstPage,g=l-!!i.skipFirstPage,P="";switch(i.format){case"roman":P=function(e){let t="";for(let[r,a]of[[1e3,"M"],[900,"CM"],[500,"D"],[400,"CD"],[100,"C"],[90,"XC"],[50,"L"],[40,"XL"],[10,"X"],[9,"IX"],[5,"V"],[4,"IV"],[1,"I"]])for(;e>=r;)t+=a,e-=r;return t}(h);break;case"page-of-total":P="Page ".concat(h," of ").concat(g);break;case"custom":P=(i.customFormat||"Page {page} of {total}").replace(/{page}/g,String(h)).replace(/{total}/g,String(g));break;default:P=String(h)}P="".concat(i.prefix||"").concat(P).concat(i.suffix||"");let E=i.fontSize||12,w=i.margin||30,m=c.widthOfTextAtSize(P,E),S=0,y=0,C=i.position||"bottom-center";switch("odd-even-different"===s&&(r&&i.oddPosition?C=i.oddPosition:!r&&i.evenPosition&&(C=i.evenPosition)),C){case"bottom-left":S=w,y=w;break;case"bottom-right":S=d-m-w,y=w;break;case"top-center":S=(d-m)/2,y=p-w;break;case"top-left":S=w,y=p-w;break;case"top-right":S=d-m-w,y=p-w;break;default:S=(d-m)/2,y=w}n.drawText(P,{x:S,y,size:E,font:c,color:f}),this.updateProgress(30+60*(e+1)/l,"Processing page ".concat(t,"..."))}this.updateProgress(95,"Saving PDF...");let P=await o.save({useObjectStreams:!0}),E=new Blob([new Uint8Array(P)],{type:"application/pdf"});return this.updateProgress(100,"Complete!"),this.createSuccessOutput(E,t.name.replace(".pdf","_numbered.pdf"),{pageCount:l})}catch(e){return this.createErrorOutput(a.GS.PROCESSING_FAILED,"Failed to add page numbers.",e instanceof Error?e.message:"Unknown error")}}getAcceptedTypes(){return["application/pdf"]}}async function o(e,t,r){return new i().process({files:[e],options:t},r)}},17668:(e,t,r)=>{r.d(t,{GO:()=>i,nJ:()=>n});var a=r(78752);let s={maxSize:a.Q6.DEFAULT_MAX_SIZE,acceptedTypes:[...a.cK.PDF],requirePdf:!0};function n(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r={...s,...t},n=[];if(!e||0===e.size)return n.push(u(a.GS.FILE_EMPTY,"The file is empty or could not be read.")),{valid:!1,errors:n};if(r.maxSize&&r.maxSize!==1/0&&e.size>r.maxSize){let t=Math.round(r.maxSize/1048576);n.push(u(a.GS.FILE_TOO_LARGE,"File size exceeds the maximum limit of ".concat(t,"MB."),"File size: ".concat(function(e){if(0===e)return"0 Bytes";let t=Math.floor(Math.log(e)/Math.log(1024));return"".concat(parseFloat((e/Math.pow(1024,t)).toFixed(2))," ").concat(["Bytes","KB","MB","GB"][t])}(e.size),", Maximum: ").concat(t,"MB")))}if(r.acceptedTypes&&r.acceptedTypes.length>0){let t=r.acceptedTypes.includes(e.type)||r.acceptedTypes.some(t=>{if(t.endsWith("/*")){let r=t.slice(0,-2);return e.type.startsWith(r)}return!1}),s=e.name.toLowerCase().endsWith(".pdf"),i=r.acceptedTypes.includes("application/pdf");t||i&&s||n.push(u(a.GS.FILE_TYPE_INVALID,"Invalid file type. Expected: ".concat(r.acceptedTypes.join(", ")),"Received: ".concat(e.type||"unknown")))}return{valid:0===n.length,errors:n}}async function i(e){let t=[];try{var r;let s=await o(e,8);if((r=s).length<5||37!==r[0]||80!==r[1]||68!==r[2]||70!==r[3]||45!==r[4])return t.push(u(a.GS.FILE_NOT_PDF,"The file does not appear to be a valid PDF.","PDF files must start with %PDF-")),{valid:!1,errors:t};!function(e){if(e.length<8)return null;let t=String.fromCharCode(...e.slice(5,8)).trim();return/^\d\.\d/.test(t)?t:null}(s)&&t.push(u(a.GS.PDF_MALFORMED,"Could not determine PDF version.","The PDF header may be corrupted.")),await l(e)||t.push(u(a.GS.PDF_MALFORMED,"PDF file appears to be incomplete or corrupted.","Missing EOF marker."))}catch(e){t.push(u(a.GS.FILE_CORRUPTED,"Could not read the file.",e instanceof Error?e.message:"Unknown error"))}return{valid:0===t.length,errors:t}}async function o(e,t){let r=e.slice(0,t);return new Uint8Array(await r.arrayBuffer())}async function c(e,t,r){return e.slice(t,r).text()}async function l(e){try{let t=Math.min(1024,e.size);return(await c(e,e.size-t,e.size)).includes("%%EOF")}catch(e){return!1}}function u(e,t,r){return{code:e,category:a.SM[e]||a.h.VALIDATION_ERROR,message:t,details:r,recoverable:e!==a.GS.FILE_CORRUPTED}}},18365:(e,t,r)=>{r.d(t,{A:()=>n});var a=r(78752),s=r(17668);class n{async validate(e){let t=[];for(let r of e){let e=(0,s.nJ)(r,{maxSize:this.getMaxFileSize(),acceptedTypes:this.getAcceptedTypes()});if(!e.valid){t.push(...e.errors);continue}if("application/pdf"===r.type||r.name.toLowerCase().endsWith(".pdf")){let e=await (0,s.GO)(r);e.valid||t.push(...e.errors)}}return{valid:0===t.length,errors:t}}getProgress(){return this.progress}cancel(){this.cancelled=!0}reset(){this.progress=0,this.cancelled=!1}updateProgress(e,t){this.progress=Math.min(100,Math.max(0,e)),this.onProgress&&this.onProgress(this.progress,t)}checkCancelled(){return this.cancelled}createSuccessOutput(e,t,r){return{success:!0,result:e,filename:t,metadata:r}}createErrorOutput(e,t,r){return{success:!1,error:function(e,t,r,s){var n,i;let o=a.SM[e]||a.h.PROCESSING_ERROR,c=(n=e,![a.GS.FILE_CORRUPTED,a.GS.PDF_MALFORMED,a.GS.BROWSER_NOT_SUPPORTED].includes(n));return{code:e,category:o,message:t,details:r,recoverable:c,suggestedAction:(i=e,({[a.GS.FILE_TOO_LARGE]:"Try compressing or splitting the file first.",[a.GS.FILE_TYPE_INVALID]:"Please upload a valid PDF file.",[a.GS.FILE_CORRUPTED]:"The file may be damaged. Try a different file.",[a.GS.PDF_ENCRYPTED]:"Please decrypt the PDF first using the Decrypt tool.",[a.GS.PDF_MALFORMED]:"Try using the Repair PDF tool first.",[a.GS.PROCESSING_TIMEOUT]:"Try with a smaller file or fewer pages.",[a.GS.MEMORY_EXCEEDED]:"Close other browser tabs and try again.",[a.GS.WORKER_FAILED]:"Refresh the page and try again."})[i]||"Please try again.")}}(e,t,r)}}getMaxFileSize(){return 0x6400000}getAcceptedTypes(){return["application/pdf"]}constructor(){this.progress=0,this.cancelled=!1}}},19089:(e,t,r)=>{r.d(t,{xP:()=>i});var a=r(78752),s=r(18365);class n extends s.A{async initWorker(){if(!this.worker)return new Promise((e,t)=>{try{this.worker=new Worker("/workers/xps-to-pdf.worker.js",{type:"module"});let r=r=>{let{type:a,error:s,message:n}=r.data;"init-complete"===a?(this.workerReady=!0,e()):"status"===a?this.updateProgress(0,n):"error"===a&&t(Error(s||"Worker initialization failed"))};this.worker.addEventListener("message",r),this.worker.addEventListener("error",()=>{t(Error("Worker connection failed"))}),this.worker.postMessage({type:"init",id:"init-"+Date.now(),data:{}})}catch(e){t(e)}})}terminateWorker(){this.worker&&(this.worker.terminate(),this.worker=null,this.workerReady=!1)}reset(){super.reset()}async process(e,t){this.reset(),this.onProgress=t;let{files:r}=e;if(1!==r.length)return this.createErrorOutput(a.GS.INVALID_OPTIONS,"Please provide exactly one XPS file.","Received ".concat(r.length," file(s)."));let s=r[0];if(!s.name.toLowerCase().endsWith(".xps"))return this.createErrorOutput(a.GS.FILE_TYPE_INVALID,"Invalid file type. Please upload an XPS file.","Received: ".concat(s.type||s.name));try{this.updateProgress(10,"Initializing converter...");try{await this.initWorker()}catch(e){return console.error("Failed to initialize worker:",e),this.createErrorOutput(a.GS.WORKER_FAILED,"Failed to initialize conversion worker.",e instanceof Error?e.message:String(e))}if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");this.updateProgress(30,"Converting XPS to PDF...");let e=await new Promise((e,t)=>{if(!this.worker)return void t(Error("Worker not initialized"));let r="convert-"+Date.now(),a=a=>{let{type:s,id:n,result:o,error:c,message:l}=a.data;if("status"===s)return void this.updateProgress(this.progress,l);n===r&&("convert-complete"===s?(i(),e(o)):"error"===s&&(i(),t(Error(c||"Conversion failed"))))},n=e=>{i(),t(Error("Worker error: "+e.message))},i=()=>{var e,t;null==(e=this.worker)||e.removeEventListener("message",a),null==(t=this.worker)||t.removeEventListener("error",n)};this.worker.addEventListener("message",a),this.worker.addEventListener("error",n),this.worker.postMessage({type:"convert",id:r,data:{file:s}})});if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");this.updateProgress(100,"Conversion complete!");let t=s.name.replace(/\.xps$/i,"");return this.createSuccessOutput(e,"".concat(t,".pdf"),{format:"pdf"})}catch(e){return console.error("Conversion error:",e),this.terminateWorker(),this.createErrorOutput(a.GS.PROCESSING_FAILED,"Failed to convert XPS to PDF.",e instanceof Error?e.message:"Unknown error")}}constructor(...e){super(...e),this.worker=null,this.workerReady=!1}}async function i(e,t,r){return new n().process({files:[e],options:t||{}},r)}},19362:(e,t,r)=>{r.d(t,{gz:()=>l});var a=r(78752),s=r(18365),n=r(32096);let i={A4:{width:595.28,height:841.89},LETTER:{width:612,height:792},LEGAL:{width:612,height:1008},A3:{width:841.89,height:1190.55}},o={pageSize:"A4",fontSize:10,lineHeight:1.4,indentSpaces:2,margin:{top:72,right:72,bottom:72,left:72},prettyPrint:!0,showLineNumbers:!0};class c extends s.A{async process(e,t){this.reset(),this.onProgress=t;let{files:r,options:s}=e,i={...o,...s};if(r.length<1)return this.createErrorOutput(a.GS.INVALID_OPTIONS,"At least 1 JSON file is required.","Received ".concat(r.length," file(s)."));try{this.updateProgress(5,"Loading PDF library...");let e=await (0,n.Ck)();if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");this.updateProgress(10,"Creating PDF document...");let t=await e.PDFDocument.create(),s=await t.embedFont(e.StandardFonts.Courier),o=80/r.length;for(let n=0;n<r.length;n++){if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");let c=r[n],l=10+n*o;this.updateProgress(l,"Processing file ".concat(n+1," of ").concat(r.length,": ").concat(c.name));try{let r,n=await c.text();try{let e=JSON.parse(n);r=i.prettyPrint?JSON.stringify(e,null,i.indentSpaces):JSON.stringify(e)}catch(e){return this.createErrorOutput(a.GS.FILE_CORRUPTED,'Invalid JSON in file "'.concat(c.name,'".'),e instanceof Error?e.message:"JSON parse error")}await this.addJSONToDocument(t,r,c.name,s,i,e)}catch(e){return this.createErrorOutput(a.GS.PROCESSING_FAILED,'Failed to process file "'.concat(c.name,'".'),e instanceof Error?e.message:"Unknown error")}}this.updateProgress(95,"Saving PDF...");let c=await t.save({useObjectStreams:!0}),l=new Blob([new Uint8Array(c)],{type:"application/pdf"});this.updateProgress(100,"Complete!");let u=this.generateOutputFilename(r);return this.createSuccessOutput(l,u,{pageCount:t.getPageCount(),fileCount:r.length})}catch(e){return this.createErrorOutput(a.GS.PROCESSING_FAILED,"Failed to convert JSON to PDF.",e instanceof Error?e.message:"Unknown error")}}async addJSONToDocument(e,t,r,a,s,n){let o=i[s.pageSize],{margin:c,fontSize:l,lineHeight:u,showLineNumbers:d}=s,p=d?4*l:0,h=o.width-c.left-c.right-p,g=l*u,f=t.split("\n"),P=this.wrapLines(f,a,l,h),E=e.addPage([o.width,o.height]),w=o.height-c.top;E.drawText("File: ".concat(r),{x:c.left,y:w-l,size:l,font:a,color:n.rgb(.4,.4,.4)}),w-=2*g,E.drawLine({start:{x:c.left,y:w},end:{x:o.width-c.right,y:w},thickness:.5,color:n.rgb(.8,.8,.8)}),w-=g;let m=1;for(let t of P)w-g<c.bottom&&(E=e.addPage([o.width,o.height]),w=o.height-c.top),d&&E.drawText(String(m).padStart(3," "),{x:c.left,y:w-l,size:l,font:a,color:n.rgb(.6,.6,.6)}),E.drawText(t,{x:c.left+p,y:w-l,size:l,font:a,color:n.rgb(0,0,0)}),w-=g,m++}wrapLines(e,t,r,a){let s=[];for(let i of e){var n;if(""===i){s.push("");continue}if(t.widthOfTextAtSize(i,r)<=a){s.push(i);continue}let e=(null==(n=i.match(/^(\s*)/))?void 0:n[1])||"",o=i.slice(e.length),c=e,l=0;for(;l<o.length;){let n=c+o[l];t.widthOfTextAtSize(n,r)<=a?(c=n,l++):(c.trim()&&s.push(c),c=e+"  ")}c.trim()&&s.push(c)}return s}generateOutputFilename(e){if(1===e.length){let t=e[0].name.replace(/\.[^/.]+$/,"");return"".concat(t,".pdf")}return"json_".concat(e.length,"_files.pdf")}getAcceptedTypes(){return["application/json",".json"]}}async function l(e,t,r){return new c().process({files:e,options:t||{}},r)}},20334:(e,t,r)=>{r.d(t,{du:()=>o});var a=r(78752),s=r(18365),n=r(32096);class i extends s.A{async process(e,t){var r,s,i,o,c;this.reset(),this.onProgress=t;let{files:l,options:u}=e,d={color:null!=(r=u.color)?r:{r:0,g:0,b:0},pages:null!=(s=u.pages)?s:"all",mode:null!=(i=u.mode)?i:"dark",threshold:null!=(o=u.threshold)?o:128,scale:null!=(c=u.scale)?c:3};if(1!==l.length)return this.createErrorOutput(a.GS.INVALID_OPTIONS,"Exactly 1 PDF file is required.");try{this.updateProgress(5,"Loading PDF libraries...");let[e,t]=await Promise.all([(0,n.Ck)(),(0,n.Iy)()]);this.updateProgress(10,"Loading PDF...");let r=l[0],s=await r.arrayBuffer(),i=await t.getDocument({data:s}).promise,o=i.numPages,c="all"===d.pages?Array.from({length:o},(e,t)=>t+1):d.pages,u=await e.PDFDocument.create();this.updateProgress(15,"Changing text color...");let{r:p,g:h,b:g}=d.color,f=d.threshold,P="dark"===d.mode;for(let e=0;e<c.length;e++){if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");let t=c[e],r=15+75*(e/c.length);this.updateProgress(r,"Processing page ".concat(t," of ").concat(o,"..."));let s=await i.getPage(t),n=s.getViewport({scale:1}),l=n.width,E=n.height,w=d.scale||3,m=s.getViewport({scale:w}),S=document.createElement("canvas"),y=m.width,C=m.height;S.width=y,S.height=C;let O=S.getContext("2d");await s.render({canvasContext:O,viewport:m}).promise;let D=O.getImageData(0,0,y,C),F=D.data;for(let e=0;e<F.length;e+=4){let t=F[e],r=F[e+1],a=F[e+2],s=(t+r+a)/3;(P?s<f:s>f)&&(F[e]=255*p,F[e+1]=255*h,F[e+2]=255*g)}O.putImageData(D,0,0);let I=await this.canvasToPngBytes(S),L=await u.embedPng(I);u.addPage([l,E]).drawImage(L,{x:0,y:0,width:l,height:E})}this.updateProgress(95,"Saving PDF...");let E=await u.save({useObjectStreams:!0}),w=new Blob([new Uint8Array(E)],{type:"application/pdf"});return this.updateProgress(100,"Complete!"),this.createSuccessOutput(w,r.name.replace(".pdf","_textcolor.pdf"),{pageCount:c.length})}catch(e){return this.createErrorOutput(a.GS.PROCESSING_FAILED,"Failed to change text color.",e instanceof Error?e.message:"Unknown error")}}canvasToPngBytes(e){return new Promise((t,r)=>{e.toBlob(e=>{if(!e)return void r(Error("Failed to convert canvas to blob"));let a=new FileReader;a.onload=()=>t(new Uint8Array(a.result)),a.onerror=()=>r(Error("Failed to read blob")),a.readAsArrayBuffer(e)},"image/png")})}getAcceptedTypes(){return["application/pdf"]}}async function o(e,t,r){return new i().process({files:[e],options:t},r)}},23341:(e,t,r)=>{r.d(t,{tf:()=>o});var a=r(78752),s=r(18365),n=r(32096);class i extends s.A{async process(e,t){this.reset(),this.onProgress=t;let{files:s,options:i}=e,o={threshold:99,checkMargins:!0,marginSize:20,...i};if(1!==s.length)return this.createErrorOutput(a.GS.INVALID_OPTIONS,"Exactly 1 PDF file is required.");try{this.updateProgress(5,"Loading libraries...");let e=await (0,n.Ck)(),t=await Promise.all([r.e(84),r.e(29)]).then(r.bind(r,98045));(0,n.configurePdfjsWorker)(t),this.updateProgress(15,"Loading PDF...");let i=s[0],c=await i.arrayBuffer(),l=await t.getDocument({data:c.slice(0)}).promise,u=l.numPages;this.updateProgress(25,"Analyzing pages...");let d=[],p=o.threshold||99;for(let e=1;e<=u;e++){if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");let t=await l.getPage(e),r=t.getViewport({scale:.5}),s=document.createElement("canvas"),n=s.getContext("2d");if(n){s.width=r.width,s.height=r.height,await t.render({canvasContext:n,viewport:r}).promise;let a=n.getImageData(0,0,s.width,s.height);this.isPageBlank(a,p)&&d.push(e)}this.updateProgress(25+40*e/u,"Analyzing page ".concat(e,"..."))}if(0===d.length){this.updateProgress(100,"Complete!");let e=new Blob([new Uint8Array(c)],{type:"application/pdf"});return this.createSuccessOutput(e,i.name,{pageCount:u,blankPagesRemoved:0,message:"No blank pages found."})}if(d.length===u)return this.createErrorOutput(a.GS.INVALID_OPTIONS,"All pages appear to be blank. Cannot remove all pages.");this.updateProgress(70,"Removing blank pages...");let h=await e.PDFDocument.load(c,{ignoreEncryption:!0}),g=await e.PDFDocument.create(),f=Array.from({length:u},(e,t)=>t).filter(e=>!d.includes(e+1));(await g.copyPages(h,f)).forEach(e=>g.addPage(e)),this.updateProgress(95,"Saving PDF...");let P=await g.save({useObjectStreams:!0}),E=new Blob([new Uint8Array(P)],{type:"application/pdf"});return this.updateProgress(100,"Complete!"),this.createSuccessOutput(E,i.name.replace(".pdf","_no_blanks.pdf"),{originalPageCount:u,blankPagesRemoved:d.length,newPageCount:f.length,removedPages:d})}catch(e){return this.createErrorOutput(a.GS.PROCESSING_FAILED,"Failed to remove blank pages.",e instanceof Error?e.message:"Unknown error")}}isPageBlank(e,t){let r=e.data,a=0,s=r.length/4;for(let e=0;e<r.length;e+=4){let t=r[e],s=r[e+1],n=r[e+2];t>250&&s>250&&n>250&&a++}return a/s*100>=t}getAcceptedTypes(){return["application/pdf"]}}async function o(e,t,r){return new i().process({files:[e],options:t},r)}},25278:(e,t,r)=>{r.d(t,{cH:()=>l});var a=r(78752),s=r(18365),n=r(32096);let i={divisionType:"vertical"},o={vertical:{cols:2,rows:1},horizontal:{cols:1,rows:2},"grid-2x2":{cols:2,rows:2},"grid-3x3":{cols:3,rows:3}};class c extends s.A{async process(e,t){this.reset(),this.onProgress=t;let{files:r,options:s}=e,c={...i,...s};if(1!==r.length)return this.createErrorOutput(a.GS.INVALID_OPTIONS,"Exactly 1 PDF file is required.","Received ".concat(r.length," file(s)."));try{let e;this.updateProgress(5,"Loading PDF library...");let t=await (0,n.Ck)();if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");this.updateProgress(10,"Loading source PDF...");let s=r[0],i=await s.arrayBuffer();try{e=await t.PDFDocument.load(i,{ignoreEncryption:!0})}catch(e){if(e instanceof Error&&e.message.includes("encrypt"))return this.createErrorOutput(a.GS.PDF_ENCRYPTED,"The PDF file is encrypted.","Please decrypt the file first.");throw e}let l=e.getPages(),u=l.length;if(this.updateProgress(15,"Source PDF has ".concat(u," pages.")),this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");let d=o[c.divisionType],p=d.cols*d.rows;this.updateProgress(20,"Creating divided PDF...");let h=await t.PDFDocument.create(),g=70/u;for(let t=0;t<u;t++){if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");this.updateProgress(20+t*g,"Processing page ".concat(t+1," of ").concat(u,"..."));let{width:r,height:s}=l[t].getSize(),n=r/d.cols,i=s/d.rows;for(let r=0;r<d.rows;r++)for(let a=0;a<d.cols;a++){let[o]=await h.copyPages(e,[t]),c=a*n,l=s-(r+1)*i;o.setCropBox(c,l,n,i),o.setMediaBox(c,l,n,i),h.addPage(o)}}this.updateProgress(90,"Saving PDF...");let f=await h.save({useObjectStreams:!0}),P=new Blob([new Uint8Array(f)],{type:"application/pdf"});this.updateProgress(100,"Complete!");let E=function(e,t){let r=function(e){let t=e.lastIndexOf(".");return -1===t?e:e.slice(0,t)}(e);return"".concat(r,"_divided_").concat(t,".pdf")}(s.name,c.divisionType),w=u*p;return this.createSuccessOutput(P,E,{originalPageCount:u,outputPageCount:w,divisionType:c.divisionType,sectionsPerPage:p})}catch(e){return this.createErrorOutput(a.GS.PROCESSING_FAILED,"Failed to divide PDF pages.",e instanceof Error?e.message:"Unknown error")}}getAcceptedTypes(){return["application/pdf"]}}async function l(e,t,r){return new c().process({files:[e],options:t},r)}},27082:(e,t,r)=>{r.d(t,{sb:()=>i});var a=r(78752),s=r(18365);class n extends s.A{async initWorker(){if(!this.worker)return new Promise((e,t)=>{try{this.worker=new Worker("/workers/rtf-to-pdf.worker.js",{type:"module"});let r=r=>{let{type:a,error:s,message:n}=r.data;"init-complete"===a?(this.workerReady=!0,e()):"status"===a?this.updateProgress(0,n):"error"===a&&t(Error(s||"Worker initialization failed"))};this.worker.addEventListener("message",r),this.worker.addEventListener("error",()=>{t(Error("Worker connection failed"))}),this.worker.postMessage({type:"init",id:"init-"+Date.now(),data:{}})}catch(e){t(e)}})}terminateWorker(){this.worker&&(this.worker.terminate(),this.worker=null,this.workerReady=!1)}reset(){super.reset()}async process(e,t){this.reset(),this.onProgress=t;let{files:r}=e;if(1!==r.length)return this.createErrorOutput(a.GS.INVALID_OPTIONS,"Please provide exactly one RTF file.","Received ".concat(r.length," file(s)."));let s=r[0];if(!(s.name.toLowerCase().endsWith(".rtf")||"application/rtf"===s.type||"text/rtf"===s.type))return this.createErrorOutput(a.GS.FILE_TYPE_INVALID,"Invalid file type. Please upload an RTF file.","Received: ".concat(s.type||s.name));try{this.updateProgress(10,"Initializing converter...");try{await this.initWorker()}catch(e){return console.error("Failed to initialize worker:",e),this.createErrorOutput(a.GS.WORKER_FAILED,"Failed to initialize conversion worker.",e instanceof Error?e.message:String(e))}if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");this.updateProgress(30,"Converting RTF to PDF...");let e=await new Promise((e,t)=>{if(!this.worker)return void t(Error("Worker not initialized"));let r="convert-"+Date.now(),a=a=>{let{type:s,id:n,result:o,error:c,message:l}=a.data;if("status"===s)return void this.updateProgress(this.progress,l);n===r&&("convert-complete"===s?(i(),e(o)):"error"===s&&(i(),t(Error(c||"Conversion failed"))))},n=e=>{i(),t(Error("Worker error: "+e.message))},i=()=>{var e,t;null==(e=this.worker)||e.removeEventListener("message",a),null==(t=this.worker)||t.removeEventListener("error",n)};this.worker.addEventListener("message",a),this.worker.addEventListener("error",n),this.worker.postMessage({type:"convert",id:r,data:{file:s}})});if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");this.updateProgress(100,"Conversion complete!");let t=s.name.replace(/\.rtf$/i,"");return this.createSuccessOutput(e,"".concat(t,".pdf"),{format:"pdf"})}catch(e){return console.error("Conversion error:",e),this.terminateWorker(),this.createErrorOutput(a.GS.PROCESSING_FAILED,"Failed to convert RTF to PDF.",e instanceof Error?e.message:"Unknown error")}}constructor(...e){super(...e),this.worker=null,this.workerReady=!1}}async function i(e,t,r){return new n().process({files:[e],options:t||{}},r)}},27467:(e,t,r)=>{r.d(t,{Xc:()=>o});var a=r(78752),s=r(18365),n=r(32096);class i extends s.A{async process(e,t){this.reset(),this.onProgress=t;let{files:r}=e;if(1!==r.length)return this.createErrorOutput(a.GS.INVALID_OPTIONS,"Exactly 1 PDF file is required.","Received ".concat(r.length," file(s)."));try{let e;this.updateProgress(5,"Loading PDF library...");let t=await (0,n.Ck)();if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");this.updateProgress(10,"Loading source PDF...");let s=r[0],i=await s.arrayBuffer();try{e=await t.PDFDocument.load(i,{ignoreEncryption:!0})}catch(e){if(e instanceof Error&&e.message.includes("encrypt"))return this.createErrorOutput(a.GS.PDF_ENCRYPTED,"The PDF file is encrypted.","Please decrypt the file first.");throw e}let o=e.getPageCount();if(this.updateProgress(20,"Source PDF has ".concat(o," pages.")),o<2)return this.createErrorOutput(a.GS.INVALID_OPTIONS,"PDF must have at least 2 pages to reverse.","The PDF has only ".concat(o," page(s)."));if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");this.updateProgress(30,"Reversing page order...");let c=await t.PDFDocument.create(),l=Array.from({length:o},(e,t)=>o-1-t);this.updateProgress(50,"Copying pages in reverse order..."),(await c.copyPages(e,l)).forEach(e=>c.addPage(e)),this.updateProgress(90,"Saving PDF...");let u=await c.save({useObjectStreams:!0}),d=new Blob([new Uint8Array(u)],{type:"application/pdf"});this.updateProgress(100,"Complete!");let p=function(e){let t=function(e){let t=e.lastIndexOf(".");return -1===t?e:e.slice(0,t)}(e);return"".concat(t,"_reversed.pdf")}(s.name);return this.createSuccessOutput(d,p,{pageCount:o})}catch(e){return this.createErrorOutput(a.GS.PROCESSING_FAILED,"Failed to reverse PDF pages.",e instanceof Error?e.message:"Unknown error")}}getAcceptedTypes(){return["application/pdf"]}}async function o(e,t){return new i().process({files:[e],options:{}},t)}},28735:(e,t,r)=>{r.d(t,{aw:()=>l});var a=r(78752),s=r(18365),n=r(32096);let i={gridLayout:"2x2",pageSize:"A4",orientation:"landscape",useMargins:!0,addBorder:!0,borderColor:"#CCCCCC",spacing:10,fillMode:"leave-empty",pageMode:"first-page-only"},o={A4:[595.28,841.89],Letter:[612,792],Legal:[612,1008],A3:[841.89,1190.55]};class c extends s.A{async process(e,t){this.reset(),this.onProgress=t;let{files:r,options:s}=e,c={...i,...s};if(r.length<2)return this.createErrorOutput(a.GS.INVALID_OPTIONS,"At least 2 PDF files are required for grid combine.","Received ".concat(r.length," file(s)."));try{this.updateProgress(5,"Loading PDF library...");let e=await (0,n.Ck)();if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");this.updateProgress(10,"Loading source PDFs...");let[t,s]=function(e){let t=e.match(/(\d+)x(\d+)/);return t?[parseInt(t[1],10),parseInt(t[2],10)]:[2,2]}(c.gridLayout),i=t*s,[l,u]=o[c.pageSize];"landscape"===c.orientation&&l<u?[l,u]=[u,l]:"portrait"===c.orientation&&l>u&&([l,u]=[u,l]);let d=36*!!c.useMargins,p=c.spacing,h=l-2*d,g=u-2*d,f=(h-p*(t-1))/t,P=(g-p*(s-1))/s,E=[],w=30/r.length;for(let t=0;t<r.length;t++){if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");let s=r[t];this.updateProgress(10+t*w,"Loading ".concat(s.name,"..."));try{let t=await s.arrayBuffer(),r=await e.PDFDocument.load(t,{ignoreEncryption:!0});E.push({doc:r,name:s.name})}catch(e){return this.createErrorOutput(a.GS.PROCESSING_FAILED,'Failed to load "'.concat(s.name,'".'),e instanceof Error?e.message:"Unknown error")}}this.updateProgress(40,"Creating grid layout...");let m=await e.PDFDocument.create(),S=function(e){let t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16)/255,g:parseInt(t[2],16)/255,b:parseInt(t[3],16)/255}:{r:.8,g:.8,b:.8}}(c.borderColor),y=[];for(let{doc:e,name:t}of E){let r=e.getPages();if("all-pages"===c.pageMode)for(let e=0;e<r.length;e++)y.push({page:r[e],name:t,pageNum:e+1});else r.length>0&&y.push({page:r[0],name:t,pageNum:1})}let C=[...y];if(y.length<i){if("repeat"===c.fillMode)for(;C.length<i;){let e=C.length%y.length;C.push({...y[e]})}else if("stretch-last"===c.fillMode){let e=y[y.length-1];for(;C.length<i;)C.push({...e})}}this.updateProgress(45,"Embedding pages...");let O=[],D=new Map;for(let{page:e}of y)D.has(e)||(D.set(e,O.length),O.push(e));let F=await m.embedPages(O),I=new Map;for(let e=0;e<O.length;e++)I.set(O[e],F[e]);let L=Math.ceil(C.length/i),v=40/L;for(let r=0;r<L;r++){if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");this.updateProgress(50+r*v,"Creating page ".concat(r+1," of ").concat(L,"..."));let s=m.addPage([l,u]),n=r*i,o=Math.min(n+i,C.length),h=C.slice(n,o);for(let r=0;r<h.length;r++){let{page:a}=h[r],n=I.get(a),i=Math.min(f/n.width,P/n.height),o=n.width*i,l=n.height*i,g=r%t,E=Math.floor(r/t),w=d+g*(f+p),m=u-d-P-E*(P+p),y=w+(f-o)/2,C=m+(P-l)/2;s.drawPage(n,{x:y,y:C,width:o,height:l}),c.addBorder&&s.drawRectangle({x:y,y:C,width:o,height:l,borderColor:e.rgb(S.r,S.g,S.b),borderWidth:.5})}}this.updateProgress(90,"Saving PDF...");let k=await m.save({useObjectStreams:!0}),A=new Blob([new Uint8Array(k)],{type:"application/pdf"});this.updateProgress(100,"Complete!");let N="combined_".concat(t,"x").concat(s,"_grid.pdf");return this.createSuccessOutput(A,N,{sourceFileCount:r.length,totalSourcePages:C.length,gridLayout:c.gridLayout,outputPageCount:L,pageMode:c.pageMode,fillMode:c.fillMode})}catch(e){return this.createErrorOutput(a.GS.PROCESSING_FAILED,"Failed to create grid combined PDF.",e instanceof Error?e.message:"Unknown error")}}getAcceptedTypes(){return["application/pdf"]}}async function l(e,t,r){return new c().process({files:e,options:t},r)}},29553:(e,t,r)=>{r.d(t,{qq:()=>o});var a=r(78752),s=r(18365);let n={minWidth:50,minHeight:50,minSize:10240};class i extends s.A{async initWorker(){if(!this.worker)return new Promise((e,t)=>{try{this.worker=new Worker("/workers/extract-images.worker.js",{type:"module"});let r=r=>{let{type:a,error:s,message:n}=r.data;"init-complete"===a?(this.workerReady=!0,e()):"status"===a?this.updateProgress(0,n):"error"===a&&t(Error(s||"Worker initialization failed"))};this.worker.addEventListener("message",r),this.worker.addEventListener("error",()=>{t(Error("Worker connection failed"))}),this.worker.postMessage({type:"init",id:"init-"+Date.now(),data:{}})}catch(e){t(e)}})}terminateWorker(){this.worker&&(this.worker.terminate(),this.worker=null,this.workerReady=!1)}async process(e,t){this.reset(),this.onProgress=t;let{files:r,options:s}=e,i={...n,...s};if(0===r.length)return this.createErrorOutput(a.GS.INVALID_OPTIONS,"Please provide at least one PDF file.","No files provided.");try{this.updateProgress(5,"Initializing extractor...");try{await this.initWorker()}catch(e){return console.error("Failed to initialize worker:",e),this.createErrorOutput(a.GS.WORKER_FAILED,"Failed to initialize extraction worker.",e instanceof Error?e.message:String(e))}if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");let e=[],t=90/r.length,s=0;for(let a=0;a<r.length;a++){let n=r[a];if(this.checkCancelled())break;this.updateProgress(10+a*t,"Processing ".concat(n.name,"..."));try{for(let t of(await new Promise((e,t)=>{if(!this.worker)return void t(Error("Worker not initialized"));let r="extract-"+Date.now(),a=a=>{let{type:s,id:n,result:i,error:c}=a.data;"status"!==s&&n===r&&("extract-complete"===s?(o(),e(i)):"error"===s&&(o(),t(Error(c||"Extraction failed"))))},s=e=>{o(),t(Error("Worker error: "+e.message))},o=()=>{var e,t;null==(e=this.worker)||e.removeEventListener("message",a),null==(t=this.worker)||t.removeEventListener("error",s)};this.worker.addEventListener("message",a),this.worker.addEventListener("error",s),this.worker.postMessage({type:"extract",id:r,data:{file:n,options:i}})})))s++,e.push({...t,index:s,data:t.data instanceof Uint8Array?t.data.buffer:t.data,name:"image_".concat(s,".").concat(t.ext)})}catch(e){console.warn("Failed to process file ".concat(n.name,":"),e)}}if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");if(this.updateProgress(100,"Complete!"),0===e.length)return this.createErrorOutput(a.GS.PROCESSING_FAILED,"No images found in the selected PDF(s).","The PDF may not contain any embedded images that match the filter criteria.");return{success:!0,result:void 0,metadata:{images:e,imageCount:e.length,totalSize:e.reduce((e,t)=>e+t.size,0)}}}catch(e){return this.terminateWorker(),this.createErrorOutput(a.GS.PROCESSING_FAILED,"Failed to extract images from PDF.",e instanceof Error?e.message:"Unknown error")}}getAcceptedTypes(){return["application/pdf"]}constructor(...e){super(...e),this.worker=null,this.workerReady=!1}}async function o(e,t,r){return new i().process({files:e,options:t||{}},r)}},30037:(e,t,r)=>{r.d(t,{ZK:()=>l});var a=r(78752),s=r(18365),n=r(32096);let i={orientation:"vertical",spacing:0,backgroundColor:"#FFFFFF",addSeparator:!1,separatorThickness:.5,separatorColor:"#000000"};class o extends s.A{async process(e,t){this.reset(),this.onProgress=t;let{files:r,options:s}=e,o={...i,...s};if(1!==r.length)return this.createErrorOutput(a.GS.INVALID_OPTIONS,"Exactly 1 PDF file is required.","Received ".concat(r.length," file(s)."));try{let e,t,s;this.updateProgress(5,"Loading PDF library...");let i=await (0,n.Ck)();if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");this.updateProgress(10,"Loading source PDF...");let l=r[0],u=await l.arrayBuffer();try{e=await i.PDFDocument.load(u,{ignoreEncryption:!0})}catch(e){if(e instanceof Error&&e.message.includes("encrypt"))return this.createErrorOutput(a.GS.PDF_ENCRYPTED,"The PDF file is encrypted.","Please decrypt the file first.");throw e}let d=e.getPages(),p=d.length;if(this.updateProgress(15,"Source PDF has ".concat(p," pages.")),0===p)return this.createErrorOutput(a.GS.INVALID_OPTIONS,"The PDF file has no pages.","Please provide a PDF with at least one page.");if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");let{orientation:h,spacing:g,backgroundColor:f,addSeparator:P,separatorThickness:E,separatorColor:w}=o,m=0,S=0,y=0,C=0;for(let e of d){let{width:t,height:r}=e.getSize();m=Math.max(m,t),S=Math.max(S,r),y+=t,C+=r}let O=Math.max(0,p-1)*g;"horizontal"===h?(t=y+O,s=S):(t=m,s=C+O),this.updateProgress(20,"Creating combined page...");let D=await i.PDFDocument.create(),F=D.addPage([t,s]),I=c(f),L=c(w);"#FFFFFF"!==f.toUpperCase()&&F.drawRectangle({x:0,y:0,width:t,height:s,color:i.rgb(I.r,I.g,I.b)}),this.updateProgress(20,"Embedding pages...");let v=await D.embedPages(d),k=60/p,A=0,N=s;for(let e=0;e<p;e++){if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");this.updateProgress(25+e*k,"Processing page ".concat(e+1," of ").concat(p,"..."));let{width:r,height:n}=d[e].getSize(),o=v[e];if("horizontal"===h){let t=(s-n)/2;if(F.drawPage(o,{x:A,y:t,width:r,height:n}),P&&e<p-1){let e=A+r+g/2;F.drawLine({start:{x:e,y:0},end:{x:e,y:s},thickness:E,color:i.rgb(L.r,L.g,L.b)})}A+=r+g}else{N-=n;let a=(t-r)/2;if(F.drawPage(o,{x:a,y:N,width:r,height:n}),P&&e<p-1){let e=N-g/2;F.drawLine({start:{x:0,y:e},end:{x:t,y:e},thickness:E,color:i.rgb(L.r,L.g,L.b)})}N-=g}}this.updateProgress(90,"Saving PDF...");let R=await D.save({useObjectStreams:!0}),G=new Blob([new Uint8Array(R)],{type:"application/pdf"});this.updateProgress(100,"Complete!");let _=function(e){let t=function(e){let t=e.lastIndexOf(".");return -1===t?e:e.slice(0,t)}(e);return"".concat(t,"_combined.pdf")}(l.name);return this.createSuccessOutput(G,_,{originalPageCount:p,outputPageCount:1,orientation:h,finalWidth:t,finalHeight:s})}catch(e){return this.createErrorOutput(a.GS.PROCESSING_FAILED,"Failed to combine PDF pages.",e instanceof Error?e.message:"Unknown error")}}getAcceptedTypes(){return["application/pdf"]}}function c(e){let t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16)/255,g:parseInt(t[2],16)/255,b:parseInt(t[3],16)/255}:{r:1,g:1,b:1}}async function l(e,t,r){return new o().process({files:[e],options:t},r)}},30782:(e,t,r)=>{r.d(t,{wA:()=>o});var a=r(78752),s=r(18365),n=r(32096);class i extends s.A{async process(e,t){this.reset(),this.onProgress=t;let{files:r,options:s}=e,i={fontSize:10,margin:30,fontColor:"#000000",...s};if(1!==r.length)return this.createErrorOutput(a.GS.INVALID_OPTIONS,"Exactly 1 PDF file is required.");try{this.updateProgress(10,"Loading PDF library...");let e=await (0,n.Ck)();this.updateProgress(20,"Loading PDF...");let t=r[0],s=await t.arrayBuffer(),o=await e.PDFDocument.load(s,{ignoreEncryption:!0}),c=await o.embedFont(e.StandardFonts.Helvetica),l=o.getPageCount(),u=new Date().toLocaleDateString(),d=(e=>{let t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16)/255,g:parseInt(t[2],16)/255,b:parseInt(t[3],16)/255}:{r:0,g:0,b:0}})(i.fontColor||"#000000"),p=((e,t)=>{if(!e||"all"===e.toLowerCase()||""===e.trim())return new Set(Array.from({length:t},(e,t)=>t));let r=new Set;for(let a of e.split(",").map(e=>e.trim()))if(a.includes("-")){let[e,s]=a.split("-").map(e=>parseInt(e.trim()));if(!isNaN(e)&&!isNaN(s))for(let a=Math.max(1,e);a<=Math.min(s,t);a++)r.add(a-1)}else{let e=parseInt(a);!isNaN(e)&&e>=1&&e<=t&&r.add(e-1)}return r})(i.pageRange,l);this.updateProgress(30,"Adding headers and footers...");for(let t=0;t<l;t++){if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");if(!p.has(t)||i.skipFirstPage&&0===t)continue;let r=o.getPage(t),{width:s,height:n}=r.getSize(),h=i.margin||30,g=i.fontSize||10,f=t+1,P=e.rgb(d.r,d.g,d.b),E=e=>e.replace(/{page}/g,String(f)).replace(/{total}/g,String(l)).replace(/{date}/g,u);if(i.header){let e=n-h;if(i.header.left){let t=E(i.header.left);r.drawText(t,{x:h,y:e,size:g,font:c,color:P})}if(i.header.center){let t=E(i.header.center),a=c.widthOfTextAtSize(t,g);r.drawText(t,{x:(s-a)/2,y:e,size:g,font:c,color:P})}if(i.header.right){let t=E(i.header.right),a=c.widthOfTextAtSize(t,g);r.drawText(t,{x:s-h-a,y:e,size:g,font:c,color:P})}}if(i.footer){if(i.footer.left){let e=E(i.footer.left);r.drawText(e,{x:h,y:h,size:g,font:c,color:P})}if(i.footer.center){let e=E(i.footer.center),t=c.widthOfTextAtSize(e,g);r.drawText(e,{x:(s-t)/2,y:h,size:g,font:c,color:P})}if(i.footer.right){let e=E(i.footer.right),t=c.widthOfTextAtSize(e,g);r.drawText(e,{x:s-h-t,y:h,size:g,font:c,color:P})}}this.updateProgress(30+60*(t+1)/l,"Processing page ".concat(f,"..."))}this.updateProgress(95,"Saving PDF...");let h=await o.save({useObjectStreams:!0}),g=new Blob([new Uint8Array(h)],{type:"application/pdf"});return this.updateProgress(100,"Complete!"),this.createSuccessOutput(g,t.name.replace(".pdf","_headerfooter.pdf"),{pageCount:l})}catch(e){return this.createErrorOutput(a.GS.PROCESSING_FAILED,"Failed to add header/footer.",e instanceof Error?e.message:"Unknown error")}}getAcceptedTypes(){return["application/pdf"]}}async function o(e,t,r){return new i().process({files:[e],options:t},r)}},32096:(e,t,r)=>{r.d(t,{Ck:()=>l,Iy:()=>u,configurePdfjsWorker:()=>c});let a=null,s=null,n=null,i=null,o=!1;function c(e){if(!o){let t=e.version;e.GlobalWorkerOptions.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/".concat(t,"/pdf.worker.min.mjs"),o=!0}}async function l(){return a||n||(n=Promise.all([r.e(429),r.e(814)]).then(r.bind(r,57814)).then(e=>(a=e,n=null,e)))}async function u(){return s||i||(i=Promise.all([r.e(84),r.e(29)]).then(r.bind(r,98045)).then(e=>(c(e),s=e,i=null,e)))}},33164:(e,t,r)=>{r.d(t,{oU:()=>c});var a=r(78752),s=r(18365),n=r(32096);let i={includeText:!0,includeMetadata:!0,includePageInfo:!0,includeOutline:!0,pages:[],prettyPrint:!0};class o extends s.A{async process(e,t){this.reset(),this.onProgress=t;let{files:r,options:s}=e,o={...i,...s};if(1!==r.length)return this.createErrorOutput(a.GS.INVALID_OPTIONS,"Please provide exactly one PDF file.","Received ".concat(r.length," file(s)."));let c=r[0];if(!c.type.includes("pdf")&&!c.name.toLowerCase().endsWith(".pdf"))return this.createErrorOutput(a.GS.FILE_TYPE_INVALID,"Invalid file type. Please upload a PDF file.","Received: ".concat(c.type||"unknown"));try{this.updateProgress(5,"Loading PDF library...");let e=await (0,n.Iy)();if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");this.updateProgress(10,"Loading PDF document...");let t=await c.arrayBuffer(),r=await e.getDocument({data:t}).promise,s=r.numPages,i={filename:c.name,info:{pageCount:s,isEncrypted:!1},pages:[]};if(o.includeMetadata){this.updateProgress(15,"Extracting metadata...");try{let e=await r.getMetadata();if(e.info){let t=e.info;i.metadata={title:t.Title,author:t.Author,subject:t.Subject,keywords:t.Keywords,creator:t.Creator,producer:t.Producer,creationDate:t.CreationDate?String(t.CreationDate):void 0,modificationDate:t.ModDate?String(t.ModDate):void 0},t.PDFFormatVersion&&(i.info.pdfVersion=String(t.PDFFormatVersion))}}catch(e){}}if(o.includeOutline){this.updateProgress(20,"Extracting outline...");try{let e=await r.getOutline();e&&(i.outline=this.processOutline(e))}catch(e){}}let l=o.pages.length>0?o.pages.filter(e=>e>=1&&e<=s):Array.from({length:s},(e,t)=>t+1);this.updateProgress(25,"Extracting ".concat(l.length," page(s)..."));let u=70/l.length;for(let e=0;e<l.length;e++){if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");let t=l[e],n=25+e*u;this.updateProgress(n,"Extracting page ".concat(t," of ").concat(s,"..."));try{let e=await this.extractPageContent(r,t,o);i.pages.push(e)}catch(e){i.pages.push({pageNumber:t,text:"[Error extracting page: ".concat(e instanceof Error?e.message:"Unknown error","]")})}}this.updateProgress(95,"Generating JSON...");let d=o.prettyPrint?JSON.stringify(i,null,2):JSON.stringify(i),p=new Blob([d],{type:"application/json"});this.updateProgress(100,"Complete!");let h=c.name.replace(/\.pdf$/i,"");return this.createSuccessOutput(p,"".concat(h,".json"),{pageCount:i.pages.length,hasMetadata:!!i.metadata,hasOutline:!!i.outline})}catch(e){return this.createErrorOutput(a.GS.PROCESSING_FAILED,"Failed to convert PDF to JSON.",e instanceof Error?e.message:"Unknown error")}}async extractPageContent(e,t,r){let a=await e.getPage(t),s=a.getViewport({scale:1}),n={pageNumber:t};return r.includePageInfo&&(n.width=s.width,n.height=s.height,n.rotation=s.rotation),r.includeText&&(n.text=(await a.getTextContent()).items.filter(e=>"str"in e).map(e=>e.str).join(" ").replace(/\s+/g," ").trim()),n}processOutline(e){return e.map(e=>{let t={title:e.title||""};return e.dest&&(t.dest=String(e.dest)),e.items&&e.items.length>0&&(t.items=this.processOutline(e.items)),t})}}async function c(e,t,r){return new o().process({files:[e],options:t||{}},r)}},33737:(e,t,r)=>{r.d(t,{j6:()=>l,lI:()=>o});var a=r(78752),s=r(18365),n=r(32096);let i={languages:["eng"],scale:2,pages:[],outputFormat:"text",preserveLayout:!1},o={eng:"English",chi_sim:"Chinese (Simplified)",chi_tra:"Chinese (Traditional)",jpn:"Japanese",kor:"Korean",spa:"Spanish",fra:"French",deu:"German",por:"Portuguese",ara:"Arabic"};class c extends s.A{async process(e,t){this.reset(),this.onProgress=t;let{files:r,options:s}=e,o={...i,...s};if(1!==r.length)return this.createErrorOutput(a.GS.INVALID_OPTIONS,"Please provide exactly one PDF file.","Received ".concat(r.length," file(s)."));let c=r[0];if(!c.type.includes("pdf")&&!c.name.toLowerCase().endsWith(".pdf"))return this.createErrorOutput(a.GS.FILE_TYPE_INVALID,"Invalid file type. Please upload a PDF file.","Received: ".concat(c.type||"unknown"));try{let e,t;this.updateProgress(5,"Loading libraries...");let r=await (0,n.Iy)();if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");this.updateProgress(10,"Initializing OCR engine..."),await this.initializeTesseract(o.languages),this.updateProgress(20,"Loading PDF document...");let s=await c.arrayBuffer(),i=await r.getDocument({data:s}).promise,l=i.numPages,u=o.pages.length>0?o.pages.filter(e=>e>=1&&e<=l):Array.from({length:l},(e,t)=>t+1);if(0===u.length)return await this.terminateTesseract(),this.createErrorOutput(a.GS.INVALID_PAGE_RANGE,"No valid pages to OCR.","PDF has ".concat(l," pages."));this.updateProgress(25,"Processing ".concat(u.length," page(s)..."));let d=[],p=70/u.length;for(let e=0;e<u.length;e++){if(this.checkCancelled())return await this.terminateTesseract(),this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");let t=u[e],r=25+e*p;this.updateProgress(r,"OCR processing page ".concat(t," of ").concat(l,"..."));try{let e=await this.ocrPage(i,t,o);d.push("--- Page ".concat(t," ---\n").concat(e))}catch(e){d.push("--- Page ".concat(t," ---\n[OCR Error: ").concat(e instanceof Error?e.message:"Unknown error","]"))}}await this.terminateTesseract(),this.updateProgress(95,"Generating output...");let h=c.name.replace(/\.pdf$/i,"");if("text"===o.outputFormat){let r=d.join("\n\n");e=new Blob([r],{type:"text/plain"}),t="".concat(h,"_ocr.txt")}else e=await this.createSearchablePDF(c,d,o),t="".concat(h,"_searchable.pdf");return this.updateProgress(100,"Complete!"),this.createSuccessOutput(e,t,{pageCount:u.length,languages:o.languages,outputFormat:o.outputFormat})}catch(e){return await this.terminateTesseract(),this.createErrorOutput(a.GS.PROCESSING_FAILED,"Failed to perform OCR on PDF.",e instanceof Error?e.message:"Unknown error")}}async initializeTesseract(e){let t=await r.e(13).then(r.t.bind(r,59013,23)),a=e.join("+");this.tesseractWorker=await t.createWorker(a)}async terminateTesseract(){this.tesseractWorker&&(await this.tesseractWorker.terminate(),this.tesseractWorker=null)}async ocrPage(e,t,r){if(!this.tesseractWorker)throw Error("Tesseract worker not initialized");let a=await e.getPage(t),s=a.getViewport({scale:r.scale}),n=document.createElement("canvas");n.width=s.width,n.height=s.height;let i=n.getContext("2d");if(!i)throw Error("Failed to get canvas context");return i.fillStyle="#ffffff",i.fillRect(0,0,n.width,n.height),await a.render({canvasContext:i,viewport:s}).promise,(await this.tesseractWorker.recognize(n)).data.text}async createSearchablePDF(e,t,r){let a=await (0,n.Ck)(),s=await e.arrayBuffer(),i=await a.PDFDocument.load(s);return i.setTitle("".concat(e.name," (OCR)")),i.setSubject("OCR processed document"),i.setKeywords(["OCR","searchable",...r.languages]),new Blob([new Uint8Array(await i.save({useObjectStreams:!0}))],{type:"application/pdf"})}constructor(...e){super(...e),this.tesseractWorker=null}}async function l(e,t,r){return new c().process({files:[e],options:t||{}},r)}},34263:(e,t,r)=>{r.d(t,{Ij:()=>c});var a=r(78752),s=r(18365),n=r(32096);let i={removeTitle:!0,removeAuthor:!0,removeSubject:!0,removeKeywords:!0,removeCreator:!0,removeProducer:!0,removeCreationDate:!0,removeModificationDate:!0};class o extends s.A{async process(e,t){this.reset(),this.onProgress=t;let{files:r,options:s}=e,o={...i,...s};if(1!==r.length)return this.createErrorOutput(a.GS.INVALID_OPTIONS,"Please provide exactly one PDF file.","Received ".concat(r.length," file(s)."));let c=r[0];try{var l,u;let e;this.updateProgress(5,"Loading PDF library...");let t=await (0,n.Ck)();if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");this.updateProgress(10,"Reading PDF file...");let r=await c.arrayBuffer(),s=r.byteLength;this.updateProgress(20,"Loading PDF document...");try{e=await t.PDFDocument.load(r,{ignoreEncryption:!0})}catch(e){if(e instanceof Error&&e.message.includes("encrypt"))return this.createErrorOutput(a.GS.PDF_ENCRYPTED,"The PDF file is encrypted.","Please decrypt the file before removing metadata.");throw e}if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");this.updateProgress(30,"Reading current metadata...");let i=e.getPageCount();if(0===i)return this.createErrorOutput(a.GS.PDF_MALFORMED,"The PDF file contains no pages.","Cannot process an empty PDF.");let d={title:e.getTitle()||"",author:e.getAuthor()||"",subject:e.getSubject()||"",keywords:e.getKeywords()||"",creator:e.getCreator()||"",producer:e.getProducer()||"",creationDate:(null==(l=e.getCreationDate())?void 0:l.toISOString())||"",modificationDate:(null==(u=e.getModificationDate())?void 0:u.toISOString())||""},p=[];if(this.updateProgress(50,"Removing metadata..."),o.removeTitle&&d.title&&(e.setTitle(""),p.push("title")),o.removeAuthor&&d.author&&(e.setAuthor(""),p.push("author")),o.removeSubject&&d.subject&&(e.setSubject(""),p.push("subject")),o.removeKeywords&&d.keywords&&(e.setKeywords([]),p.push("keywords")),o.removeCreator&&d.creator&&(e.setCreator(""),p.push("creator")),o.removeProducer&&d.producer&&(e.setProducer(""),p.push("producer")),this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");this.updateProgress(80,"Saving PDF...");let h=await e.save({useObjectStreams:!0,addDefaultPage:!1}),g=new Blob([new Uint8Array(h)],{type:"application/pdf"}),f=h.length;this.updateProgress(100,"Complete!");let P=function(e){let t=e.lastIndexOf("."),r=-1===t?e:e.slice(0,t);return"".concat(r,"_no_metadata.pdf")}(c.name);return this.createSuccessOutput(g,P,{pageCount:i,originalSize:s,newSize:f,removedFields:p,originalMetadata:d})}catch(e){return this.createErrorOutput(a.GS.PROCESSING_FAILED,"Failed to remove PDF metadata.",e instanceof Error?e.message:"Unknown error")}}getAcceptedTypes(){return["application/pdf"]}}async function c(e,t,r){return new o().process({files:[e],options:t||{}},r)}},34744:(e,t,r)=>{r.d(t,{LX:()=>o});var a=r(78752),s=r(18365),n=r(32096);class i extends s.A{async process(e,t){this.reset(),this.onProgress=t;let{files:r,options:s}=e,i={removeAll:!0,pages:"all",...s};if(1!==r.length)return this.createErrorOutput(a.GS.INVALID_OPTIONS,"Exactly 1 PDF file is required.");try{this.updateProgress(10,"Loading PDF library...");let e=await (0,n.Ck)();this.updateProgress(20,"Loading PDF...");let t=r[0],s=await t.arrayBuffer(),o=await e.PDFDocument.load(s,{ignoreEncryption:!0}),c=o.getPageCount(),l="all"===i.pages?Array.from({length:c},(e,t)=>t):i.pages.map(e=>e-1);this.updateProgress(30,"Removing annotations...");for(let t=0;t<l.length;t++){if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");let r=l[t],s=o.getPage(r);s.node.get(e.PDFName.of("Annots"))&&(i.removeAll,s.node.delete(e.PDFName.of("Annots"))),this.updateProgress(30+60*(t+1)/l.length,"Processing page ".concat(r+1,"..."))}this.updateProgress(95,"Saving PDF...");let u=await o.save({useObjectStreams:!0}),d=new Blob([new Uint8Array(u)],{type:"application/pdf"});return this.updateProgress(100,"Complete!"),this.createSuccessOutput(d,t.name.replace(".pdf","_no_annotations.pdf"),{pageCount:c,pagesProcessed:l.length})}catch(e){return this.createErrorOutput(a.GS.PROCESSING_FAILED,"Failed to remove annotations.",e instanceof Error?e.message:"Unknown error")}}getAcceptedTypes(){return["application/pdf"]}}async function o(e,t,r){return new i().process({files:[e],options:t},r)}},37447:(e,t,r)=>{r.d(t,{_r:()=>c});var a=r(78752),s=r(18365),n=r(32096);let i={position:0,count:1};class o extends s.A{async process(e,t){this.reset(),this.onProgress=t;let{files:r,options:s}=e,o={...i,...s};if(1!==r.length)return this.createErrorOutput(a.GS.INVALID_OPTIONS,"Exactly 1 PDF file is required.","Received ".concat(r.length," file(s)."));if(o.count<1)return this.createErrorOutput(a.GS.INVALID_OPTIONS,"At least 1 blank page must be added.","Received count: ".concat(o.count));try{let e;this.updateProgress(5,"Loading PDF library...");let t=await (0,n.Ck)();if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");this.updateProgress(10,"Loading source PDF...");let s=r[0],i=await s.arrayBuffer();try{e=await t.PDFDocument.load(i,{ignoreEncryption:!0})}catch(e){if(e instanceof Error&&e.message.includes("encrypt"))return this.createErrorOutput(a.GS.PDF_ENCRYPTED,"The PDF file is encrypted.","Please decrypt the file first.");throw e}let c=e.getPageCount();if(this.updateProgress(20,"Source PDF has ".concat(c," pages.")),o.position<0||o.position>c)return this.createErrorOutput(a.GS.INVALID_PAGE_RANGE,"Position must be between 0 and ".concat(c,"."),"Received position: ".concat(o.position));if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");this.updateProgress(30,"Creating new PDF...");let l=e.getPage(0),{width:u,height:d}=o.pageSize||l.getSize(),p=await t.PDFDocument.create();if(o.position>0){let t=Array.from({length:o.position},(e,t)=>t);(await p.copyPages(e,t)).forEach(e=>p.addPage(e))}this.updateProgress(50,"Adding ".concat(o.count," blank page(s)..."));for(let e=0;e<o.count;e++)p.addPage([u,d]);if(this.updateProgress(70,"Copying remaining pages..."),o.position<c){let t=Array.from({length:c-o.position},(e,t)=>o.position+t);(await p.copyPages(e,t)).forEach(e=>p.addPage(e))}this.updateProgress(90,"Saving PDF...");let h=await p.save({useObjectStreams:!0}),g=new Blob([new Uint8Array(h)],{type:"application/pdf"});this.updateProgress(100,"Complete!");let f=function(e,t){let r=function(e){let t=e.lastIndexOf(".");return -1===t?e:e.slice(0,t)}(e);return"".concat(r,"_").concat(t,"_blank_pages_added.pdf")}(s.name,o.count);return this.createSuccessOutput(g,f,{originalPageCount:c,addedPageCount:o.count,newPageCount:c+o.count,insertPosition:o.position})}catch(e){return this.createErrorOutput(a.GS.PROCESSING_FAILED,"Failed to add blank pages to PDF.",e instanceof Error?e.message:"Unknown error")}}getAcceptedTypes(){return["application/pdf"]}}async function c(e,t,r,a){return new o().process({files:[e],options:{position:t,count:r}},a)}},43769:(e,t,r)=>{r.d(t,{Qf:()=>s});class a{async process(e,t){let{files:a,options:s={}}=e;if(0===a.length)return{success:!1,error:{code:"FILE_EMPTY",message:"No PDF files provided",category:"VALIDATION_ERROR",recoverable:!0}};try{var n;let e=new(await Promise.all([r.e(29),r.e(496)]).then(r.t.bind(r,7496,23))).default,i=a.length;for(let r=0;r<a.length;r++){if(this.cancelled)return{success:!1,error:{code:"PROCESSING_CANCELLED",message:"Operation cancelled",category:"PROCESSING_ERROR",recoverable:!0}};let s=a[r],n=await s.arrayBuffer();e.file(s.name,n),this.progress=Math.round((r+1)/i*80),null==t||t(this.progress,"Adding ".concat(s.name," (").concat(r+1,"/").concat(i,")"))}null==t||t(85,"Compressing files...");let o=null!=(n=s.compressionLevel)?n:6,c=await e.generateAsync({type:"blob",compression:o>0?"DEFLATE":"STORE",compressionOptions:{level:o}},e=>{let r=85+Math.round(.15*e.percent);this.progress=r,null==t||t(r,"Compressing files...")});this.progress=100,null==t||t(100,"Complete");let l=s.outputFilename||"pdfs.zip";return{success:!0,result:c,filename:l,metadata:{fileCount:a.length,totalSize:c.size,filenames:a.map(e=>e.name)}}}catch(e){return{success:!1,error:{code:"PROCESSING_FAILED",message:e instanceof Error?e.message:"Failed to create ZIP archive",category:"PROCESSING_ERROR",recoverable:!0}}}}async validate(e){let t=[];for(let r of e)r.name.toLowerCase().endsWith(".pdf")||"application/pdf"===r.type||t.push({code:"FILE_TYPE_INVALID",message:'File "'.concat(r.name,'" must be a PDF'),category:"FILE_ERROR",recoverable:!0});return{valid:0===t.length,errors:t}}getProgress(){return this.progress}cancel(){this.cancelled=!0}constructor(){this.progress=0,this.cancelled=!1}}async function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0;return new a().process({files:e,options:t},r)}},47431:(e,t,r)=>{r.d(t,{T5:()=>c});var a=r(78752),s=r(18365),n=r(32096);let i={flattenForms:!0,flattenAnnotations:!0,flattenLayers:!0};class o extends s.A{async process(e,t){this.reset(),this.onProgress=t;let{files:r,options:s}=e,o={...i,...s};if(1!==r.length)return this.createErrorOutput(a.GS.INVALID_OPTIONS,"Please provide exactly one PDF file to flatten.","Received ".concat(r.length," file(s)."));let c=r[0];try{let e;this.updateProgress(5,"Loading PDF library...");let t=await (0,n.Ck)();if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");this.updateProgress(10,"Reading PDF file...");let r=await c.arrayBuffer(),s=r.byteLength;this.updateProgress(20,"Loading PDF document...");try{e=await t.PDFDocument.load(r,{ignoreEncryption:!0})}catch(e){if(e instanceof Error&&e.message.includes("encrypt"))return this.createErrorOutput(a.GS.PDF_ENCRYPTED,"The PDF file is encrypted.","Please decrypt the file before flattening.");throw e}if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");this.updateProgress(30,"Analyzing PDF structure...");let i=e.getPageCount();if(0===i)return this.createErrorOutput(a.GS.PDF_MALFORMED,"The PDF file contains no pages.","Cannot flatten an empty PDF.");let u=[],d=!1;if(this.updateProgress(50,"Flattening form fields..."),o.flattenForms)try{let t=e.getForm(),r=t.getFields();r.length>0&&(d=!0,t.flatten(),u.push("".concat(r.length," form field(s)")))}catch(e){var l;(null==(l=e.message)?void 0:l.includes("getForm"))||console.warn("Could not flatten forms:",e.message)}if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");this.updateProgress(80,"Saving flattened PDF...");let p=await e.save({useObjectStreams:!0}),h=new Blob([new Uint8Array(p)],{type:"application/pdf"}),g=p.length;this.updateProgress(100,"Complete!");let f=function(e){let t=e.lastIndexOf("."),r=-1===t?e:e.slice(0,t);return"".concat(r,"_flattened.pdf")}(c.name);return this.createSuccessOutput(h,f,{pageCount:i,originalSize:s,newSize:g,flattenedItems:u,hasFormFields:d,flattened:!0})}catch(e){return this.createErrorOutput(a.GS.PROCESSING_FAILED,"Failed to flatten PDF file.",e instanceof Error?e.message:"Unknown error")}}getAcceptedTypes(){return["application/pdf"]}}async function c(e,t,r){return new o().process({files:[e],options:t||{}},r)}},55092:(e,t,r)=>{r.d(t,{ec:()=>c,nf:()=>l});var a=r(78752),s=r(18365);let n={useObjectStreams:!0,addDefaultPage:!1};class i extends s.A{async process(e,t){this.reset(),this.onProgress=t;let{files:r,options:s}=e,i={...n,...s};if(0===r.length)return this.createErrorOutput(a.GS.INVALID_OPTIONS,"Please provide at least one PDF file to linearize.","No files were provided.");try{if(1===r.length)return await this.processSingleFile(r[0],i);return await this.processMultipleFiles(r,i)}catch(e){return this.terminateWorker(),this.createErrorOutput(a.GS.PROCESSING_FAILED,"Failed to linearize PDF file.",e instanceof Error?e.message:"Unknown error")}}async processSingleFile(e,t){this.updateProgress(5,"Reading PDF file...");let r=await e.arrayBuffer(),s=r.byteLength;if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");this.updateProgress(10,"Starting linearization...");let n=await this.linearizeWithWorker(r,t);if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");let i=new Blob([n.pdfBytes],{type:"application/pdf"});this.updateProgress(100,"Complete!");let c=o(e.name);return this.createSuccessOutput(i,c,{pageCount:n.pageCount,originalSize:s,linearizedSize:n.linearizedSize,optimized:!0})}async processMultipleFiles(e,t){let s=[],n=e.length,i=0,c=0,l=0;for(let r=0;r<e.length;r++){let u=e[r],d=r/n*80+10;this.updateProgress(d,"Processing file ".concat(r+1," of ").concat(n,"..."));let p=await u.arrayBuffer();if(i+=p.byteLength,this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");try{let e=await this.linearizeWithWorker(p,t);c+=e.linearizedSize,l+=e.pageCount;let r=new Blob([e.pdfBytes],{type:"application/pdf"});s.push({blob:r,filename:o(u.name)})}catch(e){continue}}if(0===s.length)return this.createErrorOutput(a.GS.PROCESSING_FAILED,"No PDF files could be processed.","All files may be corrupted or invalid.");if(this.updateProgress(95,"Packaging results..."),1===s.length)return this.updateProgress(100,"Complete!"),this.createSuccessOutput(s[0].blob,s[0].filename,{pageCount:l,originalSize:i,linearizedSize:c,filesProcessed:1});let{default:u}=await Promise.all([r.e(29),r.e(496)]).then(r.t.bind(r,7496,23)),d=new u;for(let e of s)d.file(e.filename,e.blob);let p=await d.generateAsync({type:"blob"});return this.updateProgress(100,"Complete!"),this.createSuccessOutput(p,"linearized_pdfs.zip",{totalPages:l,originalSize:i,linearizedSize:c,filesProcessed:s.length})}linearizeWithWorker(e,t){return new Promise((r,a)=>{try{this.worker=new Worker("/workers/linearize.worker.js"),this.worker.onmessage=e=>{let t=e.data;if("progress"===t.status){let e=10+t.progress/100*85;this.updateProgress(e,"Linearizing PDF...")}else"success"===t.status?(this.terminateWorker(),r({pdfBytes:t.pdfBytes,linearizedSize:t.linearizedSize,pageCount:t.pageCount})):"error"===t.status&&(this.terminateWorker(),a(Error(t.message)))},this.worker.onerror=e=>{this.terminateWorker(),a(Error("Worker error: ".concat(e.message)))},this.worker.postMessage({command:"linearize",pdfData:e,options:{useObjectStreams:t.useObjectStreams}},[e])}catch(e){this.terminateWorker(),a(e)}})}terminateWorker(){this.worker&&(this.worker.terminate(),this.worker=null)}cancel(){super.cancel(),this.terminateWorker()}getAcceptedTypes(){return["application/pdf"]}constructor(...e){super(...e),this.worker=null}}function o(e){let t=e.lastIndexOf("."),r=-1===t?e:e.slice(0,t);return"".concat(r,"_linearized.pdf")}async function c(e,t,r){return new i().process({files:[e],options:t||{}},r)}async function l(e,t,r){return new i().process({files:e,options:t||{}},r)}},56772:(e,t,r)=>{r.d(t,{Qb:()=>p});var a=r(78752),s=r(18365);let n={printing:!0,modifying:!0,copying:!0,annotating:!0,fillingForms:!0,contentAccessibility:!0,documentAssembly:!0},i={userPassword:"",ownerPassword:"",permissions:n},o=null,c=null;async function l(){return o||c||(c=new Promise((e,t)=>{if(window.Module&&"function"==typeof window.Module)return void u(e,t);let r=document.createElement("script");r.src="/qpdf.js",r.async=!0,r.onload=()=>{u(e,t)},r.onerror=()=>{c=null,t(Error("Failed to load QPDF script"))},document.head.appendChild(r)}))}function u(e,t){try{let r=window.Module;if(!r||"function"!=typeof r)return void t(Error("QPDF module not found after script load"));r({locateFile:e=>e.endsWith(".wasm")?"/qpdf.wasm":e}).then(t=>{o=t,e(t)}).catch(e=>{c=null,t(e)})}catch(e){c=null,t(e)}}class d extends s.A{async process(e,t){let r;this.reset(),this.onProgress=t;let{files:s,options:o}=e,c={...i,...o,permissions:{...n,...(null==o?void 0:o.permissions)||{}}};if(1!==s.length)return this.createErrorOutput(a.GS.INVALID_OPTIONS,"Please provide exactly one PDF file to encrypt.","Received ".concat(s.length," file(s)."));if(!c.userPassword&&!c.ownerPassword)return this.createErrorOutput(a.GS.INVALID_OPTIONS,"Please provide at least one password.","Either user password or owner password is required.");let u=s[0],d="/input.pdf",p="/output.pdf";try{if(this.updateProgress(5,"Initializing encryption engine..."),r=await l(),this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");this.updateProgress(15,"Reading PDF file...");let e=await u.arrayBuffer(),t=e.byteLength,s=new Uint8Array(e);if(r.FS.writeFile(d,s),this.updateProgress(30,"Preparing encryption..."),this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");this.updateProgress(50,"Encrypting PDF with 256-bit AES...");let n=c.userPassword||"",i=c.ownerPassword||n,o=!!c.ownerPassword&&c.ownerPassword!==c.userPassword,h=[d,"--encrypt",n,i,"256"];if(o){let e=c.permissions;e.modifying||h.push("--modify=none"),e.copying||h.push("--extract=n"),e.printing||h.push("--print=none"),e.contentAccessibility||h.push("--accessibility=n"),e.annotating||h.push("--annotate=n"),e.documentAssembly||h.push("--assemble=n"),e.fillingForms||h.push("--form=n")}h.push("--",p);try{r.callMain(h)}catch(e){throw console.error("qpdf execution error:",e),Error("Encryption failed: "+(e.message||"Unknown error"))}if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");this.updateProgress(80,"Preparing encrypted file...");let g=r.FS.readFile(p,{encoding:"binary"});if(!g||0===g.length)throw Error("Encryption resulted in an empty file.");let f=new Blob([g],{type:"application/pdf"}),P=g.length;try{r.FS.unlink(d)}catch(e){console.warn("Failed to unlink input file:",e)}try{r.FS.unlink(p)}catch(e){console.warn("Failed to unlink output file:",e)}this.updateProgress(100,"Complete!");let E=function(e){let t=e.lastIndexOf("."),r=-1===t?e:e.slice(0,t);return"".concat(r,"_encrypted.pdf")}(u.name);return this.createSuccessOutput(f,E,{originalSize:t,newSize:P,hasUserPassword:!!c.userPassword,hasOwnerPassword:!!c.ownerPassword,permissions:c.permissions,encryptionMethod:"256-bit AES"})}catch(e){if(null==r?void 0:r.FS){try{r.FS.unlink(d)}catch(e){}try{r.FS.unlink(p)}catch(e){}}return this.createErrorOutput(a.GS.PROCESSING_FAILED,"Failed to encrypt PDF file.",e instanceof Error?e.message:"Unknown error")}}getAcceptedTypes(){return["application/pdf"]}}async function p(e,t,r){return new d().process({files:[e],options:t||{}},r)}},59724:(e,t,r)=>{r.d(t,{Gt:()=>l,parsePageSelection:()=>c});var a=r(78752),s=r(18365),n=r(32096);let i={pages:[]};class o extends s.A{async process(e,t){this.reset(),this.onProgress=t;let{files:r,options:s}=e,o={...i,...s};if(1!==r.length)return this.createErrorOutput(a.GS.INVALID_OPTIONS,"Exactly 1 PDF file is required for deletion.","Received ".concat(r.length," file(s)."));if(!o.pages||0===o.pages.length)return this.createErrorOutput(a.GS.INVALID_OPTIONS,"At least one page is required for deletion.","Please specify pages to delete.");try{let e;this.updateProgress(5,"Loading PDF library...");let t=await (0,n.Ck)();if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");this.updateProgress(10,"Loading source PDF...");let s=r[0],i=await s.arrayBuffer();try{e=await t.PDFDocument.load(i,{ignoreEncryption:!1})}catch(e){if(e instanceof Error&&e.message.includes("encrypt"))return this.createErrorOutput(a.GS.PDF_ENCRYPTED,"The PDF file is encrypted.","Please decrypt the file before deleting pages.");throw e}let c=e.getPageCount();this.updateProgress(20,"Source PDF has ".concat(c," pages."));let l=function(e,t){if(0===e.length)return"No pages specified for deletion.";for(let r=0;r<e.length;r++){let a=e[r];if(!Number.isInteger(a))return"Invalid page number: ".concat(a);if(a<1)return"Page number must be at least 1. Found ".concat(a,".");if(a>t)return"Page ".concat(a," exceeds total pages (").concat(t,").")}return null}(o.pages,c);if(l)return this.createErrorOutput(a.GS.INVALID_PAGE_RANGE,l,"The PDF has ".concat(c," pages."));let u=[...new Set(o.pages)].sort((e,t)=>t-e);if(u.length>=c)return this.createErrorOutput(a.GS.INVALID_OPTIONS,"Cannot delete all pages from the PDF.","At least one page must remain in the document.");if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");this.updateProgress(30,"Deleting pages...");let d=60/u.length;for(let t=0;t<u.length;t++){if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");let r=u[t],s=r-1;this.updateProgress(30+t*d,"Deleting page ".concat(r,"...")),e.removePage(s)}this.updateProgress(90,"Saving modified PDF...");let p=await e.save({useObjectStreams:!0}),h=new Blob([new Uint8Array(p)],{type:"application/pdf"});this.updateProgress(100,"Complete!");let g=function(e,t){let r=function(e){let t=e.lastIndexOf(".");return -1===t?e:e.slice(0,t)}(e);return"".concat(r,"_").concat(t,"_pages_deleted.pdf")}(s.name,u.length);return this.createSuccessOutput(h,g,{deletedPageCount:u.length,originalPageCount:c,remainingPageCount:c-u.length,deletedPages:u.sort((e,t)=>e-t)})}catch(e){return this.createErrorOutput(a.GS.PROCESSING_FAILED,"Failed to delete pages from PDF file.",e instanceof Error?e.message:"Unknown error")}}getAcceptedTypes(){return["application/pdf"]}}function c(e,t){let r=[];for(let a of e.split(",").map(e=>e.trim()).filter(e=>e.length>0))if(a.includes("-")){let[e,s]=a.split("-").map(e=>e.trim()),n=parseInt(e,10),i=parseInt(s,10);if(!isNaN(n)&&!isNaN(i)&&n<=i)for(let e=n;e<=Math.min(i,t);e++)e>=1&&r.push(e)}else{let e=parseInt(a,10);!isNaN(e)&&e>=1&&e<=t&&r.push(e)}return[...new Set(r)].sort((e,t)=>e-t)}async function l(e,t,r){return new o().process({files:[e],options:{pages:t}},r)}},71538:(e,t,r)=>{r.d(t,{WG:()=>i});var a=r(78752),s=r(18365);class n extends s.A{async initWorker(){if(!this.worker)return new Promise((e,t)=>{try{this.worker=new Worker("/workers/epub-to-pdf.worker.js",{type:"module"});let r=r=>{let{type:a,error:s,message:n}=r.data;"init-complete"===a?(this.workerReady=!0,e()):"status"===a?this.updateProgress(0,n):"error"===a&&t(Error(s||"Worker initialization failed"))};this.worker.addEventListener("message",r),this.worker.addEventListener("error",()=>{t(Error("Worker connection failed"))}),this.worker.postMessage({type:"init",id:"init-"+Date.now(),data:{}})}catch(e){t(e)}})}terminateWorker(){this.worker&&(this.worker.terminate(),this.worker=null,this.workerReady=!1)}reset(){super.reset()}async process(e,t){this.reset(),this.onProgress=t;let{files:r}=e;if(1!==r.length)return this.createErrorOutput(a.GS.INVALID_OPTIONS,"Please provide exactly one EPUB file.","Received ".concat(r.length," file(s)."));let s=r[0];if(!s.name.toLowerCase().endsWith(".epub"))return this.createErrorOutput(a.GS.FILE_TYPE_INVALID,"Invalid file type. Please upload an EPUB file.","Received: ".concat(s.type||s.name));try{this.updateProgress(10,"Initializing converter...");try{await this.initWorker()}catch(e){return console.error("Failed to initialize worker:",e),this.createErrorOutput(a.GS.WORKER_FAILED,"Failed to initialize conversion worker.",e instanceof Error?e.message:String(e))}if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");this.updateProgress(30,"Converting EPUB to PDF...");let e=await new Promise((e,t)=>{if(!this.worker)return void t(Error("Worker not initialized"));let r="convert-"+Date.now(),a=a=>{let{type:s,id:n,result:o,error:c,message:l}=a.data;if("status"===s)return void this.updateProgress(this.progress,l);n===r&&("convert-complete"===s?(i(),e(o)):"error"===s&&(i(),t(Error(c||"Conversion failed"))))},n=e=>{i(),t(Error("Worker error: "+e.message))},i=()=>{var e,t;null==(e=this.worker)||e.removeEventListener("message",a),null==(t=this.worker)||t.removeEventListener("error",n)};this.worker.addEventListener("message",a),this.worker.addEventListener("error",n),this.worker.postMessage({type:"convert",id:r,data:{file:s}})});if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");this.updateProgress(100,"Conversion complete!");let t=s.name.replace(/\.epub$/i,"");return this.createSuccessOutput(e,"".concat(t,".pdf"),{format:"pdf"})}catch(e){return console.error("Conversion error:",e),this.terminateWorker(),this.createErrorOutput(a.GS.PROCESSING_FAILED,"Failed to convert EPUB to PDF.",e instanceof Error?e.message:"Unknown error")}}constructor(...e){super(...e),this.worker=null,this.workerReady=!1}}async function i(e,t,r){return new n().process({files:[e],options:t||{}},r)}},72151:(e,t,r)=>{r.d(t,{GU:()=>c});var a=r(78752),s=r(18365),n=r(32096);let i={updateModificationDate:!0};class o extends s.A{async process(e,t){var r,s;this.reset(),this.onProgress=t;let{files:o,options:c}=e;if(!c.metadata)return this.createErrorOutput(a.GS.INVALID_OPTIONS,"Metadata object is required.","Please provide metadata fields to update.");let l={metadata:c.metadata,updateModificationDate:null==(s=null!=(r=c.updateModificationDate)?r:i.updateModificationDate)||s};if(1!==o.length)return this.createErrorOutput(a.GS.INVALID_OPTIONS,"Exactly 1 PDF file is required for editing metadata.","Received ".concat(o.length," file(s)."));let u=o[0];try{this.updateProgress(10,"Loading PDF library...");let e=await (0,n.Ck)();if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");this.updateProgress(20,"Reading PDF file...");let t=await u.arrayBuffer();if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");this.updateProgress(40,"Loading PDF document...");let r=await e.PDFDocument.load(t,{ignoreEncryption:!1,updateMetadata:!0});if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");this.updateProgress(60,"Updating metadata...");let{metadata:s}=l;if(void 0!==s.title&&r.setTitle(s.title),void 0!==s.author&&r.setAuthor(s.author),void 0!==s.subject&&r.setSubject(s.subject),void 0!==s.keywords&&r.setKeywords(s.keywords),void 0!==s.creator&&r.setCreator(s.creator),void 0!==s.producer&&r.setProducer(s.producer),l.updateModificationDate&&r.setModificationDate(new Date),this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");this.updateProgress(80,"Saving PDF...");let i=await r.save({useObjectStreams:!0}),o=new Blob([new Uint8Array(i)],{type:"application/pdf"});this.updateProgress(100,"Complete!");let c=function(e){let t=e.lastIndexOf("."),r=-1===t?e:e.slice(0,t);return"".concat(r,"_edited.pdf")}(u.name);return this.createSuccessOutput(o,c,{updatedFields:Object.keys(s).filter(e=>void 0!==s[e])})}catch(e){if(e instanceof Error&&e.message.includes("encrypt"))return this.createErrorOutput(a.GS.PDF_ENCRYPTED,"This PDF is encrypted.","Please decrypt the file before editing metadata.");return this.createErrorOutput(a.GS.PROCESSING_FAILED,"Failed to edit PDF metadata.",e instanceof Error?e.message:"Unknown error")}}getAcceptedTypes(){return["application/pdf"]}}async function c(e,t,r,a){return new o().process({files:[e],options:{metadata:t,...r}},a)}},72398:(e,t,r)=>{r.d(t,{Nu:()=>o});var a=r(78752),s=r(18365),n=r(32096);class i extends s.A{async process(e,t){this.reset(),this.onProgress=t;let{files:r,options:s}=e,i={pages:"all",scale:3,...s};if(1!==r.length)return this.createErrorOutput(a.GS.INVALID_OPTIONS,"Exactly 1 PDF file is required.");try{this.updateProgress(5,"Loading PDF libraries...");let[e,t]=await Promise.all([(0,n.Ck)(),(0,n.Iy)()]);this.updateProgress(10,"Loading PDF...");let s=r[0],o=await s.arrayBuffer(),c=await t.getDocument({data:o}).promise,l=c.numPages,u="all"===i.pages?Array.from({length:l},(e,t)=>t+1):i.pages,d=await e.PDFDocument.create();this.updateProgress(15,"Inverting colors...");for(let e=0;e<u.length;e++){if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");let t=u[e],r=15+75*(e/u.length);this.updateProgress(r,"Processing page ".concat(t," of ").concat(l,"..."));let s=await c.getPage(t),n=s.getViewport({scale:1}),o=n.width,p=n.height,h=i.scale||3,g=s.getViewport({scale:h}),f=document.createElement("canvas");f.width=g.width,f.height=g.height;let P=f.getContext("2d");await s.render({canvasContext:P,viewport:g}).promise;let E=P.getImageData(0,0,f.width,f.height),w=E.data;for(let e=0;e<w.length;e+=4)w[e]=255-w[e],w[e+1]=255-w[e+1],w[e+2]=255-w[e+2];P.putImageData(E,0,0);let m=await this.canvasToPngBytes(f),S=await d.embedPng(m);d.addPage([o,p]).drawImage(S,{x:0,y:0,width:o,height:p})}this.updateProgress(95,"Saving PDF...");let p=await d.save({useObjectStreams:!0}),h=new Blob([new Uint8Array(p)],{type:"application/pdf"});return this.updateProgress(100,"Complete!"),this.createSuccessOutput(h,s.name.replace(".pdf","_inverted.pdf"),{pageCount:u.length})}catch(e){return this.createErrorOutput(a.GS.PROCESSING_FAILED,"Failed to invert colors.",e instanceof Error?e.message:"Unknown error")}}canvasToPngBytes(e){return new Promise((t,r)=>{e.toBlob(e=>{if(!e)return void r(Error("Failed to convert canvas to blob"));let a=new FileReader;a.onload=()=>t(new Uint8Array(a.result)),a.onerror=()=>r(Error("Failed to read blob")),a.readAsArrayBuffer(e)},"image/png")})}getAcceptedTypes(){return["application/pdf"]}}async function o(e,t,r){return new i().process({files:[e],options:t},r)}},73391:(e,t,r)=>{r.d(t,{Cr:()=>u});var a=r(78752),s=r(18365),n=r(32096);let i={format:"png",quality:.92,scale:2,pages:[],backgroundColor:"#ffffff"},o={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",webp:"image/webp",bmp:"image/bmp",tiff:"image/tiff"},c={png:".png",jpg:".jpg",jpeg:".jpg",webp:".webp",bmp:".bmp",tiff:".tiff"};class l extends s.A{async process(e,t){this.reset(),this.onProgress=t;let{files:r,options:s}=e,o={...i,...s};if(1!==r.length)return this.createErrorOutput(a.GS.INVALID_OPTIONS,"Please provide exactly one PDF file.","Received ".concat(r.length," file(s)."));let l=r[0];if(!l.type.includes("pdf")&&!l.name.toLowerCase().endsWith(".pdf"))return this.createErrorOutput(a.GS.FILE_TYPE_INVALID,"Invalid file type. Please upload a PDF file.","Received: ".concat(l.type||"unknown"));try{this.updateProgress(5,"Loading PDF library...");let e=await (0,n.Iy)();if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");this.updateProgress(10,"Loading PDF document...");let t=await l.arrayBuffer(),r=await e.getDocument({data:t}).promise,s=r.numPages,i=o.pages.length>0?o.pages.filter(e=>e>=1&&e<=s):Array.from({length:s},(e,t)=>t+1);if(0===i.length)return this.createErrorOutput(a.GS.INVALID_PAGE_RANGE,"No valid pages to convert.","PDF has ".concat(s," pages."));this.updateProgress(15,"Converting ".concat(i.length," page(s)..."));let u=[],d=80/i.length;for(let e=0;e<i.length;e++){if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");let t=i[e],n=15+e*d;this.updateProgress(n,"Converting page ".concat(t," of ").concat(s,"..."));try{let e=await this.renderPageToImage(r,t,o);u.push(e)}catch(e){return this.createErrorOutput(a.GS.PROCESSING_FAILED,"Failed to convert page ".concat(t,"."),e instanceof Error?e.message:"Unknown error")}}this.updateProgress(95,"Finalizing...");let p=l.name.replace(/\.pdf$/i,""),h=c[o.format];if(1===u.length)return this.updateProgress(100,"Complete!"),this.createSuccessOutput(u[0],"".concat(p).concat(h),{pageCount:1,format:o.format});return this.updateProgress(100,"Complete!"),this.createSuccessOutput(u,"".concat(p,"_pages").concat(h),{pageCount:u.length,format:o.format})}catch(e){return this.createErrorOutput(a.GS.PROCESSING_FAILED,"Failed to convert PDF to images.",e instanceof Error?e.message:"Unknown error")}}async renderPageToImage(e,t,r){let a=await e.getPage(t),s=a.getViewport({scale:r.scale}),n=document.createElement("canvas");n.width=s.width,n.height=s.height;let i=n.getContext("2d");if(!i)throw Error("Failed to get canvas context");i.fillStyle=r.backgroundColor,i.fillRect(0,0,n.width,n.height),await a.render({canvasContext:i,viewport:s}).promise;let c=o[r.format],l=["jpg","jpeg","webp"].includes(r.format)?r.quality:void 0;return new Promise((e,t)=>{n.toBlob(r=>{r?e(r):t(Error("Failed to create image blob"))},c,l)})}}async function u(e,t,r){return new l().process({files:[e],options:t||{}},r)}},73468:(e,t,r)=>{r.d(t,{ci:()=>i});var a=r(78752),s=r(18365);class n extends s.A{async initWorker(){if(!this.worker)return new Promise((e,t)=>{try{this.worker=new Worker("/workers/fb2-to-pdf.worker.js",{type:"module"});let r=r=>{let{type:a,error:s,message:n}=r.data;"init-complete"===a?(this.workerReady=!0,e()):"status"===a?this.updateProgress(0,n):"error"===a&&t(Error(s||"Worker initialization failed"))};this.worker.addEventListener("message",r),this.worker.addEventListener("error",()=>{t(Error("Worker connection failed"))}),this.worker.postMessage({type:"init",id:"init-"+Date.now(),data:{}})}catch(e){t(e)}})}terminateWorker(){this.worker&&(this.worker.terminate(),this.worker=null,this.workerReady=!1)}reset(){super.reset()}async process(e,t){this.reset(),this.onProgress=t;let{files:r}=e;if(0===r.length)return this.createErrorOutput(a.GS.INVALID_OPTIONS,"Please provide at least one FB2 file.","No files received.");for(let e of r)if(!e.name.toLowerCase().endsWith(".fb2")&&!e.name.toLowerCase().endsWith(".fb2.zip"))return this.createErrorOutput(a.GS.FILE_TYPE_INVALID,"Invalid file type. Please upload FB2 files (.fb2, .fb2.zip).","Received: ".concat(e.type||e.name));try{this.updateProgress(10,"Initializing converter...");try{await this.initWorker()}catch(e){return console.error("Failed to initialize worker:",e),this.createErrorOutput(a.GS.WORKER_FAILED,"Failed to initialize conversion worker.",e instanceof Error?e.message:String(e))}if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");if(1===r.length)return await this.processSingleFile(r[0]);return await this.processMultipleFiles(r)}catch(e){return console.error("Conversion error:",e),this.terminateWorker(),this.createErrorOutput(a.GS.PROCESSING_FAILED,"Failed to convert FB2 to PDF.",e instanceof Error?e.message:"Unknown error")}}async processSingleFile(e){this.updateProgress(30,"Converting FB2 to PDF...");let t=await this.convertFile(e);if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");this.updateProgress(100,"Conversion complete!");let r=e.name.replace(/\.fb2(\.zip)?$/i,"");return this.createSuccessOutput(t,"".concat(r,".pdf"),{format:"pdf"})}async processMultipleFiles(e){let t=[],r=e.length;for(let s=0;s<r;s++){let n=e[s],i=30+60*s/r;this.updateProgress(i,"Converting ".concat(s+1,"/").concat(r,": ").concat(n.name,"..."));let o=await this.convertFile(n);if(t.push(o),this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.")}return this.updateProgress(100,"All conversions complete!"),this.createSuccessOutput(t,"fb2-converted.pdf",{format:"pdf"})}async convertFile(e){return new Promise((t,r)=>{if(!this.worker)return void r(Error("Worker not initialized"));let a="convert-"+Date.now()+"-"+Math.random(),s=e=>{let{type:s,id:n,result:o,error:c}=e.data;"status"!==s&&n===a&&("convert-complete"===s?(i(),t(o)):"error"===s&&(i(),r(Error(c||"Conversion failed"))))},n=e=>{i(),r(Error("Worker error: "+e.message))},i=()=>{var e,t;null==(e=this.worker)||e.removeEventListener("message",s),null==(t=this.worker)||t.removeEventListener("error",n)};this.worker.addEventListener("message",s),this.worker.addEventListener("error",n),this.worker.postMessage({type:"convert",id:a,data:{file:e}})})}constructor(...e){super(...e),this.worker=null,this.workerReady=!1}}async function i(e,t,r){let a=new n,s=Array.isArray(e)?e:[e];return a.process({files:s,options:t||{}},r)}},76285:(e,t,r)=>{r.d(t,{$U:()=>d,Mt:()=>l,fh:()=>u,rP:()=>c});var a=r(78752),s=r(18365),n=r(32096);let i={ranges:[],outputFormat:"multiple"};class o extends s.A{async process(e,t){this.reset(),this.onProgress=t;let{files:r,options:s}=e,o={...i,...s};if(1!==r.length)return this.createErrorOutput(a.GS.INVALID_OPTIONS,"Exactly 1 PDF file is required for splitting.","Received ".concat(r.length," file(s)."));if(!o.ranges||0===o.ranges.length)return this.createErrorOutput(a.GS.INVALID_OPTIONS,"At least one page range is required for splitting.","Please specify page ranges to extract.");try{let e;this.updateProgress(5,"Loading PDF library...");let t=await (0,n.Ck)();if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");this.updateProgress(10,"Loading source PDF...");let s=r[0],i=await s.arrayBuffer();try{e=await t.PDFDocument.load(i,{ignoreEncryption:!1})}catch(e){if(e instanceof Error&&e.message.includes("encrypt"))return this.createErrorOutput(a.GS.PDF_ENCRYPTED,"The PDF file is encrypted.","Please decrypt the file before splitting.");throw e}let c=e.getPageCount();this.updateProgress(15,"Source PDF has ".concat(c," pages."));let l=function(e,t){for(let r=0;r<e.length;r++){let a=e[r];if(a.start<1)return"Range ".concat(r+1,": Start page must be at least 1.");if(a.end<a.start)return"Range ".concat(r+1,": End page (").concat(a.end,") cannot be less than start page (").concat(a.start,").");if(a.end>t)return"Range ".concat(r+1,": End page (").concat(a.end,") exceeds total pages (").concat(t,").");if(a.start>t)return"Range ".concat(r+1,": Start page (").concat(a.start,") exceeds total pages (").concat(t,").")}return null}(o.ranges,c);if(l)return this.createErrorOutput(a.GS.INVALID_PAGE_RANGE,l,"The PDF has ".concat(c," pages."));if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");let u=[],d=[],p=75/o.ranges.length;for(let r=0;r<o.ranges.length;r++){if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");let n=o.ranges[r],i=15+r*p;this.updateProgress(i,"Extracting pages ".concat(n.start,"-").concat(n.end,"..."));let c=await t.PDFDocument.create(),l=[];for(let e=n.start;e<=n.end;e++)l.push(e-1);for(let t of(await c.copyPages(e,l)))c.addPage(t);let h=await c.save({useObjectStreams:!0}),g=new Blob([new Uint8Array(h)],{type:"application/pdf"});u.push(g);let f=function(e,t,r,a){let s=function(e){let t=e.lastIndexOf(".");return -1===t?e:e.slice(0,t)}(e);return 1===a?t.start===t.end?"".concat(s,"_page_").concat(t.start,".pdf"):"".concat(s,"_pages_").concat(t.start,"-").concat(t.end,".pdf"):t.start===t.end?"".concat(s,"_part").concat(r,"_page_").concat(t.start,".pdf"):"".concat(s,"_part").concat(r,"_pages_").concat(t.start,"-").concat(t.end,".pdf")}(s.name,n,r+1,o.ranges.length);d.push(f)}if(this.updateProgress(95,"Finalizing..."),1===u.length)return this.updateProgress(100,"Complete!"),this.createSuccessOutput(u[0],d[0],{pageCount:o.ranges[0].end-o.ranges[0].start+1,rangeCount:1,sourcePageCount:c});return this.updateProgress(100,"Complete!"),{success:!0,result:u,filename:d.join(", "),metadata:{rangeCount:o.ranges.length,sourcePageCount:c,outputFiles:d}}}catch(e){return this.createErrorOutput(a.GS.PROCESSING_FAILED,"Failed to split PDF file.",e instanceof Error?e.message:"Unknown error")}}getAcceptedTypes(){return["application/pdf"]}}function c(e,t){let r=[];for(let t of e.split(",").map(e=>e.trim()).filter(e=>e.length>0))if(t.includes("-")){let[e,a]=t.split("-").map(e=>e.trim()),s=parseInt(e,10),n=parseInt(a,10);isNaN(s)||isNaN(n)||r.push({start:s,end:n})}else{let e=parseInt(t,10);isNaN(e)||r.push({start:e,end:e})}return r}function l(e,t){let r=[];for(let a=1;a<=e;a+=t){let s=Math.min(a+t-1,e);r.push({start:a,end:s})}return r}function u(e){return l(e,1)}async function d(e,t,r){return new o().process({files:[e],options:t||{}},r)}},76480:(e,t,r)=>{r.d(t,{WS:()=>p});var a=r(78752),s=r(18365);let n={password:""},i=null,o=null,c=[];async function l(){return i||o||(o=new Promise((e,t)=>{if(window.Module&&"function"==typeof window.Module)return void u(e,t);let r=document.createElement("script");r.src="/qpdf.js",r.async=!0,r.onload=()=>{u(e,t)},r.onerror=()=>{o=null,t(Error("Failed to load QPDF script"))},document.head.appendChild(r)}))}function u(e,t){try{let r=window.Module;if(!r||"function"!=typeof r)return void t(Error("QPDF module not found after script load"));r({locateFile:e=>e.endsWith(".wasm")?"/qpdf.wasm":e}).then(t=>{i=t,e(t)}).catch(e=>{o=null,t(e)})}catch(e){o=null,t(e)}}class d extends s.A{async process(e,t){let r;this.reset(),this.onProgress=t;let{files:s,options:i}=e,o={...n,...i};if(1!==s.length)return this.createErrorOutput(a.GS.INVALID_OPTIONS,"Please provide exactly one PDF file to decrypt.","Received ".concat(s.length," file(s)."));if(!o.password)return this.createErrorOutput(a.GS.INVALID_OPTIONS,"Please provide the PDF password.","A password is required to decrypt the PDF.");let u=s[0],d="/input.pdf",p="/output.pdf";try{if(this.updateProgress(5,"Initializing decryption engine..."),r=await l(),this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");this.updateProgress(15,"Reading encrypted PDF...");let e=await u.arrayBuffer(),t=e.byteLength,s=new Uint8Array(e);if(r.FS.writeFile(d,s),this.updateProgress(30,"Preparing decryption..."),this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");this.updateProgress(50,"Decrypting PDF...");let n=[d,"--password="+o.password,"--decrypt",p];c=[];let i=console.error;console.error=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];let a=t.map(e=>String(e)).join(" ");c.push(a),i.apply(console,t)};let h=null;try{r.callMain(n)}catch(e){h=e}finally{console.error=i}let g=!1,f=null;try{g=!!((f=r.FS.readFile(p,{encoding:"binary"}))&&f.length>0)}catch(e){g=!1}if(!g){let e=c.join(" ").toLowerCase(),t=e.includes("invalid password")||e.includes("incorrect password")||e.includes("wrong password");if(t||h){let e=h?String(h.message||h||"").toLowerCase():"";if(t||e.includes("invalid password")||e.includes("incorrect password")||e.includes("wrong password")||e.includes("password"))return this.createErrorOutput(a.GS.PDF_ENCRYPTED,"INVALID_PASSWORD","The password you entered is incorrect. Please check and try again.");throw h||Error("Decryption failed")}return this.createErrorOutput(a.GS.PDF_ENCRYPTED,"INVALID_PASSWORD","The password you entered is incorrect. Please check and try again.")}if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");this.updateProgress(80,"Preparing decrypted file...");let P=new Blob([new Uint8Array(f)],{type:"application/pdf"}),E=f.length;try{r.FS.unlink(d)}catch(e){console.warn("Failed to unlink input file:",e)}try{r.FS.unlink(p)}catch(e){console.warn("Failed to unlink output file:",e)}this.updateProgress(100,"Complete!");let w=function(e){let t=e.lastIndexOf("."),r=-1===t?e:e.slice(0,t);return"".concat(r,"_decrypted.pdf")}(u.name);return this.createSuccessOutput(P,w,{originalSize:t,newSize:E,decrypted:!0})}catch(t){if(null==r?void 0:r.FS){try{r.FS.unlink(d)}catch(e){}try{r.FS.unlink(p)}catch(e){}}let e=String(t instanceof Error?t.message:t||"").toLowerCase();if(e.includes("invalid password")||e.includes("incorrect password")||e.includes("wrong password")||e.includes("password")&&e.includes("invalid"))return this.createErrorOutput(a.GS.PDF_ENCRYPTED,"INVALID_PASSWORD","The password you entered is incorrect. Please check and try again.");return this.createErrorOutput(a.GS.PROCESSING_FAILED,"Failed to decrypt PDF file.",t instanceof Error?t.message:"Unknown error")}}getAcceptedTypes(){return["application/pdf"]}}async function p(e,t,r){return new d().process({files:[e],options:t||{}},r)}},78491:(e,t,r)=>{r.d(t,{LT:()=>i});var a=r(78752),s=r(18365);class n extends s.A{async initWorker(){if(!this.worker)return new Promise((e,t)=>{try{this.worker=new Worker("/workers/excel-to-pdf.worker.js",{type:"module"});let r=r=>{let{type:a,error:s,message:n}=r.data;"init-complete"===a?(this.workerReady=!0,e()):"status"===a?this.updateProgress(0,n):"error"===a&&t(Error(s||"Worker initialization failed"))};this.worker.addEventListener("message",r),this.worker.addEventListener("error",e=>{t(Error("Worker connection failed"))}),this.worker.postMessage({type:"init",id:"init-"+Date.now(),data:{}})}catch(e){t(e)}})}terminateWorker(){this.worker&&(this.worker.terminate(),this.worker=null,this.workerReady=!1)}reset(){super.reset()}async process(e,t){this.reset(),this.onProgress=t;let{files:r}=e;if(1!==r.length)return this.createErrorOutput(a.GS.INVALID_OPTIONS,"Please provide exactly one Excel spreadsheet.","Received ".concat(r.length," file(s)."));let s=r[0];if(!(s.name.toLowerCase().endsWith(".xlsx")||s.name.toLowerCase().endsWith(".xls")||"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"===s.type||"application/vnd.ms-excel"===s.type))return this.createErrorOutput(a.GS.FILE_TYPE_INVALID,"Invalid file type. Please upload an Excel spreadsheet (.xlsx or .xls).","Received: ".concat(s.type||s.name));if(s.name.toLowerCase().endsWith(".xls"))return this.createErrorOutput(a.GS.FILE_TYPE_INVALID,"Legacy .xls format is not supported. Please convert to .xlsx first.","Use Microsoft Excel or LibreOffice to save as .xlsx");try{this.updateProgress(10,"Initializing converter...");try{await this.initWorker()}catch(e){return console.error("Failed to initialize worker:",e),this.createErrorOutput(a.GS.WORKER_FAILED,"Failed to initialize conversion worker.",e instanceof Error?e.message:String(e))}if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");this.updateProgress(30,"Converting Excel to PDF...");let e=await new Promise((e,t)=>{if(!this.worker)return void t(Error("Worker not initialized"));let r="convert-"+Date.now(),a=a=>{let{type:s,id:n,result:o,error:c,message:l}=a.data;if("status"===s)return void this.updateProgress(this.progress,l);n===r&&("convert-complete"===s?(i(),e(o)):"error"===s&&(i(),t(Error(c||"Conversion failed"))))},n=e=>{i(),t(Error("Worker error: "+e.message))},i=()=>{var e,t;null==(e=this.worker)||e.removeEventListener("message",a),null==(t=this.worker)||t.removeEventListener("error",n)};this.worker.addEventListener("message",a),this.worker.addEventListener("error",n),this.worker.postMessage({type:"convert",id:r,data:{file:s}})});if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");this.updateProgress(100,"Conversion complete!");let t=s.name.replace(/\.xlsx?$/i,"");return this.createSuccessOutput(e,"".concat(t,".pdf"),{format:"pdf"})}catch(e){return console.error("Conversion error:",e),this.terminateWorker(),this.createErrorOutput(a.GS.PROCESSING_FAILED,"Failed to convert Excel to PDF.",e instanceof Error?e.message:"Unknown error")}}constructor(...e){super(...e),this.worker=null,this.workerReady=!1}}async function i(e,t,r){return new n().process({files:[e],options:t||{}},r)}},78752:(e,t,r)=>{r.d(t,{GS:()=>s,Q6:()=>i,SM:()=>n,cK:()=>o,h:()=>a});var a=function(e){return e.FILE_ERROR="FILE_ERROR",e.PROCESSING_ERROR="PROCESSING_ERROR",e.VALIDATION_ERROR="VALIDATION_ERROR",e.NETWORK_ERROR="NETWORK_ERROR",e.BROWSER_ERROR="BROWSER_ERROR",e}({}),s=function(e){return e.FILE_TOO_LARGE="FILE_TOO_LARGE",e.FILE_TYPE_INVALID="FILE_TYPE_INVALID",e.FILE_CORRUPTED="FILE_CORRUPTED",e.FILE_EMPTY="FILE_EMPTY",e.FILE_NOT_PDF="FILE_NOT_PDF",e.PDF_ENCRYPTED="PDF_ENCRYPTED",e.PDF_MALFORMED="PDF_MALFORMED",e.PROCESSING_TIMEOUT="PROCESSING_TIMEOUT",e.PROCESSING_CANCELLED="PROCESSING_CANCELLED",e.PROCESSING_FAILED="PROCESSING_FAILED",e.INVALID_PASSWORD="INVALID_PASSWORD",e.MEMORY_EXCEEDED="MEMORY_EXCEEDED",e.WORKER_FAILED="WORKER_FAILED",e.BROWSER_NOT_SUPPORTED="BROWSER_NOT_SUPPORTED",e.INVALID_PAGE_RANGE="INVALID_PAGE_RANGE",e.INVALID_OPTIONS="INVALID_OPTIONS",e.UNKNOWN="UNKNOWN",e}({});let n={FILE_TOO_LARGE:"FILE_ERROR",FILE_TYPE_INVALID:"FILE_ERROR",FILE_CORRUPTED:"FILE_ERROR",FILE_EMPTY:"FILE_ERROR",FILE_NOT_PDF:"FILE_ERROR",PDF_ENCRYPTED:"PROCESSING_ERROR",PDF_MALFORMED:"PROCESSING_ERROR",PROCESSING_TIMEOUT:"PROCESSING_ERROR",PROCESSING_CANCELLED:"PROCESSING_ERROR",PROCESSING_FAILED:"PROCESSING_ERROR",INVALID_PASSWORD:"VALIDATION_ERROR",MEMORY_EXCEEDED:"BROWSER_ERROR",WORKER_FAILED:"BROWSER_ERROR",BROWSER_NOT_SUPPORTED:"BROWSER_ERROR",INVALID_PAGE_RANGE:"VALIDATION_ERROR",INVALID_OPTIONS:"VALIDATION_ERROR",UNKNOWN:"PROCESSING_ERROR"},i={DEFAULT_MAX_SIZE:1/0,LARGE_FILE_THRESHOLD:0x3200000,SMALL_FILE_THRESHOLD:5242880},o={PDF:["application/pdf"],IMAGES:["image/jpeg","image/png","image/webp","image/bmp","image/tiff","image/svg+xml"],TEXT:["text/plain"],JSON:["application/json"]};new Uint8Array([37,80,68,70])},79624:(e,t,r)=>{r.d(t,{sM:()=>l,tn:()=>i});var a=r(78752),s=r(18365),n=r(32096);let i={a3:{width:841.89,height:1190.55,label:"A3 (297 \xd7 420 mm)"},a4:{width:595.28,height:841.89,label:"A4 (210 \xd7 297 mm)"},a5:{width:419.53,height:595.28,label:"A5 (148 \xd7 210 mm)"},letter:{width:612,height:792,label:"Letter (8.5 \xd7 11 in)"},legal:{width:612,height:1008,label:"Legal (8.5 \xd7 14 in)"},tabloid:{width:792,height:1224,label:"Tabloid (11 \xd7 17 in)"},executive:{width:522,height:756,label:"Executive (7.25 \xd7 10.5 in)"},custom:{width:0,height:0,label:"Custom"}},o={sizePreset:"a4",scaleMode:"fit",maintainAspectRatio:!0,orientation:"auto"};class c extends s.A{async process(e,t){this.reset(),this.onProgress=t;let{files:r,options:s}=e,i={...o,...s};if(1!==r.length)return this.createErrorOutput(a.GS.INVALID_OPTIONS,"Please provide exactly one PDF file.","Received ".concat(r.length," file(s)."));let c=r[0];try{this.updateProgress(5,"Loading PDF library...");let e=await (0,n.Ck)();if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");this.updateProgress(10,"Reading PDF file...");let t=await c.arrayBuffer();this.updateProgress(20,"Loading PDF document...");let r=await e.PDFDocument.load(t,{ignoreEncryption:!0}),s=r.getPageCount();if(0===s)return this.createErrorOutput(a.GS.PDF_MALFORMED,"The PDF file contains no pages.","Please provide a valid PDF with at least one page.");this.updateProgress(30,"Creating new document...");let o=await e.PDFDocument.create(),l=this.getTargetDimensions(i);this.updateProgress(40,"Processing pages...");for(let e=0;e<s;e++){if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");let t=40+Math.floor(e/s*50);this.updateProgress(t,"Processing page ".concat(e+1," of ").concat(s,"..."));let[n]=await o.embedPages([r.getPage(e)]),c=n.width,u=n.height,d=l.width,p=l.height;if("auto"===i.orientation){let e=c>u,t=d>p;e!==t&&([d,p]=[p,d])}else"landscape"===i.orientation?d<p&&([d,p]=[p,d]):"portrait"===i.orientation&&d>p&&([d,p]=[p,d]);let h=o.addPage([d,p]),{scale:g,x:f,y:P}=this.calculateTransform(c,u,d,p,i.scaleMode,i.maintainAspectRatio);h.drawPage(n,{x:f,y:P,xScale:g.x,yScale:g.y})}this.updateProgress(90,"Saving PDF...");let u=await o.save({useObjectStreams:!0}),d=new Blob([u],{type:"application/pdf"});this.updateProgress(100,"Complete!");let p=function(e){let t=e.lastIndexOf("."),r=-1===t?e:e.slice(0,t);return"".concat(r,"_fixed.pdf")}(c.name);return this.createSuccessOutput(d,p,{pageCount:s,targetWidth:l.width,targetHeight:l.height,sizePreset:i.sizePreset})}catch(e){return this.createErrorOutput(a.GS.PROCESSING_FAILED,"Failed to fix page sizes.",e instanceof Error?e.message:"Unknown error")}}getTargetDimensions(e){if("custom"===e.sizePreset)return{width:e.customWidth||595.28,height:e.customHeight||841.89};let t=i[e.sizePreset];return{width:t.width,height:t.height}}calculateTransform(e,t,r,a,s,n){let i=r/e,o=a/t,c=0,l=0;switch(s){case"fit":if(n){let e=Math.min(i,o);i=e,o=e}c=(r-e*i)/2,l=(a-t*o)/2;break;case"fill":if(n){let e=Math.max(i,o);i=e,o=e}c=(r-e*i)/2,l=(a-t*o)/2;break;case"stretch":c=0,l=0;break;case"center":i=1,o=1,c=(r-e)/2,l=(a-t)/2}return{scale:{x:i,y:o},x:c,y:l}}getAcceptedTypes(){return["application/pdf"]}}async function l(e,t,r){return new c().process({files:[e],options:t||{}},r)}},80571:(e,t,r)=>{r.d(t,{dM:()=>o});var a=r(78752),s=r(18365);let n={quality:"medium",removeMetadata:!1,optimizeImages:!0,removeUnusedObjects:!0};class i extends s.A{async process(e,t){this.reset(),this.onProgress=t;let{files:r,options:s}=e,i={...n,...s};if(1!==r.length)return this.createErrorOutput(a.GS.INVALID_OPTIONS,"Please provide exactly one PDF file to compress.","Received ".concat(r.length," file(s)."));let o=r[0];try{this.updateProgress(5,"Loading PDF file...");let e=await o.arrayBuffer(),t=e.byteLength;if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");this.updateProgress(10,"Starting compression...");let r=await this.compressWithWorker(e,i);if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");let s=r.compressedSize,n=((t-s)/t*100).toFixed(1),c=new Blob([r.pdfBytes],{type:"application/pdf"});this.updateProgress(100,"Complete!");let l=function(e){let t=e.lastIndexOf("."),r=-1===t?e:e.slice(0,t);return"".concat(r,"_compressed.pdf")}(o.name);return this.createSuccessOutput(c,l,{originalSize:t,compressedSize:s,compressionRatio:"".concat(n,"%"),quality:i.quality})}catch(e){if(this.terminateWorker(),e instanceof Error&&e.message.includes("encrypt"))return this.createErrorOutput(a.GS.PDF_ENCRYPTED,"The PDF file is encrypted.","Please decrypt the file before compressing.");return this.createErrorOutput(a.GS.PROCESSING_FAILED,"Failed to compress PDF file.",e instanceof Error?e.message:"Unknown error")}}compressWithWorker(e,t){return new Promise((r,a)=>{try{this.worker=new Worker("/workers/compress.worker.js"),this.worker.onmessage=e=>{let t=e.data;if("progress"===t.status){let e=10+t.progress/100*85;this.updateProgress(e,"Compressing PDF...")}else"success"===t.status?(this.terminateWorker(),r({pdfBytes:t.pdfBytes,compressedSize:t.compressedSize})):"error"===t.status&&(this.terminateWorker(),a(Error(t.message)))},this.worker.onerror=e=>{this.terminateWorker(),a(Error("Worker error: ".concat(e.message)))},this.worker.postMessage({command:"compress",pdfData:e,options:{quality:t.quality,removeMetadata:t.removeMetadata}},[e])}catch(e){this.terminateWorker(),a(e)}})}terminateWorker(){this.worker&&(this.worker.terminate(),this.worker=null)}cancel(){super.cancel(),this.terminateWorker()}getAcceptedTypes(){return["application/pdf"]}constructor(...e){super(...e),this.worker=null}}async function o(e,t,r){return new i().process({files:[e],options:t||{}},r)}},81554:(e,t,r)=>{r.d(t,{Fk:()=>i});var a=r(78752),s=r(18365);class n extends s.A{async process(e,t){this.reset(),this.onProgress=t;let{files:r,options:s}=e;if(1!==r.length)return this.createErrorOutput(a.GS.INVALID_OPTIONS,"Exactly 1 PDF file is required.");try{var n,i;let e;this.updateProgress(10,"Loading PDF...");let t=r[0],o=await t.arrayBuffer();this.updateProgress(30,"Generating table of contents...");let c=await this.generateTOCWithWorker(o,s.title||"Table of Contents",s.fontSize||12,null!=(n=s.fontFamily)?n:"helv",null==(i=s.addBookmark)||i);if("error"===c.status)return this.createErrorOutput(a.GS.PROCESSING_FAILED,c.message||"Failed to generate table of contents.");let l=c.pdfBlob,u=c.pdfBytes;if(l instanceof Blob)e=l;else{if(!u||!(u.byteLength>0))return console.error("[TOC Processor] Critical: Received empty data from worker"),this.createErrorOutput(a.GS.PROCESSING_FAILED,"Internal Error: Generated PDF data was empty.");e=new Blob([new Uint8Array(u)],{type:"application/pdf"})}return this.updateProgress(90,"Saving PDF..."),this.updateProgress(100,"Complete!"),this.createSuccessOutput(e,t.name.replace(".pdf","_with_toc.pdf"),{})}catch(e){return this.createErrorOutput(a.GS.PROCESSING_FAILED,"Failed to generate table of contents.",e instanceof Error?e.message:"Unknown error")}finally{this.terminateWorker()}}generateTOCWithWorker(e,t,r,a,s){return new Promise(n=>{this.worker=new Worker("/workers/table-of-contents-v2.worker.js",{type:"module"}),this.worker.onmessage=e=>{let t=e.data;("success"===t.status||"error"===t.status)&&n(t)},this.worker.onerror=e=>{n({status:"error",message:e.message||"Worker error occurred"})},this.worker.postMessage({command:"generate-toc",pdfData:e,title:t,fontSize:r,fontFamily:a,addBookmark:s},[e])})}terminateWorker(){this.worker&&(this.worker.terminate(),this.worker=null)}getAcceptedTypes(){return["application/pdf"]}constructor(...e){super(...e),this.worker=null}}async function i(e,t,r){return new n().process({files:[e],options:t},r)}},83820:(e,t,r)=>{r.d(t,{qR:()=>i});var a=r(78752),s=r(18365);class n extends s.A{async initWorker(){if(!this.worker)return new Promise((e,t)=>{try{this.worker=new Worker("/workers/pptx-to-pdf.worker.js",{type:"module"});let r=r=>{let{type:a,error:s,message:n}=r.data;"init-complete"===a?(this.workerReady=!0,e()):"status"===a?this.updateProgress(0,n):"error"===a&&t(Error(s||"Worker initialization failed"))};this.worker.addEventListener("message",r),this.worker.addEventListener("error",()=>{t(Error("Worker connection failed"))}),this.worker.postMessage({type:"init",id:"init-"+Date.now(),data:{}})}catch(e){t(e)}})}terminateWorker(){this.worker&&(this.worker.terminate(),this.worker=null,this.workerReady=!1)}reset(){super.reset()}async process(e,t){this.reset(),this.onProgress=t;let{files:r}=e;if(1!==r.length)return this.createErrorOutput(a.GS.INVALID_OPTIONS,"Please provide exactly one PowerPoint presentation.","Received ".concat(r.length," file(s)."));let s=r[0];if(!(s.name.toLowerCase().endsWith(".pptx")||s.name.toLowerCase().endsWith(".ppt")||"application/vnd.openxmlformats-officedocument.presentationml.presentation"===s.type||"application/vnd.ms-powerpoint"===s.type))return this.createErrorOutput(a.GS.FILE_TYPE_INVALID,"Invalid file type. Please upload a PowerPoint presentation (.pptx or .ppt).","Received: ".concat(s.type||s.name));if(s.name.toLowerCase().endsWith(".ppt"))return this.createErrorOutput(a.GS.FILE_TYPE_INVALID,"Legacy .ppt format is not supported. Please convert to .pptx first.","Use Microsoft PowerPoint or LibreOffice to save as .pptx");try{this.updateProgress(10,"Initializing converter...");try{await this.initWorker()}catch(e){return console.error("Failed to initialize worker:",e),this.createErrorOutput(a.GS.WORKER_FAILED,"Failed to initialize conversion worker.",e instanceof Error?e.message:String(e))}if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");this.updateProgress(30,"Converting PowerPoint to PDF...");let e=await new Promise((e,t)=>{if(!this.worker)return void t(Error("Worker not initialized"));let r="convert-"+Date.now(),a=a=>{let{type:s,id:n,result:o,error:c,message:l}=a.data;if("status"===s)return void this.updateProgress(this.progress,l);n===r&&("convert-complete"===s?(i(),e(o)):"error"===s&&(i(),t(Error(c||"Conversion failed"))))},n=e=>{i(),t(Error("Worker error: "+e.message))},i=()=>{var e,t;null==(e=this.worker)||e.removeEventListener("message",a),null==(t=this.worker)||t.removeEventListener("error",n)};this.worker.addEventListener("message",a),this.worker.addEventListener("error",n),this.worker.postMessage({type:"convert",id:r,data:{file:s}})});if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");this.updateProgress(100,"Conversion complete!");let t=s.name.replace(/\.pptx?$/i,"");return this.createSuccessOutput(e,"".concat(t,".pdf"),{format:"pdf"})}catch(e){return console.error("Conversion error:",e),this.terminateWorker(),this.createErrorOutput(a.GS.PROCESSING_FAILED,"Failed to convert PowerPoint to PDF.",e instanceof Error?e.message:"Unknown error")}}constructor(...e){super(...e),this.worker=null,this.workerReady=!1}}async function i(e,t,r){return new n().process({files:[e],options:t||{}},r)}},85311:(e,t,r)=>{r.d(t,{Qm:()=>o});var a=r(78752),s=r(18365),n=r(32096);class i extends s.A{async process(e,t){var r,s,i,o,c,l,u,d,p,h;this.reset(),this.onProgress=t;let{files:g,options:f}=e,P={type:null!=(r=f.type)?r:"text",text:f.text,imageData:f.imageData,position:null!=(s=f.position)?s:"center",opacity:null!=(i=f.opacity)?i:.3,rotation:null!=(o=f.rotation)?o:-45,fontSize:null!=(c=f.fontSize)?c:48,color:null!=(l=f.color)?l:{r:.5,g:.5,b:.5},pages:null!=(u=f.pages)?u:"all"};if(1!==g.length)return this.createErrorOutput(a.GS.INVALID_OPTIONS,"Exactly 1 PDF file is required.");try{this.updateProgress(10,"Loading PDF library...");let e=await (0,n.Ck)();this.updateProgress(20,"Loading PDF...");let t=g[0],r=await t.arrayBuffer(),s=await e.PDFDocument.load(r,{ignoreEncryption:!0}),i=await s.embedFont(e.StandardFonts.HelveticaBold),o=s.getPageCount();this.updateProgress(30,"Adding watermark...");let c=function(e,t){if(Array.isArray(e))return e.map(e=>e-1).filter(e=>e>=0&&e<t);switch(e){case"odd":return Array.from({length:t},(e,t)=>t).filter(e=>e%2==0);case"even":return Array.from({length:t},(e,t)=>t).filter(e=>e%2==1);default:return Array.from({length:t},(e,t)=>t)}}(P.pages,o);for(let t=0;t<c.length;t++){if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");let r=c[t],n=s.getPage(r),{width:o,height:l}=n.getSize();if("text"===P.type&&P.text){let t=P.text,r=P.fontSize||48,a=i.widthOfTextAtSize(t,r),s=0,c=0,u="diagonal"===P.position?-45:P.rotation||0;switch(P.position){case"top-left":s=50,c=l-50;break;case"top-right":s=o-a-50,c=l-50;break;case"bottom-left":s=50,c=50;break;case"bottom-right":s=o-a-50,c=50;break;default:s=o/2,c=l/2}n.drawText(t,{x:s,y:c,size:r,font:i,color:e.rgb((null==(d=P.color)?void 0:d.r)||.5,(null==(p=P.color)?void 0:p.g)||.5,(null==(h=P.color)?void 0:h.b)||.5),opacity:P.opacity||.3,rotate:e.degrees(u)})}else if("image"===P.type&&P.imageData){let t;t="jpg"===P.imageType?await s.embedJpg(P.imageData):await s.embedPng(P.imageData);let r=.5*t.width,a=.5*t.height,i=(o-r)/2,c=(l-a)/2;n.drawImage(t,{x:i,y:c,width:r,height:a,opacity:P.opacity||.3,rotate:e.degrees(P.rotation||0)})}this.updateProgress(30+60*(t+1)/c.length,"Processing page ".concat(r+1,"..."))}this.updateProgress(95,"Saving PDF...");let l=await s.save({useObjectStreams:!0}),u=new Blob([new Uint8Array(l)],{type:"application/pdf"});return this.updateProgress(100,"Complete!"),this.createSuccessOutput(u,t.name.replace(".pdf","_watermarked.pdf"),{pageCount:o})}catch(e){return this.createErrorOutput(a.GS.PROCESSING_FAILED,"Failed to add watermark.",e instanceof Error?e.message:"Unknown error")}}getAcceptedTypes(){return["application/pdf"]}}async function o(e,t,r){return new i().process({files:[e],options:t},r)}},87888:(e,t,r)=>{r.d(t,{OS:()=>c});var a=r(78752),s=r(18365),n=r(32096);let i={removeJavaScript:!0,removeAttachments:!0,removeLinks:!0,flattenForms:!0,removeMetadata:!0,removeAnnotations:!1};class o extends s.A{async process(e,t){this.reset(),this.onProgress=t;let{files:r,options:s}=e,o={...i,...s};if(1!==r.length)return this.createErrorOutput(a.GS.INVALID_OPTIONS,"Please provide exactly one PDF file to sanitize.","Received ".concat(r.length," file(s)."));let c=r[0];try{let e;this.updateProgress(5,"Loading PDF library...");let t=await (0,n.Ck)(),{PDFName:r}=t;if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");this.updateProgress(10,"Reading PDF file...");let s=await c.arrayBuffer(),i=s.byteLength;this.updateProgress(20,"Loading PDF document...");try{e=await t.PDFDocument.load(s,{ignoreEncryption:!0})}catch(e){if(e instanceof Error&&e.message.includes("encrypt"))return this.createErrorOutput(a.GS.PDF_ENCRYPTED,"The PDF file is encrypted.","Please decrypt the file before sanitizing.");throw e}if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");this.updateProgress(30,"Analyzing PDF content...");let u=e.getPageCount();if(0===u)return this.createErrorOutput(a.GS.PDF_MALFORMED,"The PDF file contains no pages.","Cannot sanitize an empty PDF.");let d=[];if(this.updateProgress(40,"Sanitizing PDF content..."),o.flattenForms)try{let t=e.getForm();t.getFields().length>0&&(t.flatten(),d.push("form fields (flattened)"))}catch(t){try{let t=e.catalog.dict;t.has(r.of("AcroForm"))&&(t.delete(r.of("AcroForm")),d.push("form fields"))}catch(e){console.warn("Could not remove AcroForm:")}}if(this.updateProgress(50,"Removing metadata..."),o.removeMetadata)try{let t=e.getInfoDict();t.keys().forEach(e=>{t.delete(e)}),e.setTitle(""),e.setAuthor(""),e.setSubject(""),e.setKeywords([]),e.setCreator(""),e.setProducer("PDFCraft");try{let t=e.catalog.dict;t.has(r.of("Metadata"))&&t.delete(r.of("Metadata"))}catch(e){console.warn("Could not remove XMP metadata")}d.push("metadata")}catch(e){console.warn("Could not remove metadata:",e)}if(this.updateProgress(60,"Removing annotations..."),o.removeAnnotations){for(let t of e.getPages())try{t.node.delete(r.of("Annots"))}catch(e){}d.push("annotations")}if(this.updateProgress(70,"Removing JavaScript..."),o.removeJavaScript)try{let t=e.catalog.dict,a=t.get(r.of("Names"));if(a)try{let t=e.context.lookup(a);t.has(r.of("JavaScript"))&&t.delete(r.of("JavaScript"))}catch(e){}for(let a of(t.has(r.of("OpenAction"))&&t.delete(r.of("OpenAction")),t.has(r.of("AA"))&&t.delete(r.of("AA")),e.getPages()))try{let e=a.node;e.has(r.of("AA"))&&e.delete(r.of("AA"))}catch(e){}d.push("JavaScript")}catch(e){console.warn("Could not remove JavaScript:",e)}if(this.updateProgress(80,"Removing embedded files..."),o.removeAttachments)try{let t=e.catalog.dict,a=t.get(r.of("Names"));if(a)try{let t=e.context.lookup(a);t.has(r.of("EmbeddedFiles"))&&t.delete(r.of("EmbeddedFiles"))}catch(e){}t.has(r.of("Collection"))&&t.delete(r.of("Collection")),d.push("embedded files")}catch(e){console.warn("Could not remove embedded files:",e)}if(o.removeLinks)try{for(let t of e.getPages())try{let a=t.node,s=a.get(r.of("Annots"));if(!s)continue;let n=e.context.lookup(s).asArray(),i=[];for(let t of n)try{var l;let a=null==(l=e.context.lookup(t).get(r.of("Subtype")))?void 0:l.toString().substring(1);"Link"!==a&&i.push(t)}catch(e){i.push(t)}if(i.length!==n.length)if(i.length>0){let t=e.context.obj(i);a.set(r.of("Annots"),t)}else a.delete(r.of("Annots"))}catch(e){}d.push("links")}catch(e){console.warn("Could not remove links:",e)}if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");this.updateProgress(90,"Saving sanitized PDF...");let p=await e.save({useObjectStreams:!0}),h=new Blob([new Uint8Array(p)],{type:"application/pdf"}),g=p.length;this.updateProgress(100,"Complete!");let f=function(e){let t=e.lastIndexOf("."),r=-1===t?e:e.slice(0,t);return"".concat(r,"_sanitized.pdf")}(c.name);return this.createSuccessOutput(h,f,{pageCount:u,originalSize:i,newSize:g,removedItems:d,sanitized:!0})}catch(e){return this.createErrorOutput(a.GS.PROCESSING_FAILED,"Failed to sanitize PDF file.",e instanceof Error?e.message:"Unknown error")}}getAcceptedTypes(){return["application/pdf"]}}async function c(e,t,r){return new o().process({files:[e],options:t||{}},r)}},90208:(e,t,r)=>{r.d(t,{Sd:()=>c});var a=r(78752),s=r(18365),n=r(32096);let i={scale:2,pages:[],backgroundColor:"#ffffff",embedFonts:!0};class o extends s.A{async process(e,t){this.reset(),this.onProgress=t;let{files:r,options:s}=e,o={...i,...s};if(1!==r.length)return this.createErrorOutput(a.GS.INVALID_OPTIONS,"Please provide exactly one PDF file.","Received ".concat(r.length," file(s)."));let c=r[0];if(!c.type.includes("pdf")&&!c.name.toLowerCase().endsWith(".pdf"))return this.createErrorOutput(a.GS.FILE_TYPE_INVALID,"Invalid file type. Please upload a PDF file.","Received: ".concat(c.type||"unknown"));try{this.updateProgress(5,"Loading PDF library...");let e=await (0,n.Iy)();if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");this.updateProgress(10,"Loading PDF document...");let t=await c.arrayBuffer(),r=await e.getDocument({data:t}).promise,s=r.numPages,i=o.pages.length>0?o.pages.filter(e=>e>=1&&e<=s):Array.from({length:s},(e,t)=>t+1);if(0===i.length)return this.createErrorOutput(a.GS.INVALID_PAGE_RANGE,"No valid pages to convert.","PDF has ".concat(s," pages."));this.updateProgress(15,"Converting ".concat(i.length," page(s) to SVG..."));let l=[],u=80/i.length;for(let e=0;e<i.length;e++){if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");let t=i[e],n=15+e*u;this.updateProgress(n,"Converting page ".concat(t," of ").concat(s,"..."));try{let e=await this.renderPageToSVG(r,t,o);l.push(e)}catch(e){return this.createErrorOutput(a.GS.PROCESSING_FAILED,"Failed to convert page ".concat(t,"."),e instanceof Error?e.message:"Unknown error")}}this.updateProgress(95,"Finalizing...");let d=c.name.replace(/\.pdf$/i,""),p=l.map(e=>e.blob);if(1===p.length)return this.updateProgress(100,"Complete!"),this.createSuccessOutput(p[0],"".concat(d,".svg"),{pageCount:1,format:"svg",svgResults:l});return this.updateProgress(100,"Complete!"),this.createSuccessOutput(p,"".concat(d,"_pages.svg"),{pageCount:p.length,format:"svg",svgResults:l})}catch(e){return this.createErrorOutput(a.GS.PROCESSING_FAILED,"Failed to convert PDF to SVG.",e instanceof Error?e.message:"Unknown error")}}async renderPageToSVG(e,t,r){let a=await e.getPage(t),s=a.getViewport({scale:r.scale}),n=document.createElement("canvas");n.width=s.width,n.height=s.height;let i=n.getContext("2d");if(!i)throw Error("Failed to get canvas context");i.fillStyle=r.backgroundColor,i.fillRect(0,0,n.width,n.height),await a.render({canvasContext:i,viewport:s}).promise;let o=this.canvasToSVG(n,s.width,s.height),c=new Blob([o],{type:"image/svg+xml"});return{svg:o,blob:c,pageNumber:t,width:s.width,height:s.height}}canvasToSVG(e,t,r){let a=e.toDataURL("image/png");return'<?xml version="1.0" encoding="UTF-8"?>\n<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" \n     width="'.concat(t,'" height="').concat(r,'" viewBox="0 0 ').concat(t," ").concat(r,'">\n  <title>PDF Page</title>\n  <image width="').concat(t,'" height="').concat(r,'" xlink:href="').concat(a,'" />\n</svg>')}}async function c(e,t,r){return new o().process({files:[e],options:t||{}},r)}},90636:(e,t,r)=>{r.d(t,{Ch:()=>i});var a=r(78752),s=r(18365);class n extends s.A{async initWorker(){if(!this.worker)return new Promise((e,t)=>{try{this.worker=new Worker("/workers/word-to-pdf.worker.js",{type:"module"});let r=r=>{let{type:a,error:s,message:n}=r.data;"init-complete"===a?(this.workerReady=!0,e()):"status"===a?this.updateProgress(0,n):"error"===a&&t(Error(s||"Worker initialization failed"))};this.worker.addEventListener("message",r),this.worker.addEventListener("error",()=>{t(Error("Worker connection failed"))}),this.worker.postMessage({type:"init",id:"init-"+Date.now(),data:{}})}catch(e){t(e)}})}terminateWorker(){this.worker&&(this.worker.terminate(),this.worker=null,this.workerReady=!1)}reset(){super.reset()}async process(e,t){this.reset(),this.onProgress=t;let{files:r}=e;if(1!==r.length)return this.createErrorOutput(a.GS.INVALID_OPTIONS,"Please provide exactly one Word document.","Received ".concat(r.length," file(s)."));let s=r[0];if(!(s.name.toLowerCase().endsWith(".docx")||s.name.toLowerCase().endsWith(".doc")||"application/vnd.openxmlformats-officedocument.wordprocessingml.document"===s.type||"application/msword"===s.type))return this.createErrorOutput(a.GS.FILE_TYPE_INVALID,"Invalid file type. Please upload a Word document (.docx or .doc).","Received: ".concat(s.type||s.name));if(s.name.toLowerCase().endsWith(".doc"))return this.createErrorOutput(a.GS.FILE_TYPE_INVALID,"Legacy .doc format is not supported. Please convert to .docx first.","Use Microsoft Word or LibreOffice to save as .docx");try{this.updateProgress(10,"Initializing converter...");try{await this.initWorker()}catch(e){return console.error("Failed to initialize worker:",e),this.createErrorOutput(a.GS.WORKER_FAILED,"Failed to initialize conversion worker.",e instanceof Error?e.message:String(e))}if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");this.updateProgress(30,"Converting Word document to PDF...");let e=await new Promise((e,t)=>{if(!this.worker)return void t(Error("Worker not initialized"));let r="convert-"+Date.now(),a=a=>{let{type:s,id:n,result:o,error:c,message:l}=a.data;if("status"===s)return void this.updateProgress(this.progress,l);n===r&&("convert-complete"===s?(i(),e(o)):"error"===s&&(i(),t(Error(c||"Conversion failed"))))},n=e=>{i(),t(Error("Worker error: "+e.message))},i=()=>{var e,t;null==(e=this.worker)||e.removeEventListener("message",a),null==(t=this.worker)||t.removeEventListener("error",n)};this.worker.addEventListener("message",a),this.worker.addEventListener("error",n),this.worker.postMessage({type:"convert",id:r,data:{file:s}})});if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");this.updateProgress(100,"Conversion complete!");let t=s.name.replace(/\.docx?$/i,"");return this.createSuccessOutput(e,"".concat(t,".pdf"),{format:"pdf"})}catch(e){return console.error("Conversion error:",e),this.terminateWorker(),this.createErrorOutput(a.GS.PROCESSING_FAILED,"Failed to convert Word document to PDF.",e instanceof Error?e.message:"Unknown error")}}constructor(...e){super(...e),this.worker=null,this.workerReady=!1}}async function i(e,t,r){return new n().process({files:[e],options:t||{}},r)}},91257:(e,t,r)=>{r.d(t,{IJ:()=>d,iU:()=>p});var a=r(78752),s=r(18365),n=r(32096);let i={A4:{width:595.28,height:841.89},LETTER:{width:612,height:792},LEGAL:{width:612,height:1008},A3:{width:841.89,height:1190.55},A5:{width:419.53,height:595.28},FIT:{width:0,height:0}},o={pageSize:"A4",orientation:"auto",margin:36,quality:.92,centerImage:!0,scaleToFit:!0,svgScale:2,batchMode:!1,imagesPerPdf:10},c=["image/jpeg","image/png","image/webp","image/bmp","image/tiff","image/svg+xml","image/heic","image/heif"],l=[".jpg",".jpeg",".png",".webp",".bmp",".tiff",".tif",".svg",".heic",".heif"];class u extends s.A{async process(e,t){this.reset(),this.onProgress=t;let{files:r,options:s}=e,i={...o,...s};if(r.length<1)return this.createErrorOutput(a.GS.INVALID_OPTIONS,"At least 1 image file is required.","Received ".concat(r.length," file(s)."));for(let e of r)if(!this.isValidImageFile(e))return this.createErrorOutput(a.GS.FILE_TYPE_INVALID,"Invalid file type: ".concat(e.name),"Supported formats: JPG, PNG, WebP, BMP, TIFF, SVG, HEIC");try{this.updateProgress(5,"Loading PDF library...");let e=await (0,n.Ck)();if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");this.updateProgress(10,"Creating PDF document...");let t=await e.PDFDocument.create(),s=80/r.length;for(let n=0;n<r.length;n++){if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");let o=r[n],c=10+n*s;this.updateProgress(c,"Processing image ".concat(n+1," of ").concat(r.length,": ").concat(o.name));try{await this.addImageToDocument(t,o,i,e)}catch(e){return this.createErrorOutput(a.GS.PROCESSING_FAILED,'Failed to process image "'.concat(o.name,'".'),e instanceof Error?e.message:"Unknown error")}}this.updateProgress(95,"Saving PDF...");let o=await t.save({useObjectStreams:!0}),c=new Blob([new Uint8Array(o)],{type:"application/pdf"});this.updateProgress(100,"Complete!");let l=this.generateOutputFilename(r);return this.createSuccessOutput(c,l,{pageCount:r.length,imageCount:r.length})}catch(e){return this.createErrorOutput(a.GS.PROCESSING_FAILED,"Failed to convert images to PDF.",e instanceof Error?e.message:"Unknown error")}}isValidImageFile(e){var t;if(c.includes(e.type))return!0;let r="."+(null==(t=e.name.split(".").pop())?void 0:t.toLowerCase());return l.includes(r)}async addImageToDocument(e,t,r,a){var s;let n,i=new Uint8Array(await t.arrayBuffer()),o=t.type.toLowerCase(),c=(null==(s=t.name.split(".").pop())?void 0:s.toLowerCase())||"";n="image/jpeg"===o||"jpg"===c||"jpeg"===c?await e.embedJpg(i):"image/png"===o||"png"===c?await e.embedPng(i):await this.convertAndEmbedImage(e,t,a,"image/svg+xml"===o||"svg"===c?r.svgScale:1);let{pageWidth:l,pageHeight:u}=this.calculatePageDimensions(n.width,n.height,r),d=e.addPage([l,u]),{x:p,y:h,width:g,height:f}=this.calculateImagePlacement(n.width,n.height,l,u,r);d.drawImage(n,{x:p,y:h,width:g,height:f})}async convertAndEmbedImage(e,t,r){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return new Promise((r,s)=>{let n=new Image,i=URL.createObjectURL(t);n.onload=async()=>{try{let t=document.createElement("canvas");t.width=n.width*a,t.height=n.height*a;let s=t.getContext("2d");if(!s)throw Error("Failed to get canvas context");s.scale(a,a),s.drawImage(n,0,0);let o=await new Promise((e,r)=>{t.toBlob(t=>t?e(t):r(Error("Failed to convert to PNG")),"image/png")}),c=await o.arrayBuffer(),l=await e.embedPng(new Uint8Array(c));URL.revokeObjectURL(i),r(l)}catch(e){URL.revokeObjectURL(i),s(e)}},n.onerror=()=>{URL.revokeObjectURL(i),s(Error("Failed to load image: ".concat(t.name)))},n.src=i})}calculatePageDimensions(e,t,r){let a,s;if("string"==typeof r.pageSize){let n=i[r.pageSize];"FIT"===r.pageSize?(a=e+2*r.margin,s=t+2*r.margin):(a=n.width,s=n.height)}else a=r.pageSize.width,s=r.pageSize.height;return"landscape"===r.orientation?a<s&&([a,s]=[s,a]):"portrait"===r.orientation?a>s&&([a,s]=[s,a]):"auto"===r.orientation&&e>t!=a>s&&"string"==typeof r.pageSize&&"FIT"!==r.pageSize&&([a,s]=[s,a]),{pageWidth:a,pageHeight:s}}calculateImagePlacement(e,t,r,a,s){let n=r-2*s.margin,i=a-2*s.margin,o=e,c=t;if(s.scaleToFit){let r=Math.min(n/e,i/t,1);o=e*r,c=t*r}let l=s.margin,u=s.margin;return s.centerImage&&(l=(r-o)/2,u=(a-c)/2),{x:l,y:u,width:o,height:c}}generateOutputFilename(e){if(1===e.length){let t=e[0].name.replace(/\.[^/.]+$/,"");return"".concat(t,".pdf")}return"images_".concat(e.length,"_pages.pdf")}getAcceptedTypes(){return c}}async function d(e,t,r){return new u().process({files:e,options:t||{}},r)}async function p(e,t,a,s){try{let i=(await Promise.all([r.e(29),r.e(496)]).then(r.t.bind(r,7496,23))).default,o=e.length,c=Math.ceil(o/t),l=new i;null==s||s(5,"Creating batch PDFs...");let d=new u;for(let r=0;r<c;r++){let i=r*t,u=Math.min(i+t,o),p=e.slice(i,u),h=5+r/c*85,g=5+(r+1)/c*85;null==s||s(h,"Processing batch ".concat(r+1," of ").concat(c," (images ").concat(i+1,"-").concat(u,")..."));let f=await d.process({files:p,options:a||{}},(e,t)=>{let r=h+e/100*(g-h);null==s||s(r,t)});if(!f.success||!f.result){var n;return{success:!1,error:{message:(null==(n=f.error)?void 0:n.message)||"Failed to create PDF for batch ".concat(r+1)}}}let P=f.result,E=await P.arrayBuffer(),w=String(r+1).padStart(String(c).length,"0");l.file("images_part_".concat(w,".pdf"),E)}null==s||s(92,"Creating ZIP archive...");let p=await l.generateAsync({type:"blob",compression:"DEFLATE",compressionOptions:{level:6}},e=>{let t=92+e.percent/100*8;null==s||s(t,"Compressing: ".concat(Math.round(e.percent),"%"))});return null==s||s(100,"Complete!"),{success:!0,result:{zipBlob:p,pdfCount:c,imageCount:o}}}catch(e){return{success:!1,error:{message:e instanceof Error?e.message:"Failed to create batch PDFs"}}}}},94188:(e,t,r)=>{r.d(t,{io:()=>l});var a=r(78752),s=r(18365),n=r(32096);let i={rows:2,cols:2,pageSize:"A4",orientation:"auto",overlap:0,scalingMode:"fit",pageRange:""},o={A4:[595.28,841.89],Letter:[612,792],Legal:[612,1008],A3:[841.89,1190.55]};class c extends s.A{async process(e,t){this.reset(),this.onProgress=t;let{files:r,options:s}=e,c={...i,...s};if(1!==r.length)return this.createErrorOutput(a.GS.INVALID_OPTIONS,"Exactly 1 PDF file is required.","Received ".concat(r.length," file(s)."));if(c.rows<1||c.cols<1)return this.createErrorOutput(a.GS.INVALID_OPTIONS,"Invalid grid dimensions.","Rows and columns must be at least 1.");try{let e;this.updateProgress(5,"Loading PDF library...");let t=await (0,n.Ck)();if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");this.updateProgress(10,"Loading source PDF...");let s=r[0],i=await s.arrayBuffer();try{e=await t.PDFDocument.load(i,{ignoreEncryption:!0})}catch(e){if(e instanceof Error&&e.message.includes("encrypt"))return this.createErrorOutput(a.GS.PDF_ENCRYPTED,"The PDF file is encrypted.","Please decrypt the file first.");throw e}let l=e.getPages(),u=l.length;if(this.updateProgress(15,"Source PDF has ".concat(u," pages.")),this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");let d=function(e,t){if(!e||""===e.trim())return Array.from({length:t},(e,t)=>t);let r=new Set;for(let a of e.split(",")){let e=a.trim();if(e)if(e.includes("-")){let[a,s]=e.split("-"),n=parseInt(a.trim(),10),i=parseInt(s.trim(),10);if(!isNaN(n)&&!isNaN(i))for(let e=Math.max(1,n);e<=Math.min(t,i);e++)r.add(e-1)}else{let a=parseInt(e,10);!isNaN(a)&&a>=1&&a<=t&&r.add(a-1)}}return Array.from(r).sort((e,t)=>e-t)}(c.pageRange,u);if(0===d.length)return this.createErrorOutput(a.GS.INVALID_OPTIONS,"No valid pages to process.","Please check your page range.");let[p,h]=o[c.pageSize];this.updateProgress(20,"Creating posterized PDF...");let g=await t.PDFDocument.create(),{rows:f,cols:P,overlap:E,scalingMode:w}=c,m=f*P,S=d.length*m,y=70/S,C=0;for(let t of d){if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");let{width:r,height:s}=l[t].getSize(),n=c.orientation;"auto"===n&&(n=r>s?"landscape":"portrait");let i=p,o=h;"landscape"===n&&i<o?[i,o]=[o,i]:"portrait"===n&&i>o&&([i,o]=[o,i]);let u=r/P,d=s/f;for(let a=0;a<f;a++)for(let n=0;n<P;n++){C++,this.updateProgress(20+C*y,"Creating tile ".concat(C," of ").concat(S,"..."));let c=n*u-(n>0?E:0),l=s-(a+1)*d-(a>0?E:0),p=u+(n>0?E:0)+(n<P-1?E:0),h=d+(a>0?E:0)+(a<f-1?E:0),[m]=await g.copyPages(e,[t]);m.setCropBox(Math.max(0,c),Math.max(0,l),Math.min(p,r-c),Math.min(h,s-l));let O=g.addPage([i,o]),D=await g.embedPage(m,{left:Math.max(0,c),bottom:Math.max(0,l),right:Math.min(c+p,r),top:Math.min(l+h,s)}),F=i/D.width,I=o/D.height,L="fit"===w?Math.min(F,I):Math.max(F,I),v=D.width*L,k=D.height*L,A=(i-v)/2,N=(o-k)/2;O.drawPage(D,{x:A,y:N,width:v,height:k})}}this.updateProgress(90,"Saving PDF...");let O=await g.save({useObjectStreams:!0}),D=new Blob([new Uint8Array(O)],{type:"application/pdf"});this.updateProgress(100,"Complete!");let F=function(e,t,r){let a=function(e){let t=e.lastIndexOf(".");return -1===t?e:e.slice(0,t)}(e);return"".concat(a,"_posterized_").concat(t,"x").concat(r,".pdf")}(s.name,f,P);return this.createSuccessOutput(D,F,{originalPageCount:u,processedPageCount:d.length,outputTileCount:S,gridSize:"".concat(f,"x").concat(P)})}catch(e){return this.createErrorOutput(a.GS.PROCESSING_FAILED,"Failed to posterize PDF.",e instanceof Error?e.message:"Unknown error")}}getAcceptedTypes(){return["application/pdf"]}}async function l(e,t,r){return new c().process({files:[e],options:t},r)}},95100:(e,t,r)=>{r.d(t,{qe:()=>c});var a=r(78752),s=r(18365),n=r(32096);let i={angle:90};class o extends s.A{async process(e,t){this.reset(),this.onProgress=t;let{files:r,options:s}=e,o={...i,...s};if(1!==r.length)return this.createErrorOutput(a.GS.INVALID_OPTIONS,"Exactly 1 PDF file is required for rotation.","Received ".concat(r.length," file(s)."));try{let e;this.updateProgress(5,"Loading PDF library...");let t=await (0,n.Ck)();if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");this.updateProgress(10,"Loading source PDF...");let s=r[0],i=await s.arrayBuffer();try{e=await t.PDFDocument.load(i,{ignoreEncryption:!0})}catch(e){if(e instanceof Error&&e.message.includes("encrypt"))return this.createErrorOutput(a.GS.PDF_ENCRYPTED,"The PDF file is encrypted.","Please decrypt the file before rotating pages.");throw e}let c=e.getPageCount();if(this.updateProgress(20,"Source PDF has ".concat(c," pages.")),this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");let l=function(e,t){let r=new Map;return e.rotations?e.rotations instanceof Map?e.rotations.forEach((e,t)=>{r.set(t,e)}):Object.entries(e.rotations).forEach(e=>{let[t,a]=e;r.set(parseInt(t,10),a)}):void 0!==e.angle&&0!==e.angle&&(e.pages||Array.from({length:t},(e,t)=>t+1)).forEach(t=>{r.set(t,e.angle)}),r}(o,c);for(let e of l.keys())if(e<1||e>c)return this.createErrorOutput(a.GS.INVALID_PAGE_RANGE,"Page ".concat(e," is out of range."),"The PDF has ".concat(c," pages."));this.updateProgress(30,"Creating rotated PDF...");let u=await t.PDFDocument.create(),d=60/c;for(let r=0;r<c;r++){if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");let s=r+1,n=l.get(s)||0;this.updateProgress(30+r*d,"Processing page ".concat(s,"..."));let i=e.getPage(r),o=i.getRotation().angle,c=function(e){let t=e%360;return t<0&&(t+=360),t}(o+n);if(c%90==0){let[a]=await u.copyPages(e,[r]);a.setRotation(t.degrees(c)),u.addPage(a)}else{let e=await u.embedPage(i),{width:r,height:a}=e.scale(1),s=c*Math.PI/180,n=Math.abs(Math.cos(s)),o=Math.abs(Math.sin(s)),l=r*n+a*o,d=r*o+a*n,p=u.addPage([l,d]),h=l/2-(r/2*Math.cos(s)-a/2*Math.sin(s)),g=d/2-(r/2*Math.sin(s)+a/2*Math.cos(s));p.drawPage(e,{x:h,y:g,width:r,height:a,rotate:t.degrees(c)})}}this.updateProgress(90,"Saving rotated PDF...");let p=await u.save({useObjectStreams:!0}),h=new Blob([new Uint8Array(p)],{type:"application/pdf"});this.updateProgress(100,"Complete!");let g=function(e){let t=function(e){let t=e.lastIndexOf(".");return -1===t?e:e.slice(0,t)}(e);return"".concat(t,"_rotated.pdf")}(s.name);return this.createSuccessOutput(h,g,{pageCount:c,rotatedPages:l.size})}catch(e){return this.createErrorOutput(a.GS.PROCESSING_FAILED,"Failed to rotate PDF pages.",e instanceof Error?e.message:"Unknown error")}}getAcceptedTypes(){return["application/pdf"]}}async function c(e,t,r){return new o().process({files:[e],options:t},r)}},98530:(e,t,r)=>{r.d(t,{me:()=>l});var a=r(78752),s=r(18365),n=r(32096);let i={reverseSecond:!1,preserveBookmarks:!1};class o extends s.A{async process(e,t){this.reset(),this.onProgress=t;let{files:r,options:s}=e,o={...i,...s};if(r.length<2)return this.createErrorOutput(a.GS.INVALID_OPTIONS,"At least 2 PDF files are required for alternate merging.","Received ".concat(r.length," file(s)."));try{this.updateProgress(5,"Loading PDF library...");let e=await (0,n.Ck)();if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");this.updateProgress(10,"Loading PDF documents...");let t=[],s=30/r.length;for(let n=0;n<r.length;n++){if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");let i=r[n],o=10+n*s;this.updateProgress(o,"Loading file ".concat(n+1," of ").concat(r.length,": ").concat(i.name));try{let r=await i.arrayBuffer(),a=await e.PDFDocument.load(r,{ignoreEncryption:!1}),s=a.getPageCount();t.push({doc:a,pageCount:s,name:i.name})}catch(e){if(e instanceof Error&&e.message.includes("encrypt"))return this.createErrorOutput(a.GS.PDF_ENCRYPTED,'File "'.concat(i.name,'" is encrypted.'),"Please decrypt the file before merging.");return this.createErrorOutput(a.GS.PROCESSING_FAILED,'Failed to load file "'.concat(i.name,'".'),e instanceof Error?e.message:"Unknown error")}}this.updateProgress(40,"Creating merged document...");let i=await e.PDFDocument.create(),l=Math.max(...t.map(e=>e.pageCount)),u=t.map((e,t)=>{let r=Array.from({length:e.pageCount},(e,t)=>t);return 1===t&&o.reverseSecond?r.reverse():r});this.updateProgress(50,"Interleaving pages...");let d=40/l,p=0;for(let e=0;e<l;e++){if(this.checkCancelled())return this.createErrorOutput(a.GS.PROCESSING_CANCELLED,"Processing was cancelled.");let r=50+e*d;this.updateProgress(r,"Processing page ".concat(e+1," of ").concat(l,"..."));for(let r=0;r<t.length;r++){let s=t[r],n=u[r][e];if(void 0!==n&&n<s.pageCount)try{let[e]=await i.copyPages(s.doc,[n]);i.addPage(e),p++}catch(e){return this.createErrorOutput(a.GS.PROCESSING_FAILED,"Failed to copy page ".concat(n+1,' from "').concat(s.name,'".'),e instanceof Error?e.message:"Unknown error")}}}this.updateProgress(95,"Saving merged PDF...");let h=await i.save({useObjectStreams:!0}),g=new Blob([new Uint8Array(h)],{type:"application/pdf"});this.updateProgress(100,"Complete!");let f=function(e){if(0===e.length)return"alternate-merged.pdf";let t=c(e[0].name);if(2===e.length){let r=c(e[1].name);return"".concat(t,"_").concat(r,"_interleaved.pdf")}return"".concat(t,"_and_").concat(e.length-1,"_more_interleaved.pdf")}(r);return this.createSuccessOutput(g,f,{pageCount:p,fileCount:r.length,interleaved:!0})}catch(e){return this.createErrorOutput(a.GS.PROCESSING_FAILED,"Failed to alternate merge PDF files.",e instanceof Error?e.message:"Unknown error")}}getMaxFileSize(){return 524288e3}getAcceptedTypes(){return["application/pdf"]}}function c(e){let t=e.lastIndexOf(".");return -1===t?e:e.slice(0,t)}async function l(e,t,r){return new o().process({files:e,options:t||{}},r)}}}]);