"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[691],{5691:(e,r,t)=>{t.r(r),t.d(r,{AddAttachmentsPDFProcessor:()=>c,EditAttachmentsPDFProcessor:()=>i,ExtractAttachmentsPDFProcessor:()=>n,addAttachments:()=>d,createAddAttachmentsProcessor:()=>h,createEditAttachmentsProcessor:()=>l,createExtractAttachmentsProcessor:()=>u,editAttachments:()=>p,extractAttachments:()=>m});var s=t(78752),a=t(18365);let o={attachmentLevel:"document"};class c extends a.A{async process(e,r){this.reset(),this.onProgress=r;let{files:t,options:a}=e,c={...o,...a};if(t.length<2)return this.createErrorOutput(s.GS.INVALID_OPTIONS,"Please provide a PDF file and at least one file to attach.","Received ".concat(t.length," file(s)."));let n=t[0],i=t.slice(1);if(!n.name.toLowerCase().endsWith(".pdf"))return this.createErrorOutput(s.GS.FILE_TYPE_INVALID,"The first file must be a PDF.","Received: ".concat(n.name));try{this.updateProgress(5,"Loading PDF file...");let e=await n.arrayBuffer();if(this.checkCancelled())return this.createErrorOutput(s.GS.PROCESSING_CANCELLED,"Processing was cancelled.");this.updateProgress(20,"Loading attachment files...");let r=[],t=[];for(let e=0;e<i.length;e++){let s=i[e],a=await s.arrayBuffer();r.push(a),t.push(s.name),this.updateProgress(20+30*(e+1)/i.length,"Loading attachment ".concat(e+1," of ").concat(i.length,"..."))}if(this.checkCancelled())return this.createErrorOutput(s.GS.PROCESSING_CANCELLED,"Processing was cancelled.");this.updateProgress(50,"Adding attachments to PDF...");let a=await this.processWithWorker(e,r,t,c);if(!a.success)return this.createErrorOutput(s.GS.PROCESSING_FAILED,a.error||"Failed to add attachments to PDF.");this.updateProgress(100,"Complete!");let o=n.name.replace(/\.pdf$/i,"");return this.createSuccessOutput(a.blob,"".concat(o,"_with_attachments.pdf"),{attachmentCount:i.length,attachmentNames:t})}catch(e){return this.createErrorOutput(s.GS.PROCESSING_FAILED,"Failed to add attachments to PDF.",e instanceof Error?e.message:"Unknown error")}}processWithWorker(e,r,t,s){return new Promise(a=>{try{this.worker=new Worker("/workers/add-attachments.worker.js"),this.worker.onmessage=e=>{let{status:r,modifiedPDF:t,message:s}=e.data;if("success"===r){let e=new Blob([new Uint8Array(t)],{type:"application/pdf"});a({success:!0,blob:e})}else a({success:!1,error:s||"Worker processing failed"});this.terminateWorker()},this.worker.onerror=e=>{a({success:!1,error:e.message||"Worker error occurred"}),this.terminateWorker()},this.worker.postMessage({command:"add-attachments",pdfBuffer:e,attachmentBuffers:r,attachmentNames:t,attachmentLevel:s.attachmentLevel,pageRange:s.pageRange||""})}catch(e){a({success:!1,error:e instanceof Error?e.message:"Failed to start worker"})}})}terminateWorker(){this.worker&&(this.worker.terminate(),this.worker=null)}cancel(){super.cancel(),this.terminateWorker()}getAcceptedTypes(){return["application/pdf","*/*"]}constructor(...e){super(...e),this.worker=null}}class n extends a.A{async process(e,r){this.reset(),this.onProgress=r;let{files:t}=e;if(0===t.length)return this.createErrorOutput(s.GS.INVALID_OPTIONS,"Please provide at least one PDF file.","No files provided.");try{var a;this.updateProgress(5,"Loading PDF files...");let e=[],r=[];for(let s=0;s<t.length;s++){let a=t[s];if(!a.name.toLowerCase().endsWith(".pdf"))continue;let o=await a.arrayBuffer();e.push(o),r.push(a.name),this.updateProgress(5+25*(s+1)/t.length,"Loading file ".concat(s+1," of ").concat(t.length,"..."))}if(0===e.length)return this.createErrorOutput(s.GS.FILE_TYPE_INVALID,"No valid PDF files provided.","Please select PDF files.");if(this.checkCancelled())return this.createErrorOutput(s.GS.PROCESSING_CANCELLED,"Processing was cancelled.");this.updateProgress(30,"Extracting attachments...");let o=await this.processWithWorker(e,r);if(!o.success)return this.createErrorOutput(s.GS.PROCESSING_FAILED,o.error||"Failed to extract attachments.");return this.updateProgress(100,"Complete!"),{success:!0,result:void 0,metadata:{attachments:o.attachments,attachmentCount:(null==(a=o.attachments)?void 0:a.length)||0}}}catch(e){return this.createErrorOutput(s.GS.PROCESSING_FAILED,"Failed to extract attachments.",e instanceof Error?e.message:"Unknown error")}}processWithWorker(e,r){return new Promise(t=>{try{this.worker=new Worker("/workers/extract-attachments.worker.js"),this.worker.onmessage=e=>{let{status:r,attachments:s,message:a}=e.data;"success"===r?t({success:!0,attachments:s}):t({success:!1,error:a||"Worker processing failed"}),this.terminateWorker()},this.worker.onerror=e=>{t({success:!1,error:e.message||"Worker error occurred"}),this.terminateWorker()},this.worker.postMessage({command:"extract-attachments",fileBuffers:e,fileNames:r})}catch(e){t({success:!1,error:e instanceof Error?e.message:"Failed to start worker"})}})}terminateWorker(){this.worker&&(this.worker.terminate(),this.worker=null)}cancel(){super.cancel(),this.terminateWorker()}getAcceptedTypes(){return["application/pdf"]}constructor(...e){super(...e),this.worker=null}}class i extends a.A{async getAttachments(e){try{let r=await e.arrayBuffer();return this.getAttachmentsWithWorker(r,e.name)}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to read file"}}}async process(e,r){this.reset(),this.onProgress=r;let{files:t,options:a}=e;if(0===t.length)return this.createErrorOutput(s.GS.INVALID_OPTIONS,"Please provide a PDF file.","No files provided.");let o=t[0];if(!o.name.toLowerCase().endsWith(".pdf"))return this.createErrorOutput(s.GS.FILE_TYPE_INVALID,"Please provide a PDF file.","Received: ".concat(o.name));try{var c;this.updateProgress(10,"Loading PDF file...");let e=await o.arrayBuffer();if(this.checkCancelled())return this.createErrorOutput(s.GS.PROCESSING_CANCELLED,"Processing was cancelled.");this.updateProgress(30,"Removing selected attachments...");let r=await this.editAttachmentsWithWorker(e,o.name,a.attachmentsToRemove||[]);if(!r.success)return this.createErrorOutput(s.GS.PROCESSING_FAILED,r.error||"Failed to edit attachments.");this.updateProgress(100,"Complete!");let t=o.name.replace(/\.pdf$/i,"");return this.createSuccessOutput(r.blob,"".concat(t,"_edited.pdf"),{removedCount:(null==(c=a.attachmentsToRemove)?void 0:c.length)||0})}catch(e){return this.createErrorOutput(s.GS.PROCESSING_FAILED,"Failed to edit attachments.",e instanceof Error?e.message:"Unknown error")}}getAttachmentsWithWorker(e,r){return new Promise(t=>{try{this.worker=new Worker("/workers/edit-attachments.worker.js"),this.worker.onmessage=e=>{let{status:r,attachments:s,message:a}=e.data;"success"===r?t({success:!0,attachments:s}):t({success:!1,error:a||"Worker processing failed"}),this.terminateWorker()},this.worker.onerror=e=>{t({success:!1,error:e.message||"Worker error occurred"}),this.terminateWorker()},this.worker.postMessage({command:"get-attachments",fileBuffer:e,fileName:r})}catch(e){t({success:!1,error:e instanceof Error?e.message:"Failed to start worker"})}})}editAttachmentsWithWorker(e,r,t){return new Promise(s=>{try{this.worker=new Worker("/workers/edit-attachments.worker.js"),this.worker.onmessage=e=>{let{status:r,modifiedPDF:t,message:a}=e.data;if("success"===r){let e=new Blob([new Uint8Array(t)],{type:"application/pdf"});s({success:!0,blob:e})}else s({success:!1,error:a||"Worker processing failed"});this.terminateWorker()},this.worker.onerror=e=>{s({success:!1,error:e.message||"Worker error occurred"}),this.terminateWorker()},this.worker.postMessage({command:"edit-attachments",fileBuffer:e,fileName:r,attachmentsToRemove:t})}catch(e){s({success:!1,error:e instanceof Error?e.message:"Failed to start worker"})}})}terminateWorker(){this.worker&&(this.worker.terminate(),this.worker=null)}cancel(){super.cancel(),this.terminateWorker()}getAcceptedTypes(){return["application/pdf"]}constructor(...e){super(...e),this.worker=null}}function h(){return new c}function u(){return new n}function l(){return new i}async function d(e,r,t,s){return h().process({files:[e,...r],options:t||{}},s)}async function m(e,r){return u().process({files:e,options:{}},r)}async function p(e,r,t){return l().process({files:[e],options:{attachmentsToRemove:r}},t)}}}]);